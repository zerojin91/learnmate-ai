<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LearningMate - ê°œì¸í™” í•™ìŠµ ë©˜í† </title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f9fafb;
            min-height: 100vh;
            display: flex;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 20px rgba(0,0,0,0.1);
            position: fixed;
            height: 100vh;
            z-index: 100;
        }

        .logo {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo h1 {
            color: #4a5568;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .logo p {
            color: #718096;
            font-size: 14px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 10px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: #4a5568;
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-weight: 500;
            cursor: pointer;
        }

        .nav-link i {
            margin-right: 12px;
            width: 20px;
        }

        .nav-link:hover, .nav-link.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateX(5px);
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content {
            flex: 1;
            margin-left: 280px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }

        /* ì›°ì»´ ì„¹ì…˜ */
        .welcome-section {
            text-align: center;
            max-width: 800px;
            margin-bottom: 40px;
        }

        .ai-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #a855f7, #ec4899);
            border-radius: 50%;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 32px rgba(168, 85, 247, 0.3);
        }

        .welcome-title {
            font-size: 32px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 10px;
        }

        .welcome-subtitle {
            font-size: 20px;
            color: #6b7280;
            margin-bottom: 5px;
        }

        .welcome-subtitle .highlight {
            background: linear-gradient(135deg, #a855f7, #ec4899);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 600;
        }

        /* ì±„íŒ… ì»¨í…Œì´ë„ˆ - ì˜ˆì‹œ ì¹´ë“œ 3ê°œ ë¶„ëŸ‰ */
        .chat-container {
            flex: 3;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.1);
            overflow: hidden;
            height: 450px;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            background: #ffffff;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
        }

        .user-avatar {
            background: #e5e7eb;
            color: #6b7280;
        }

        .ai-avatar-small {
            background: linear-gradient(135deg, #a855f7, #ec4899);
            color: white;
        }

        .message-content {
            flex: 1;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 15px;
            line-height: 1.5;
        }

        .user-message .message-content {
            background: #f3f4f6;
            color: #1f2937;
        }

        .ai-message .message-content {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            color: #374151;
            border-left: none !important;
        }
        
        .ai-message .message-content * {
            border-left: none !important;
            margin-left: 0 !important;
            padding-left: 0 !important;
        }

        /* ì…ë ¥ ì˜ì—­ */
        .input-container {
            padding: 30px;
            background: white;
            border-top: 1px solid #e5e7eb;
            flex-shrink: 0;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            transition: all 0.2s ease;
        }

        .input-wrapper:focus-within {
            border-color: #a855f7;
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }

        .message-input {
            flex: 1;
            padding: 16px 20px;
            border: none;
            background: transparent;
            font-size: 16px;
            outline: none;
            resize: none;
            min-height: 24px;
            max-height: 120px;
            font-family: inherit;
        }

        .input-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            padding-right: 12px;
        }

        .attach-button, .clear-button {
            padding: 8px;
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .attach-button:hover, .clear-button:hover {
            background: #e5e7eb;
            color: #374151;
        }

        .clear-button:hover {
            color: #ef4444;
        }

        .send-button {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #a855f7, #ec4899);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .send-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* íŒŒì¼ ì…ë ¥ ìˆ¨ê¹€ */
        .file-input {
            display: none;
        }

        /* ì±„íŒ…ê³¼ í”„ë¡œí•„ ì˜ì—­ */
        .chat-with-profile {
            display: flex;
            width: 100%;
            max-width: 1200px;
            gap: 24px;
            align-items: flex-start;
            margin-bottom: 40px;
        }

        /* í”„ë¡œí•„ ì‚¬ì´ë“œë°” - ì˜ˆì‹œ ì¹´ë“œ 1ê°œ ë¶„ëŸ‰ */
        .profile-sidebar {
            flex: 1;
            min-width: 280px;
            max-width: 350px;
        }

        .profile-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            border: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            transition: height 0.3s ease;
        }

        /* ì»¤ë¦¬í˜ëŸ¼ ì„¹ì…˜ì´ í‘œì‹œë  ë•Œë§Œ ì±„íŒ…ì°½ ë†’ì´ì— ë§ì¶¤ */
        .profile-card.with-curriculum {
            height: 450px;
            overflow-y: auto;
        }

        .profile-card h3 {
            margin: 0 0 20px 0;
            font-size: 18px;
            font-weight: 600;
            color: #374151;
        }

        .profile-progress {
            display: flex;
            flex-direction: column;
        }

        /* ì»¤ë¦¬í˜ëŸ¼ ì„¹ì…˜ì´ ìˆì„ ë•ŒëŠ” í”„ë¡œí•„ ì§„í–‰ ìƒí™©ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ */
        .profile-card.with-curriculum .profile-progress {
            /* ê¸°ë³¸ ê°„ê²© ìœ ì§€ */
            display: flex;
            flex-direction: column;
        }

        .profile-step {
            display: flex;
            align-items: flex-start;
            position: relative;
            margin-bottom: 4px;
        }

        /* ì»¤ë¦¬í˜ëŸ¼ ì„¹ì…˜ì´ ìˆì„ ë•Œë„ ê¸°ë³¸ ê°„ê²© ìœ ì§€ */

        .step-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-right: 16px;
            z-index: 2;
        }

        .step-circle {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }

        .step-circle i {
            font-size: 12px;
            color: white;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .step-line {
            width: 2px;
            height: 32px;
            background: #d1d5db;
            margin-top: 6px;
            transition: background 0.3s ease;
        }

        .profile-step:last-child .step-line {
            display: none;
        }

        .step-content {
            flex: 1;
            padding: 2px 0 16px 0;
        }

        .step-label {
            font-size: 14px;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 2px;
            line-height: 1.2;
        }

        .step-value {
            font-size: 14px;
            color: #9ca3af;
            font-weight: 400;
            line-height: 1.3;
            margin-top: 2px;
        }

        /* ì™„ë£Œëœ ë‹¨ê³„ ìŠ¤íƒ€ì¼ */
        .profile-step.completed .step-circle {
            background: #10b981;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        .profile-step.completed .step-circle i {
            opacity: 1;
        }

        .profile-step.completed .step-line {
            background: #10b981;
        }

        .profile-step.completed .step-value {
            color: #374151;
            font-weight: 500;
        }

        .profile-step.completed .step-label {
            color: #374151;
        }

        /* ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ì„¹ì…˜ */
        .curriculum-section {
            margin-top: auto;
            padding-top: 20px;
            animation: slideIn 0.3s ease-out;
            flex-shrink: 0;
        }

        .curriculum-divider {
            height: 1px;
            background: linear-gradient(to right, transparent, #e5e7eb, transparent);
            margin: 0 0 20px 0;
        }

        .duration-selector {
            margin-bottom: 16px;
        }

        .duration-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
        }

        .duration-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            color: #374151;
            outline: none;
            transition: all 0.2s ease;
        }

        .duration-select:focus {
            border-color: #a855f7;
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }

        .generate-curriculum-btn {
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, #a855f7, #ec4899);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s ease;
        }

        .generate-curriculum-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(168, 85, 247, 0.3);
        }

        .generate-curriculum-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .generate-curriculum-btn i {
            font-size: 16px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ëª¨ë‹¬ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* ì˜ˆì‹œ ì¹´ë“œ */
        .examples-section {
            width: 100%;
            max-width: 1200px;
            margin-top: 40px;
        }

        .examples-title {
            font-size: 16px;
            font-weight: 600;
            color: #6b7280;
            text-align: center;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .example-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .example-card:hover {
            border-color: #a855f7;
            box-shadow: 0 4px 16px rgba(168, 85, 247, 0.1);
            transform: translateY(-2px);
        }

        .example-icon {
            font-size: 20px;
            color: #a855f7;
            margin-bottom: 8px;
        }

        .example-title {
            font-size: 14px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .example-description {
            font-size: 12px;
            color: #6b7280;
            line-height: 1.4;
        }

        /* ì•Œë¦¼ ë©”ì‹œì§€ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: static;
                padding: 20px;
            }
            
            .main-content {
                margin-left: 0;
                padding: 20px 15px;
            }
            
            .nav-menu {
                display: flex;
                overflow-x: auto;
                gap: 10px;
                padding-bottom: 10px;
            }
            
            .nav-item {
                margin-bottom: 0;
                white-space: nowrap;
            }

            .welcome-title {
                font-size: 24px;
            }

            .welcome-subtitle {
                font-size: 18px;
            }

            .examples-grid {
                grid-template-columns: 1fr 1fr;
                gap: 16px;
            }
            
            .chat-with-profile {
                gap: 16px;
                margin-bottom: 30px;
            }
        }

        @media (max-width: 480px) {
            .examples-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ì‚¬ì´ë“œë°” -->
    <div class="sidebar">
        <div class="logo">
            <h1>LearningMate</h1>
            <p>ê°œì¸í™” í•™ìŠµ ë©˜í† </p>
        </div>
        
        <ul class="nav-menu">
            <li class="nav-item">
                <a class="nav-link" data-page="datasource">
                    <i class="fas fa-database"></i>
                    ë°ì´í„° ì›ì²œ ê´€ë¦¬
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" data-page="chat">
                    <i class="fas fa-bullseye"></i>
                    ë§ì¶¤í˜• í•™ìŠµ ì¶”ì²œ
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-page="curriculum">
                    <i class="fas fa-graduation-cap"></i>
                    ë‚˜ì˜ ì»¤ë¦¬í˜ëŸ¼
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-page="profile">
                    <i class="fas fa-robot"></i>
                    AI ë©˜í† 
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-page="settings">
                    <i class="fas fa-cog"></i>
                    ì„¤ì •
                </a>
            </li>
        </ul>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="main-content">
        <!-- ì›°ì»´ ì„¹ì…˜ -->
        <div class="welcome-section">
            <div class="ai-avatar">
            </div>
            <h1 class="welcome-title">ì•ˆë…•í•˜ì„¸ìš”, <span id="userName">ì‹ ë¯¼ìˆ˜</span>ë‹˜</h1>
            <p class="welcome-subtitle" id="welcomeSubtitle">ì˜¤ëŠ˜ <span class="highlight">ë¬´ì—‡ì„</span> ë°°ìš°ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?</p>
        </div>

        <!-- ì±„íŒ…ê³¼ í”„ë¡œí•„ ì˜ì—­ -->
        <div class="chat-with-profile">
            <!-- ì±„íŒ… ì»¨í…Œì´ë„ˆ -->
            <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <div class="message ai-message">
                    <div class="message-avatar ai-avatar-small">AI</div>
                    <div class="message-content" id="initialMessage">
                        ì•ˆë…•í•˜ì„¸ìš”! LearningMate ì…ë‹ˆë‹¤.<br>ì–´ë–¤ ì£¼ì œì— ëŒ€í•´ ë°°ìš°ê³  ì‹¶ìœ¼ì‹ ì§€ ì•Œë ¤ì£¼ì‹œë©´ ë§ì¶¤í˜• í•™ìŠµ ê³„íšì„ í•¨ê»˜ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤!
                    </div>
                </div>
            </div>
            
            <div class="input-container">
                <div class="input-wrapper">
                    <textarea 
                        id="messageInput" 
                        class="message-input"
                        placeholder="AIì—ê²Œ ì§ˆë¬¸í•˜ê±°ë‚˜ ìš”ì²­ì„ ì…ë ¥í•˜ì„¸ìš”..."
                        rows="1"
                        onkeydown="handleKeyDown(event)"
                        oninput="adjustTextareaHeight(this)"
                    ></textarea>
                    <div class="input-actions">
                        <input type="file" id="fileInput" class="file-input" accept=".txt,.pdf,.doc,.docx">
                        <button class="clear-button" onclick="clearChat()" title="ëŒ€í™” ì´ˆê¸°í™”">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button id="sendButton" class="send-button" onclick="sendMessage()" title="ì „ì†¡">
                            <i class="fas fa-arrow-up"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- í•™ìŠµ í”„ë¡œí•„ ì¹´ë“œ -->
        <div class="profile-sidebar">
            <div class="profile-card">
                <h3>í•™ìŠµ í”„ë¡œí•„</h3>
                <div class="profile-progress">
                    <div class="profile-step" id="stepTopic">
                        <div class="step-indicator">
                            <div class="step-circle">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="step-line"></div>
                        </div>
                        <div class="step-content">
                            <div class="step-label">ì£¼ì œ</div>
                            <div id="profileTopic" class="step-value">ì„¤ì • í•„ìš”</div>
                        </div>
                    </div>
                    
                    <div class="profile-step" id="stepConstraints">
                        <div class="step-indicator">
                            <div class="step-circle">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="step-line"></div>
                        </div>
                        <div class="step-content">
                            <div class="step-label">ì¡°ê±´</div>
                            <div id="profileConstraints" class="step-value">ì„¤ì • í•„ìš”</div>
                        </div>
                    </div>
                    
                    <div class="profile-step" id="stepGoal">
                        <div class="step-indicator">
                            <div class="step-circle">
                                <i class="fas fa-check"></i>
                            </div>
                        </div>
                        <div class="step-content">
                            <div class="step-label">ëª©í‘œ</div>
                            <div id="profileGoal" class="step-value">ì„¤ì • í•„ìš”</div>
                        </div>
                    </div>
                </div>
                
                <!-- í•™ìŠµ ê¸°ê°„ ì„ íƒ ë° ì»¤ë¦¬í˜ëŸ¼ ìƒì„± -->
                <div id="curriculumSection" class="curriculum-section" style="display: none;">
                    <div class="curriculum-divider"></div>
                    
                    <div class="duration-selector">
                        <label for="learningDuration" class="duration-label">í•™ìŠµ ê¸°ê°„ ì„¤ì •</label>
                        <select id="learningDuration" class="duration-select">
                            <option value="1">1ê°œì›”</option>
                            <option value="2">2ê°œì›”</option>
                            <option value="3" selected>3ê°œì›”</option>
                            <option value="4">4ê°œì›”</option>
                            <option value="5">5ê°œì›”</option>
                            <option value="6">6ê°œì›”</option>
                        </select>
                    </div>
                    
                    <button id="generateCurriculumBtn" class="generate-curriculum-btn" onclick="generateCurriculum()">
                        <i class="fas fa-magic"></i>
                        ë§ì¶¤í˜• ì»¤ë¦¬í˜ëŸ¼ ìƒì„±
                    </button>
                </div>
            </div>
        </div>
        </div>

        <!-- ì˜ˆì‹œ ì„¹ì…˜ -->
        <div class="examples-section">
            <h3 class="examples-title">ì˜ˆì‹œë¡œ ì‹œì‘í•´ë³´ì„¸ìš”</h3>
            <div class="examples-grid">
                <div class="example-card" onclick="useExample('Python í”„ë¡œê·¸ë˜ë°ì„ ì²˜ìŒë¶€í„° ë°°ìš°ê³  ì‹¶ì–´ìš”')">
                    <div class="example-icon">
                        <i class="fab fa-python"></i>
                    </div>
                    <div class="example-title">í”„ë¡œê·¸ë˜ë° í•™ìŠµ</div>
                    <div class="example-description">Python ì²˜ìŒë¶€í„° ë°°ìš°ê¸°</div>
                </div>
                
                <div class="example-card" onclick="useExample('ì˜ì–´ íšŒí™” ì‹¤ë ¥ì„ í–¥ìƒì‹œí‚¤ê³  ì‹¶ìŠµë‹ˆë‹¤')">
                    <div class="example-icon">
                        <i class="fas fa-language"></i>
                    </div>
                    <div class="example-title">ì–¸ì–´ í•™ìŠµ</div>
                    <div class="example-description">ì˜ì–´ íšŒí™” í–¥ìƒ ê³„íš</div>
                </div>
                
                <div class="example-card" onclick="useExample('ë°ì´í„° ê³¼í•™ ê³µë¶€ ê³„íšì„ ì„¸ì›Œì£¼ì„¸ìš”')">
                    <div class="example-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div class="example-title">ë°ì´í„° ê³¼í•™</div>
                    <div class="example-description">ì²´ê³„ì ì¸ í•™ìŠµ ë¡œë“œë§µ</div>
                </div>
                
                <div class="example-card" onclick="useExample('AIì™€ ë¨¸ì‹ ëŸ¬ë‹ì— ëŒ€í•´ ì•Œê³  ì‹¶ì–´ìš”')">
                    <div class="example-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="example-title">AI/ML í•™ìŠµ</div>
                    <div class="example-description">ì¸ê³µì§€ëŠ¥ ê¸°ì´ˆë¶€í„°</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì•Œë¦¼ -->
    <div id="notification" class="notification"></div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');

        // ì‚¬ìš©ì ì´ë¦„ ì„¤ì • (ì—¬ê¸°ì„œ ë³€ê²½í•˜ì„¸ìš”)
        const USER_NAME = "ì‹ ë¯¼ìˆ˜"; // ì›í•˜ëŠ” ì´ë¦„ìœ¼ë¡œ ë³€ê²½
        
        // ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ì„¸ì…˜ ID
        const SESSION_ID = "{{ session_id }}";
        console.log('ì„¸ì…˜ ID:', SESSION_ID);

        // ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ìƒíƒœ ì¶”ì 
        let isGeneratingCurriculum = false;

        // ì‚¬ìš©ì ì •ë³´ ê´€ë¦¬
        let currentUser = {
            name: USER_NAME,
            profile: {}
        };
        
        // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬ ê°ì²´
        const StorageManager = {
            keys: {
                CURRENT_PROFILE: 'currentProfile',
                GENERATED_CURRICULUM: 'generatedCurriculum',
                CURRICULUM_PROGRESS: 'curriculumProgress',
                SELECTED_MENTORS: 'selectedMentors',
                LAST_SESSION_ID: 'lastSessionId',
                USER_INFO: 'learnai_user'
            },

            // ë°ì´í„° ì €ì¥
            set(key, value) {
                try {
                    const serializedValue = typeof value === 'string' ? value : JSON.stringify(value);
                    localStorage.setItem(key, serializedValue);
                    console.log(`ğŸ’¾ LocalStorage ì €ì¥: ${key}`, value);
                } catch (error) {
                    console.error(`âŒ LocalStorage ì €ì¥ ì‹¤íŒ¨: ${key}`, error);
                }
            },

            // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            get(key, defaultValue = null) {
                try {
                    const value = localStorage.getItem(key);
                    if (value === null) return defaultValue;
                    
                    // JSON íŒŒì‹± ì‹œë„
                    try {
                        return JSON.parse(value);
                    } catch {
                        // JSONì´ ì•„ë‹Œ ê²½ìš° ì›ë³¸ ë¬¸ìì—´ ë°˜í™˜
                        return value;
                    }
                } catch (error) {
                    console.error(`âŒ LocalStorage ì½ê¸° ì‹¤íŒ¨: ${key}`, error);
                    return defaultValue;
                }
            },

            // ë°ì´í„° ì‚­ì œ
            remove(key) {
                try {
                    localStorage.removeItem(key);
                    console.log(`ğŸ—‘ï¸ LocalStorage ì‚­ì œ: ${key}`);
                } catch (error) {
                    console.error(`âŒ LocalStorage ì‚­ì œ ì‹¤íŒ¨: ${key}`, error);
                }
            },

            // ì—¬ëŸ¬ í‚¤ ì¼ê´„ ì‚­ì œ
            removeMultiple(keys) {
                keys.forEach(key => this.remove(key));
            },

            // ì „ì²´ ì´ˆê¸°í™”
            clear() {
                try {
                    localStorage.clear();
                    console.log('ğŸ§¹ LocalStorage ì „ì²´ ì´ˆê¸°í™”');
                } catch (error) {
                    console.error('âŒ LocalStorage ì´ˆê¸°í™” ì‹¤íŒ¨', error);
                }
            },

            // í”„ë¡œí•„ ê´€ë ¨ ë©”ì„œë“œ
            profile: {
                set(topic, constraints, goal) {
                    const profileData = { topic, constraints, goal };
                    StorageManager.set(StorageManager.keys.CURRENT_PROFILE, profileData);
                    return profileData;
                },
                
                get() {
                    return StorageManager.get(StorageManager.keys.CURRENT_PROFILE, { topic: '', constraints: '', goal: '' });
                },
                
                clear() {
                    StorageManager.remove(StorageManager.keys.CURRENT_PROFILE);
                }
            },

            // ì»¤ë¦¬í˜ëŸ¼ ê´€ë ¨ ë©”ì„œë“œ
            curriculum: {
                set(curriculumData) {
                    StorageManager.set(StorageManager.keys.GENERATED_CURRICULUM, curriculumData);
                    return curriculumData;
                },
                
                get() {
                    return StorageManager.get(StorageManager.keys.GENERATED_CURRICULUM, null);
                },
                
                clear() {
                    StorageManager.remove(StorageManager.keys.GENERATED_CURRICULUM);
                },

                // ì§„í–‰ë„ ê´€ë ¨
                progress: {
                    set(completedWeeks) {
                        StorageManager.set(StorageManager.keys.CURRICULUM_PROGRESS, completedWeeks);
                        return completedWeeks;
                    },
                    
                    get() {
                        return StorageManager.get(StorageManager.keys.CURRICULUM_PROGRESS, []);
                    },
                    
                    add(weekIndex) {
                        const current = this.get();
                        if (!current.includes(weekIndex)) {
                            const updated = [...current, weekIndex].sort((a, b) => a - b);
                            this.set(updated);
                            return updated;
                        }
                        return current;
                    },
                    
                    remove(weekIndex) {
                        const current = this.get();
                        const updated = current.filter(week => week !== weekIndex);
                        this.set(updated);
                        return updated;
                    },
                    
                    clear() {
                        StorageManager.remove(StorageManager.keys.CURRICULUM_PROGRESS);
                    }
                }
            },

            // ë©˜í†  ê´€ë ¨ ë©”ì„œë“œ
            mentors: {
                set(selectedMentors) {
                    StorageManager.set(StorageManager.keys.SELECTED_MENTORS, selectedMentors);
                    return selectedMentors;
                },
                
                get() {
                    return StorageManager.get(StorageManager.keys.SELECTED_MENTORS, []);
                },
                
                clear() {
                    StorageManager.remove(StorageManager.keys.SELECTED_MENTORS);
                }
            },

            // ì„¸ì…˜ ê´€ë¦¬
            session: {
                setId(sessionId) {
                    StorageManager.set(StorageManager.keys.LAST_SESSION_ID, sessionId);
                },
                
                getId() {
                    return StorageManager.get(StorageManager.keys.LAST_SESSION_ID, null);
                },

                isNew(currentSessionId) {
                    const storedSessionId = this.getId();
                    return !storedSessionId || storedSessionId !== currentSessionId;
                }
            },

            // ì‚¬ìš©ì ì •ë³´ ê´€ë¦¬
            user: {
                set(userData) {
                    StorageManager.set(StorageManager.keys.USER_INFO, userData);
                    return userData;
                },
                
                get() {
                    return StorageManager.get(StorageManager.keys.USER_INFO, null);
                },
                
                clear() {
                    StorageManager.remove(StorageManager.keys.USER_INFO);
                }
            }
        };

        // ì¿ í‚¤ ì½ê¸° í•¨ìˆ˜
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        // ê°„ë‹¨í•œ ë§ˆí¬ë‹¤ìš´ í¬ë§·íŒ… í•¨ìˆ˜
        function formatSimpleMarkdown(text) {
            return text
                // **êµµì€ê¸€ì”¨** -> <strong>êµµì€ê¸€ì”¨</strong>
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                // ì¤„ë°”ê¿ˆ ì²˜ë¦¬
                .replace(/\n/g, '<br>')
                // ë¶ˆë¦¿ í¬ì¸íŠ¸ ì²˜ë¦¬
                .replace(/^- (.*$)/gim, 'â€¢ $1')
                .replace(/^\* (.*$)/gim, 'â€¢ $1');
        }

        // í•™ìŠµ í”„ë¡œí•„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateLearningProfile(topic, constraints, goal) {
            const profileTopic = document.getElementById('profileTopic');
            const profileConstraints = document.getElementById('profileConstraints');
            const profileGoal = document.getElementById('profileGoal');
            
            const stepTopic = document.getElementById('stepTopic');
            const stepConstraints = document.getElementById('stepConstraints');
            const stepGoal = document.getElementById('stepGoal');
            
            // ì£¼ì œ ì—…ë°ì´íŠ¸
            if (topic) {
                profileTopic.textContent = topic;
                stepTopic.classList.add('completed');
            } else {
                profileTopic.textContent = 'ì„¤ì • í•„ìš”';
                stepTopic.classList.remove('completed');
            }
            
            // ì¡°ê±´ ì—…ë°ì´íŠ¸
            if (constraints) {
                profileConstraints.textContent = constraints;
                stepConstraints.classList.add('completed');
            } else {
                profileConstraints.textContent = 'ì„¤ì • í•„ìš”';
                stepConstraints.classList.remove('completed');
            }
            
            // ëª©í‘œ ì—…ë°ì´íŠ¸
            if (goal) {
                profileGoal.textContent = goal;
                stepGoal.classList.add('completed');
            } else {
                profileGoal.textContent = 'ì„¤ì • í•„ìš”';
                stepGoal.classList.remove('completed');
            }

            // í”„ë¡œí•„ì´ ëª¨ë‘ ì™„ì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê³  ì»¤ë¦¬í˜ëŸ¼ ì„¹ì…˜ í‘œì‹œ/ìˆ¨ê¹€
            const profileComplete = topic && constraints && goal;
            const curriculumSection = document.getElementById('curriculumSection');
            const profileCard = document.querySelector('.profile-card');
            
            if (profileComplete && curriculumSection) {
                curriculumSection.style.display = 'block';
                profileCard.classList.add('with-curriculum');
                console.log('âœ… í”„ë¡œí•„ ì™„ì„± - ì»¤ë¦¬í˜ëŸ¼ ì„¹ì…˜ í‘œì‹œ, ì¹´ë“œ ë†’ì´ ì¡°ì •');
            } else if (curriculumSection) {
                curriculumSection.style.display = 'none';
                profileCard.classList.remove('with-curriculum');
                console.log('âŒ í”„ë¡œí•„ ë¯¸ì™„ì„± - ì»¤ë¦¬í˜ëŸ¼ ì„¹ì…˜ ìˆ¨ê¹€, ì¹´ë“œ ê¸°ë³¸ ë†’ì´');
            }
        }

        // AI ì‘ë‹µì—ì„œ í”„ë¡œí•„ ì •ë³´ ì¶”ì¶œ ë° ì—…ë°ì´íŠ¸
        function extractAndUpdateProfile(message) {
            // Assessment ê´€ë ¨ ë©”ì‹œì§€ì—ì„œ í”„ë¡œí•„ ì •ë³´ ì¶”ì¶œ ì‹œë„
            if (message.includes('íŒŒì´ì¬ í•™ìŠµ ì¡°ê±´') || message.includes('íŒŒì´ì¬ í•™ìŠµ ëª©í‘œ') || message.includes('í•™ìŠµ í”„ë¡œí•„ ë¶„ì„ ì™„ë£Œ')) {
                // ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì•„ì•¼ í•˜ì§€ë§Œ, ì„ì‹œë¡œ ì €ì¥ëœ í”„ë¡œí•„ ì‚¬ìš©
                const profile = StorageManager.profile.get();
                if (profile.topic || profile.constraints || profile.goal) {
                    updateLearningProfile(profile.topic, profile.constraints, profile.goal);
                }
            }
        }

        // ì»¤ë¦¬í˜ëŸ¼ ìƒì„± í•¨ìˆ˜
        async function generateCurriculum() {
            const generateBtn = document.getElementById('generateCurriculumBtn');
            const durationSelect = document.getElementById('learningDuration');
            
            if (!generateBtn || !durationSelect) {
                console.error('ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const selectedDuration = durationSelect.value;
            console.log(`ğŸš€ ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ì‹œì‘ - ê¸°ê°„: ${selectedDuration}ê°œì›”`);
            
            // 1. ìƒì„± ìƒíƒœ ì‹œì‘
            isGeneratingCurriculum = true;
            
            // 2. ë¨¼ì € "ë‚˜ì˜ ì»¤ë¦¬í˜ëŸ¼" íƒ­ìœ¼ë¡œ ì´ë™
            switchToTab('curriculum');
            
            // 3. ë¡œë”© ìƒíƒœ í‘œì‹œ
            const curriculumContent = document.getElementById('curriculumContent');
            if (curriculumContent) {
                displayLoadingState(curriculumContent);
            }
            
            // 4. ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© ìƒíƒœ
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ì¤‘...';
            
            try {
                // ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ìš”ì²­ ë©”ì‹œì§€ë¥¼ ì…ë ¥ í•„ë“œì— ì„¤ì •í•˜ê³  ì „ì†¡
                const curriculumMessage = `${selectedDuration}ê°œì›” í•™ìŠµ ê¸°ê°„ìœ¼ë¡œ ë§ì¶¤í˜• ì»¤ë¦¬í˜ëŸ¼ì„ ìƒì„±í•´ì£¼ì„¸ìš”.`;
                messageInput.value = curriculumMessage;
                
                // ì¼ë°˜ sendMessage í•¨ìˆ˜ í˜¸ì¶œ
                await sendMessage();
                
                // ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì‹  í”Œë˜ê·¸
                window.curriculumDataReceived = false;
                
                console.log('âœ… ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ìš”ì²­ ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ì˜¤ë¥˜:', error);
                isGeneratingCurriculum = false;
                showNotification('ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
                
                // ì—ëŸ¬ ë°œìƒ ì‹œ ì»¤ë¦¬í˜ëŸ¼ í˜ì´ì§€ ë³µì›
                const curriculumContent = document.getElementById('curriculumContent');
                if (curriculumContent) {
                    showCurriculumContent(curriculumContent);
                }
                
            } finally {
                // ë²„íŠ¼ ë³µì›
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fas fa-magic"></i> ë§ì¶¤í˜• ì»¤ë¦¬í˜ëŸ¼ ìƒì„±';
            }
        }

        // ì»¤ë¦¬í˜ëŸ¼ ì™„ë£Œ ìƒíƒœë¥¼ ë‹¤ì‹œ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
        async function checkCurriculumCompletion() {
            console.log('ğŸ” ì»¤ë¦¬í˜ëŸ¼ ì™„ë£Œ ìƒíƒœ ì¬í™•ì¸ ì‹œì‘');
            
            try {
                // ìµœê·¼ ìƒì„±ëœ ì»¤ë¦¬í˜ëŸ¼ í™•ì¸
                const curriculumData = StorageManager.curriculum.get();
                if (curriculumData) {
                    console.log('âœ… ì»¤ë¦¬í˜ëŸ¼ ë°œê²¬ - ìƒì„± ì™„ë£Œ ì²˜ë¦¬');
                    
                    // ìƒì„± ì™„ë£Œ í”Œë˜ê·¸ í•´ì œ
                    isGeneratingCurriculum = false;
                    
                    // ì»¤ë¦¬í˜ëŸ¼ í‘œì‹œ
                    const curriculumContent = document.getElementById('curriculumContent');
                    if (curriculumContent) {
                        displayCurriculumCards(curriculumContent, curriculumData);
                        showNotification('ì»¤ë¦¬í˜ëŸ¼ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    }
                    
                    return;
                }
                
                // ì‹¤ì‹œê°„ í™•ì¸ë§Œ ìˆ˜í–‰ (íƒ€ì„ì•„ì›ƒ ì œê±°)
                console.log('â³ ì»¤ë¦¬í˜ëŸ¼ ìƒì„±ì„ ê³„ì† ê¸°ë‹¤ë¦½ë‹ˆë‹¤ (íƒ€ì„ì•„ì›ƒ ì—†ìŒ)');
                
            } catch (error) {
                console.error('ì»¤ë¦¬í˜ëŸ¼ ì™„ë£Œ í™•ì¸ ì˜¤ë¥˜:', error);
                isGeneratingCurriculum = false;
            }
        }
        
        // ì»¤ë¦¬í˜ëŸ¼ ë°ì´í„°ë¥¼ í™”ë©´ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
        function displayCurriculumData(curriculumData) {
            try {
                console.log('ğŸ”„ displayCurriculumData í˜¸ì¶œë¨:', curriculumData.title);
                
                // ì €ì¥ëœ ë°ì´í„° ë‹¤ì‹œ í™•ì¸
                const storedData = StorageManager.curriculum.get();
                if (storedData) {
                    console.log('ğŸ“¦ ì €ì¥ëœ ì»¤ë¦¬í˜ëŸ¼ í™•ì¸:', storedData.title);
                }
                
                // ì»¤ë¦¬í˜ëŸ¼ í˜ì´ì§€ì— ì§ì ‘ í‘œì‹œ (localStorage ì¬ì½ê¸° ë°©ì§€)
                const curriculumContent = document.getElementById('curriculumContent');
                if (curriculumContent) {
                    console.log('ğŸ–¥ï¸ displayCurriculumCards ì§ì ‘ í˜¸ì¶œ');
                    displayCurriculumCards(curriculumContent, curriculumData);
                } else {
                    console.log('âŒ curriculumContent ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
                
                console.log('âœ… ì»¤ë¦¬í˜ëŸ¼ ë°ì´í„° í‘œì‹œ ì™„ë£Œ:', curriculumData.title);
            } catch (error) {
                console.error('âŒ ì»¤ë¦¬í˜ëŸ¼ í‘œì‹œ ì˜¤ë¥˜:', error);
                showNotification('ì»¤ë¦¬í˜ëŸ¼ í‘œì‹œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            updateUserDisplay(); // í˜ì´ì§€ ë¡œë“œì‹œ ì´ë¦„ ì—…ë°ì´íŠ¸
            loadUserProfile();
            setupNavigation();
            
            // ìƒˆ ì„¸ì…˜ì¸ì§€ í™•ì¸ (ì¿ í‚¤ì˜ ì„¸ì…˜ IDê°€ ë°©ê¸ˆ ìƒì„±ë˜ì—ˆëŠ”ì§€)
            const currentSessionId = getCookie('session_id');
            const isNewSession = StorageManager.session.isNew(currentSessionId);
            
            if (isNewSession) {
                console.log('ğŸ†• ìƒˆ ì„¸ì…˜ ê°ì§€ - í”„ë¡œí•„ ë° ë°ì´í„° ì´ˆê¸°í™”');
                // ìƒˆ ì„¸ì…˜ì´ë©´ ì´ì „ ë°ì´í„° ì™„ì „ ì´ˆê¸°í™”
                StorageManager.profile.clear();
                StorageManager.curriculum.clear();
                StorageManager.curriculum.progress.clear();
                updateLearningProfile('', '', '');
                
                // í˜„ì¬ ì„¸ì…˜ ID ì €ì¥
                StorageManager.session.setId(currentSessionId);
            } else {
                console.log('ğŸ”„ ê¸°ì¡´ ì„¸ì…˜ ë³µì›');
                // ê¸°ì¡´ ì„¸ì…˜ì´ë©´ í”„ë¡œí•„ ë³µì›
                const existingProfile = StorageManager.profile.get();
                if (existingProfile.topic || existingProfile.constraints || existingProfile.goal) {
                    updateLearningProfile(existingProfile.topic, existingProfile.constraints, existingProfile.goal);
                    console.log('ğŸ”„ ê¸°ì¡´ í”„ë¡œí•„ ë³µì›:', existingProfile);
                } else {
                    updateLearningProfile('', '', '');
                }
            }
            
            // ìƒì„± ìƒíƒœ ì´ˆê¸°í™”
            isGeneratingCurriculum = false;
            
            // ê¸°ë³¸ í˜ì´ì§€ë¥¼ ë§ì¶¤í˜• í•™ìŠµ ì¶”ì²œìœ¼ë¡œ ì„¤ì •
            navigateToPage('chat');
            
            // ì»¤ë¦¬í˜ëŸ¼ì´ ìˆë‹¤ë©´ ì±„íŒ… í˜ì´ì§€ì—ì„œë„ í‘œì‹œ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
            if (existingCurriculum) {
                console.log('ğŸ“š ê¸°ì¡´ ì»¤ë¦¬í˜ëŸ¼ ë°ì´í„° í™•ì¸ë¨');
            }
        });

        // ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì •
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // ì¦‰ì‹œ í˜ì´ì§€ ìµœìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    
                    // í™œì„± ìƒíƒœ ë³€ê²½
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    const page = this.dataset.page;
                    navigateToPage(page);
                });
            });
        }

        // íƒ­ ì „í™˜ í•¨ìˆ˜ (í”„ë¡œê·¸ë˜ë° ë°©ì‹)
        function switchToTab(tabName) {
            const navLinks = document.querySelectorAll('.nav-link');
            
            // ëª¨ë“  íƒ­ì˜ í™œì„± ìƒíƒœ ì œê±°
            navLinks.forEach(link => link.classList.remove('active'));
            
            // í•´ë‹¹ íƒ­ í™œì„±í™”
            const targetTab = document.querySelector(`[data-page="${tabName}"]`);
            if (targetTab) {
                targetTab.classList.add('active');
                navigateToPage(tabName);
                
                // í˜ì´ì§€ ìµœìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜
        function navigateToPage(page) {
            // í˜ì´ì§€ ì „í™˜ ì‹œ í•­ìƒ ìµœìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            const welcomeSubtitle = document.getElementById('welcomeSubtitle');
            const initialMessage = document.getElementById('initialMessage');
            
            // ëª¨ë“  ë™ì ìœ¼ë¡œ ìƒì„±ëœ ì„¹ì…˜ë“¤ ì œê±° (ë©˜í†  í”„ë¡œí•„ ì„¹ì…˜ ë“±)
            const mentorProfileSection = document.getElementById('mentorProfileSection');
            if (mentorProfileSection) {
                mentorProfileSection.remove();
            }
            
            // AI ë©˜í†  í˜ì´ì§€ê°€ ì•„ë‹Œ ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì´ë™í•  ë•Œ ë©˜í†  ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
            if (page !== 'profile') {
                // ì„ íƒëœ ë©˜í†  ëª©ë¡ ì´ˆê¸°í™”
                selectedMentors = [];
                finalSelectedMentors = [];
                
                // ë©˜í†  ì„ íƒ ì •ë³´ ì œê±°
                StorageManager.mentors.clear();
                
                // ë©˜í†  ì„ íƒ í‘œì‹œ ì˜ì—­ ì´ˆê¸°í™”
                const selectedMentorsDisplay = document.getElementById('selectedMentors');
                if (selectedMentorsDisplay) {
                    selectedMentorsDisplay.innerHTML = '<div style="color: #6b7280; font-size: 14px;">ì„ íƒëœ ë©˜í† ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>';
                }
                
                // ëª¨ë“  ë©˜í†  ì¹´ë“œì˜ ì„ íƒ ìƒíƒœ ì œê±°
                const mentorCards = document.querySelectorAll('.mentor-card');
                mentorCards.forEach(card => {
                    card.style.borderColor = '#e5e7eb';
                    card.style.background = 'white';
                });
            }
            
            if (page === 'datasource') {
                // í•™ìŠµ ë°ì´í„° ì›ì²œ ëª¨ë“œ
                welcomeSubtitle.innerHTML = '<span class="highlight">í•™ìŠµ ë°ì´í„° ì›ì²œ</span> ê´€ë¦¬';
                
                // ëŒ€í™”ì°½ê³¼ í”„ë¡œí•„ ì˜ì—­ ìˆ¨ê¸°ê¸°
                const chatWithProfile = document.querySelector('.chat-with-profile');
                const examplesSection = document.querySelector('.examples-section');
                const curriculumContent = document.getElementById('curriculumContent');
                const mentorContent = document.getElementById('mentorContent');
                
                if (chatWithProfile) chatWithProfile.style.display = 'none';
                if (examplesSection) examplesSection.style.display = 'none';
                if (curriculumContent) curriculumContent.style.display = 'none';
                if (mentorContent) mentorContent.style.display = 'none';
                
                // ë°ì´í„° ì›ì²œ ì»¨í…ì¸  ì˜ì—­ ìƒì„± ë˜ëŠ” í‘œì‹œ
                let datasourceContent = document.getElementById('datasourceContent');
                if (!datasourceContent) {
                    datasourceContent = document.createElement('div');
                    datasourceContent.id = 'datasourceContent';
                    datasourceContent.style.cssText = `
                        width: 900px;
                        background: white;
                        border-radius: 16px;
                        box-shadow: 0 4px 24px rgba(0,0,0,0.1);
                        padding: 40px;
                        margin: 20px 0;
                    `;
                    
                    const welcomeSection = document.querySelector('.welcome-section');
                    welcomeSection.parentNode.insertBefore(datasourceContent, welcomeSection.nextSibling);
                }
                
                // ë°ì´í„° ì›ì²œ UI ë‚´ìš©
                datasourceContent.innerHTML = `
                    <div style="margin-bottom: 30px;">
                        <h2 style="font-size: 24px; font-weight: 700; color: #1f2937; margin-bottom: 10px;">
                            ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ë°ì´í„° ì›ì²œ
                        </h2>
                        <p style="color: #6b7280; font-size: 14px;">
                            AIê°€ ë§ì¶¤í˜• ì»¤ë¦¬í˜ëŸ¼ì„ ìƒì„±í•  ë•Œ ì°¸ê³ í•˜ëŠ” ë°ì´í„° ì†ŒìŠ¤ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.
                        </p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
                        <!-- ì‚¬ë‚´ ë¬¸ì„œ -->
                        <div style="
                            background: white;
                            padding: 25px;
                            border-radius: 12px;
                            border: 1px solid #e5e7eb;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                            position: relative;
                            overflow: hidden;
                        ">
                            <i class="fas fa-file-alt" style="font-size: 32px; margin-bottom: 15px; color: #667eea;"></i>
                            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px; color: #1f2937;">ì‚¬ë‚´ ë¬¸ì„œ</h3>
                            <p style="font-size: 13px; color: #6b7280; margin-bottom: 15px;">ê¸°ìˆ  ë¬¸ì„œ, ê°€ì´ë“œë¼ì¸, ë§¤ë‰´ì–¼</p>
                            
                            <!-- íŒŒì¼ í˜•ì‹ ì•„ì´ì½˜ë“¤ -->
                            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                <div style="
                                    width: 45px;
                                    height: 45px;
                                    background: #f3f4f6;
                                    border-radius: 50%;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                                ">
                                    <i class="fas fa-file-pdf" style="color: #DC2626; font-size: 20px;"></i>
                                </div>
                                <div style="
                                    width: 45px;
                                    height: 45px;
                                    background: #f3f4f6;
                                    border-radius: 50%;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                                ">
                                    <i class="fas fa-file-powerpoint" style="color: #EA580C; font-size: 20px;"></i>
                                </div>
                            </div>
                            
                            <div style="
                                background: #f3f4f6;
                                padding: 8px 12px;
                                border-radius: 8px;
                                font-size: 12px;
                                display: inline-block;
                                color: #4b5563;
                            ">
                                <i class="fas fa-check-circle" style="color: #10b981;"></i> 127ê°œ ì—°ë™ë¨
                            </div>
                        </div>
                        
                        <!-- êµìœ¡ ì˜ìƒ -->
                        <div style="
                            background: white;
                            padding: 25px;
                            border-radius: 12px;
                            border: 1px solid #e5e7eb;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                        ">
                            <i class="fas fa-video" style="font-size: 32px; margin-bottom: 15px; color: #8b5cf6;"></i>
                            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px; color: #1f2937;">êµìœ¡ ì˜ìƒ</h3>
                            <p style="font-size: 13px; color: #6b7280; margin-bottom: 15px;">ì‚¬ë‚´ êµìœ¡ ì½˜í…ì¸ , ì›¨ë¹„ë‚˜</p>
                            
                            <!-- K-MOOC ë¡œê³  -->
                            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                <div style="
                                    width: 45px;
                                    height: 45px;
                                    background: #f3f4f6;
                                    border-radius: 50%;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                                    font-weight: 700;
                                    font-size: 10px;
                                    color: #1E40AF;
                                ">
                                    K-MOOC
                                </div>
                            </div>
                            
                            <div style="
                                background: #f3f4f6;
                                padding: 8px 12px;
                                border-radius: 8px;
                                font-size: 12px;
                                display: inline-block;
                                color: #4b5563;
                            ">
                                <i class="fas fa-check-circle" style="color: #10b981;"></i> 1ê°œ ì—°ë™ë¨
                            </div>
                        </div>
                        
                        <!-- ì™¸ë¶€ ì›¹ -->
                        <div style="
                            background: white;
                            padding: 25px;
                            border-radius: 12px;
                            border: 1px solid #e5e7eb;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                        ">
                            <i class="fas fa-globe" style="font-size: 32px; margin-bottom: 15px; color: #a78bfa;"></i>
                            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px; color: #1f2937;">ì™¸ë¶€ ì›¹</h3>
                            <p style="font-size: 13px; color: #6b7280; margin-bottom: 15px;">ê³µì‹ ë¬¸ì„œ, íŠœí† ë¦¬ì–¼, ë¸”ë¡œê·¸</p>
                            
                            <!-- DuckDuckGo ë¡œê³  -->
                            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                <div style="
                                    width: 45px;
                                    height: 45px;
                                    background: #f3f4f6;
                                    border-radius: 50%;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                                    padding: 8px;
                                ">
                                    <img src="https://upload.wikimedia.org/wikipedia/en/thumb/8/88/DuckDuckGo_logo.svg/1200px-DuckDuckGo_logo.svg.png" 
                                         alt="DuckDuckGo" 
                                         style="width: 100%; height: 100%; object-fit: contain;"
                                    />
                                </div>
                            </div>
                            
                            <div style="
                                background: #f3f4f6;
                                padding: 8px 12px;
                                border-radius: 8px;
                                font-size: 12px;
                                display: inline-block;
                                color: #4b5563;
                            ">
                                <i class="fas fa-check-circle" style="color: #10b981;"></i> 1ê°œ ì—°ë™ë¨
                            </div>
                        </div>
                    </div>
                    
                    <!-- ìµœê·¼ ì—…ë°ì´íŠ¸ -->
                    <div style="
                        background: #f9fafb;
                        padding: 25px;
                        border-radius: 12px;
                        border: 1px solid #e5e7eb;
                    ">
                        <h3 style="font-size: 16px; font-weight: 600; color: #374151; margin-bottom: 15px;">
                            <i class="fas fa-sync-alt" style="margin-right: 8px; color: #6366f1;"></i>
                            ìµœê·¼ ì—…ë°ì´íŠ¸ëœ ë°ì´í„°
                        </h3>
                        <div style="space-y: 10px;">
                            <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e5e7eb;">
                                <span style="color: #4b5563; font-size: 14px;">
                                    <i class="fas fa-file-alt" style="color: #667eea; margin-right: 8px;"></i>
                                    Python ê°œë°œ ê°€ì´ë“œ v2.1
                                </span>
                                <span style="color: #9ca3af; font-size: 12px;">2ì‹œê°„ ì „</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e5e7eb;">
                                <span style="color: #4b5563; font-size: 14px;">
                                    <i class="fas fa-video" style="color: #f5576c; margin-right: 8px;"></i>
                                    React 18 ë§ˆì´ê·¸ë ˆì´ì…˜ ì›¨ë¹„ë‚˜
                                </span>
                                <span style="color: #9ca3af; font-size: 12px;">5ì‹œê°„ ì „</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 10px 0;">
                                <span style="color: #4b5563; font-size: 14px;">
                                    <i class="fas fa-globe" style="color: #00f2fe; margin-right: 8px;"></i>
                                    AWS Lambda ê³µì‹ ë¬¸ì„œ
                                </span>
                                <span style="color: #9ca3af; font-size: 12px;">1ì¼ ì „</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
                    <div style="margin-top: 30px; text-align: center; display: flex; gap: 15px; justify-content: center;">
                        <button style="
                            background: linear-gradient(135deg, #667eea, #764ba2);
                            color: white;
                            padding: 12px 30px;
                            border: none;
                            border-radius: 8px;
                            font-size: 15px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: transform 0.2s;
                            width: 220px;
                        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-plus-circle" style="margin-right: 8px;"></i>
                            ìƒˆ ë°ì´í„° ì›ì²œ ì¶”ê°€
                        </button>
                        
                        <button onclick="switchToTab('chat')" style="
                            background: linear-gradient(135deg, #a855f7, #ec4899);
                            color: white;
                            border: none;
                            padding: 12px 30px;
                            border-radius: 8px;
                            font-size: 15px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: transform 0.2s;
                            width: 220px;
                        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-bullseye" style="margin-right: 8px;"></i>
                            ë§ì¶¤í˜• í•™ìŠµ ì¶”ì²œ ì‹œì‘
                        </button>
                    </div>
                `;
                
                datasourceContent.style.display = 'block';
                return;
            } else if (page === 'chat') {
                // ë§ì¶¤í˜• í•™ìŠµ ì¶”ì²œ ëª¨ë“œ
                welcomeSubtitle.innerHTML = 'ì˜¤ëŠ˜ <span class="highlight">ë¬´ì—‡ì„</span> ë°°ìš°ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?';
                
                // ì´ˆê¸° ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
                const initialMessage = document.getElementById('initialMessage');
                if (initialMessage) {
                    initialMessage.textContent = 'ì•ˆë…•í•˜ì„¸ìš”! LearningMateì˜ í•™ìŠµ ë©˜í† ì…ë‹ˆë‹¤. ì–´ë–¤ ì£¼ì œì— ëŒ€í•´ ë°°ìš°ê³  ì‹¶ìœ¼ì‹ ì§€ ì•Œë ¤ì£¼ì„¸ìš”. ë§ì¶¤í˜• í•™ìŠµ ê³„íšì„ í•¨ê»˜ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.';
                }
                
                // ê¸°ì¡´ ì»¤ë¦¬í˜ëŸ¼ì´ ìˆë‹¤ë©´ ë³µì›
                const existingCurriculum = StorageManager.curriculum.get();
                if (existingCurriculum) {
                    try {
                        console.log('ğŸ”„ ì±„íŒ… í˜ì´ì§€ì—ì„œ ê¸°ì¡´ ì»¤ë¦¬í˜ëŸ¼ ë³µì›:', existingCurriculum.title);
                        
                        // ì»¤ë¦¬í˜ëŸ¼ ì»¨í…ì¸  ì˜ì—­ í™•ì¸/ìƒì„±
                        let curriculumContent = document.getElementById('curriculumContent');
                        if (!curriculumContent) {
                            curriculumContent = document.createElement('div');
                            curriculumContent.id = 'curriculumContent';
                            const welcomeSection = document.querySelector('.welcome-section');
                            welcomeSection.parentNode.insertBefore(curriculumContent, welcomeSection.nextSibling);
                        }
                        
                        // ì»¤ë¦¬í˜ëŸ¼ ì»¨í…ì¸ ë¥¼ ì „ì²´ í™”ë©´ ë ˆì´ì•„ì›ƒìœ¼ë¡œ ì„¤ì •
                        curriculumContent.style.cssText = `
                            width: 900px;
                            height: 600px;
                            background: white;
                            border-radius: 12px;
                            border: 1px solid #d1d5db;
                            margin: 20px 0;
                            position: relative;
                            display: block;
                            padding: 20px;
                        `;
                        
                        // ì»¤ë¦¬í˜ëŸ¼ í‘œì‹œ
                        showCurriculumContent(curriculumContent);
                        
                    } catch (e) {
                        console.error('ì»¤ë¦¬í˜ëŸ¼ ë³µì› ì˜¤ë¥˜:', e);
                    }
                }
                
                // ì±„íŒ… ê¸°ë¡ì´ ë¹„ì–´ìˆì„ ë•Œë§Œ ì´ˆê¸° ë©”ì‹œì§€ ì„¤ì •
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages) {
                    const existingMessages = chatMessages.querySelectorAll('.message');
                    
                    // ê¸°ë³¸ ì´ˆê¸° ë©”ì‹œì§€ë§Œ ìˆê±°ë‚˜ ë©”ì‹œì§€ê°€ ì•„ì˜ˆ ì—†ëŠ” ê²½ìš°ì—ë§Œ ì´ˆê¸°í™”
                    if (existingMessages.length <= 1) {
                        chatMessages.innerHTML = `
                            <div class="message ai-message">
                                <div class="message-avatar ai-avatar-small">AI</div>
                                <div class="message-content" id="initialMessage">
                                    ì•ˆë…•í•˜ì„¸ìš”! LearningMate ì…ë‹ˆë‹¤.<br>ì–´ë–¤ ì£¼ì œì— ëŒ€í•´ ë°°ìš°ê³  ì‹¶ìœ¼ì‹ ì§€ ì•Œë ¤ì£¼ì‹œë©´ ë§ì¶¤í˜• í•™ìŠµ ê³„íšì„ í•¨ê»˜ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤!
                                </div>
                            </div>
                        `;
                    }
                    // ì´ë¯¸ ëŒ€í™”ê°€ ì§„í–‰ ì¤‘ì´ë©´ ì±„íŒ… ê¸°ë¡ì„ ìœ ì§€
                }
                
                // ì…ë ¥ì°½ ì´ˆê¸°í™”
                const messageInput = document.getElementById('messageInput');
                if (messageInput) {
                    messageInput.value = '';
                    messageInput.style.height = 'auto';
                }
                
                // ê¸°ì¡´ í”„ë¡œí•„ì´ ìˆìœ¼ë©´ ë³µì›, ì—†ìœ¼ë©´ ì´ˆê¸°í™”
                const existingProfile = StorageManager.profile.get();
                if (existingProfile.topic || existingProfile.constraints || existingProfile.goal) {
                    updateLearningProfile(existingProfile.topic, existingProfile.constraints, existingProfile.goal);
                    console.log('ğŸ”„ ì±„íŒ… í˜ì´ì§€ì—ì„œ í”„ë¡œí•„ ë³µì›:', existingProfile);
                } else {
                    updateLearningProfile('', '', '');
                }
                
                // ëŒ€í™”ì°½ê³¼ í”„ë¡œí•„, ì˜ˆì‹œ ì˜ì—­ ë‹¤ì‹œ ë³´ì´ê¸°
                const chatWithProfile = document.querySelector('.chat-with-profile');
                const examplesSection = document.querySelector('.examples-section');
                const curriculumContent = document.getElementById('curriculumContent');
                const datasourceContent = document.getElementById('datasourceContent');
                const mentorContent = document.getElementById('mentorContent');
                
                if (chatWithProfile) chatWithProfile.style.display = 'flex';
                if (examplesSection) examplesSection.style.display = 'block';
                if (curriculumContent) curriculumContent.style.display = 'none';
                if (datasourceContent) datasourceContent.style.display = 'none';
                if (mentorContent) mentorContent.style.display = 'none';
                
                return;
            } else if (page === 'profile') {
                // AI ë©˜í†  ëª¨ë“œ
                welcomeSubtitle.innerHTML = 'ì–´ë–¤ ë¶„ì•¼ì˜ <span class="highlight">ë©˜í† ê°€</span> í•„ìš”í•˜ì‹ ê°€ìš”?';
                
                // ê¸°ì¡´ ìš”ì†Œë“¤ ìˆ¨ê¸°ê¸°
                const chatWithProfile = document.querySelector('.chat-with-profile');
                const examplesSection = document.querySelector('.examples-section');
                const curriculumContent = document.getElementById('curriculumContent');
                const datasourceContent = document.getElementById('datasourceContent');
                
                if (chatWithProfile) chatWithProfile.style.display = 'none';
                if (examplesSection) examplesSection.style.display = 'none';
                if (curriculumContent) curriculumContent.style.display = 'none';
                if (datasourceContent) datasourceContent.style.display = 'none';
                
                // AI ë©˜í†  ì„ íƒ UI ìƒì„±
                let mentorContent = document.getElementById('mentorContent');
                if (!mentorContent) {
                    mentorContent = document.createElement('div');
                    mentorContent.id = 'mentorContent';
                    mentorContent.style.cssText = `
                        width: 900px;
                        background: white;
                        border-radius: 16px;
                        box-shadow: 0 4px 24px rgba(0,0,0,0.1);
                        padding: 40px;
                        margin: 20px 0;
                    `;
                    
                    const welcomeSection = document.querySelector('.welcome-section');
                    welcomeSection.parentNode.insertBefore(mentorContent, welcomeSection.nextSibling);
                }
                
                mentorContent.innerHTML = `
                    <!-- ìì—°ì–´ ì§ˆë¬¸ ì„¹ì…˜ -->
                    <div style="margin-bottom: 40px;">
                        <div style="
                            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
                            border: 1px solid #e2e8f0;
                            border-radius: 12px;
                            padding: 20px;
                            margin-bottom: 20px;
                        ">
                            <label style="
                                display: block;
                                font-size: 16px;
                                font-weight: 600;
                                color: #374151;
                                margin-bottom: 12px;
                                text-align: center;
                            ">ìì—°ì–´ë¡œ ê³ ë¯¼ì´ë‚˜ ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</label>
                            <textarea 
                                id="naturalQuestionInput"
                                placeholder="ì˜ˆ: íŒŒì´ì¬ìœ¼ë¡œ ì›¹ ê°œë°œì„ ë°°ìš°ê³  ì‹¶ì€ë° ì–´ë–»ê²Œ ì‹œì‘í•´ì•¼ í• ì§€ ëª¨ë¥´ê² ì–´ìš”"
                                style="
                                    width: 100%;
                                    min-height: 80px;
                                    padding: 15px;
                                    border: 2px solid #e5e7eb;
                                    border-radius: 8px;
                                    font-size: 14px;
                                    resize: vertical;
                                    outline: none;
                                    transition: border-color 0.2s;
                                "
                                onfocus="this.style.borderColor='#667eea'"
                                onblur="this.style.borderColor='#e5e7eb'"
                            ></textarea>
                            <div style="text-align: center; margin-top: 12px;">
                                <button onclick="findMentorByQuestion()" style="
                                    background: linear-gradient(135deg, #667eea, #764ba2);
                                    color: white;
                                    border: none;
                                    padding: 12px 24px;
                                    border-radius: 8px;
                                    font-size: 14px;
                                    font-weight: 600;
                                    cursor: pointer;
                                    transition: transform 0.2s;
                                " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                    <i class="fas fa-search" style="margin-right: 8px;"></i>
                                    ì í•©í•œ ë©˜í†  ì°¾ê¸°
                                </button>
                            </div>
                        </div>
                        
                        <div style="text-align: center; color: #6b7280; font-size: 14px; margin: 20px 0;">
                            ë˜ëŠ”
                        </div>
                    </div>
                    
                    <!-- ë©˜í†  ì§ì ‘ ì„ íƒ ì„¹ì…˜ -->
                    <div>
                        <h3 style="font-size: 18px; font-weight: 600; color: #374151; margin-bottom: 20px; text-align: center;">
                            ì§ì ‘ í•„ìš”í•œ ë¶„ì•¼ì˜ ë©˜í† ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”
                        </h3>
                        
                        <!-- ì¶”ì²œëœ í˜ë¥´ì†Œë‚˜ í‘œì‹œ ì˜ì—­ -->
                        <div id="recommendedPersonas" style="display: none; margin-bottom: 30px;">
                            <h3 style="font-size: 18px; font-weight: 600; color: #374151; margin-bottom: 20px; text-align: center;">
                                <i class="fas fa-lightbulb" style="color: #f59e0b; margin-right: 8px;"></i>
                                ì¶”ì²œëœ ì „ë¬¸ ë©˜í† 
                            </h3>
                            <div id="recommendedPersonasList" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin-bottom: 20px;">
                                <!-- ì¶”ì²œëœ í˜ë¥´ì†Œë‚˜ë“¤ì´ ë™ì ìœ¼ë¡œ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                            </div>
                            <div style="text-align: center; margin: 20px 0;">
                                <p style="color: #6b7280; font-size: 14px; margin-bottom: 12px;">
                                    ì¶”ì²œëœ ë©˜í†  ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ê±°ë‚˜, ì•„ë˜ì—ì„œ ì§ì ‘ ë‹¤ë¥¸ ë¶„ì•¼ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”
                                </p>
                                <button onclick="hideRecommendedPersonas()" style="
                                    background: #f3f4f6;
                                    color: #6b7280;
                                    border: 1px solid #d1d5db;
                                    padding: 8px 16px;
                                    border-radius: 6px;
                                    font-size: 12px;
                                    cursor: pointer;
                                    transition: all 0.2s;
                                " onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f3f4f6'">
                                    ì¶”ì²œ ê²°ê³¼ ìˆ¨ê¸°ê¸°
                                </button>
                            </div>
                        </div>
                        
                        <!-- ë©˜í†  ë¦¬ìŠ¤íŠ¸ (ê¸°ì¡´ 6ê°œ ë©˜í† ) -->
                        <div id="mentorList" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
                            <!-- ì—…ë¬´ ê³¼ì™¸ ì„ ìƒë‹˜ -->
                            <div class="mentor-card" data-mentor="engineer" draggable="true" style="
                                background: white;
                                border: 2px solid #e5e7eb;
                                border-radius: 12px;
                                padding: 20px;
                                cursor: grab;
                                transition: all 0.2s;
                                text-align: center;
                            " onmouseover="this.style.borderColor='#667eea'; this.style.transform='translateY(-2px)'" 
                               onmouseout="this.style.borderColor='#e5e7eb'; this.style.transform='translateY(0)'"
                               onclick="selectMentor('engineer')">
                                <div style="margin-bottom: 12px; width: 48px; height: 48px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px;">
                                    <i class="fas fa-briefcase" style="color: white; font-size: 20px;"></i>
                                </div>
                                <h4 style="font-size: 16px; font-weight: 600; color: #374151; margin-bottom: 8px;">ì—…ë¬´ ê³¼ì™¸ ì„ ìƒë‹˜</h4>
                                <p style="font-size: 12px; color: #6b7280; line-height: 1.4;">
                                    ì‹¤ë¬´ í˜„ì¥ì—ì„œ ë°”ë¡œ í™œìš©í•  ìˆ˜ ìˆëŠ” ì‹¤ìš©ì ì¸ ìŠ¤í‚¬ì„ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤
                                </p>
                            </div>
                            
                            <!-- ì¼íƒ€ ê°•ì‚¬ -->
                            <div class="mentor-card" data-mentor="executive" draggable="true" style="
                                background: white;
                                border: 2px solid #e5e7eb;
                                border-radius: 12px;
                                padding: 20px;
                                cursor: grab;
                                transition: all 0.2s;
                                text-align: center;
                            " onmouseover="this.style.borderColor='#667eea'; this.style.transform='translateY(-2px)'" 
                               onmouseout="this.style.borderColor='#e5e7eb'; this.style.transform='translateY(0)'"
                               onclick="selectMentor('executive')">
                                <div style="margin-bottom: 12px; width: 48px; height: 48px; background: linear-gradient(135deg, #a855f7, #ec4899); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px;">
                                    <i class="fas fa-star" style="color: white; font-size: 20px;"></i>
                                </div>
                                <h4 style="font-size: 16px; font-weight: 600; color: #374151; margin-bottom: 8px;">ì¼íƒ€ ê°•ì‚¬</h4>
                                <p style="font-size: 12px; color: #6b7280; line-height: 1.4;">
                                    ê° ë¶„ì•¼ë³„ ì „ë¬¸ê°€ë¡œì„œ í•µì‹¬ë§Œ ì™ì™ ë½‘ì•„ ëª…ì¾Œí•˜ê²Œ ì„¤ëª…í•´ë“œë¦½ë‹ˆë‹¤
                                </p>
                            </div>
                            
                            <!-- êµìˆ˜ -->
                            <div class="mentor-card" data-mentor="professor" draggable="true" style="
                                background: white;
                                border: 2px solid #e5e7eb;
                                border-radius: 12px;
                                padding: 20px;
                                cursor: grab;
                                transition: all 0.2s;
                                text-align: center;
                            " onmouseover="this.style.borderColor='#667eea'; this.style.transform='translateY(-2px)'" 
                               onmouseout="this.style.borderColor='#e5e7eb'; this.style.transform='translateY(0)'"
                               onclick="selectMentor('professor')">
                                <div style="margin-bottom: 12px; width: 48px; height: 48px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px;">
                                    <i class="fas fa-graduation-cap" style="color: white; font-size: 20px;"></i>
                                </div>
                                <h4 style="font-size: 16px; font-weight: 600; color: #374151; margin-bottom: 8px;">êµìˆ˜</h4>
                                <p style="font-size: 12px; color: #6b7280; line-height: 1.4;">
                                    í•™ë¬¸ì  ê¹Šì´ ìˆëŠ” ì„¤ëª…ê³¼ ì²´ê³„ì ì¸ í•™ìŠµ ë°©ë²•ì„ ì œì‹œí•©ë‹ˆë‹¤
                                </p>
                            </div>
                            
                            <!-- ê°œë°œì -->
                            <div class="mentor-card" data-mentor="designer" draggable="true" style="
                                background: white;
                                border: 2px solid #e5e7eb;
                                border-radius: 12px;
                                padding: 20px;
                                cursor: grab;
                                transition: all 0.2s;
                                text-align: center;
                            " onmouseover="this.style.borderColor='#667eea'; this.style.transform='translateY(-2px)'" 
                               onmouseout="this.style.borderColor='#e5e7eb'; this.style.transform='translateY(0)'"
                               onclick="selectMentor('designer')">
                                <div style="margin-bottom: 12px; width: 48px; height: 48px; background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px;">
                                    <i class="fas fa-code" style="color: white; font-size: 20px;"></i>
                                </div>
                                <h4 style="font-size: 16px; font-weight: 600; color: #374151; margin-bottom: 8px;">ê°œë°œì</h4>
                                <p style="font-size: 12px; color: #6b7280; line-height: 1.4;">
                                    ì½”ë”©ê³¼ ê°œë°œ ì‹¤ë¬´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì²´ê³„ì ì¸ í”„ë¡œê·¸ë˜ë°ì„ ê°€ë¥´ì³ë“œë¦½ë‹ˆë‹¤
                                </p>
                            </div>
                            
                            <!-- Data Scientist -->
                            <div class="mentor-card" data-mentor="datascientist" draggable="true" style="
                                background: white;
                                border: 2px solid #e5e7eb;
                                border-radius: 12px;
                                padding: 20px;
                                cursor: grab;
                                transition: all 0.2s;
                                text-align: center;
                            " onmouseover="this.style.borderColor='#667eea'; this.style.transform='translateY(-2px)'" 
                               onmouseout="this.style.borderColor='#e5e7eb'; this.style.transform='translateY(0)'"
                               onclick="selectMentor('datascientist')">
                                <div style="margin-bottom: 12px; width: 48px; height: 48px; background: linear-gradient(135deg, #3b82f6, #1d4ed8); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px;">
                                    <i class="fas fa-language" style="color: white; font-size: 20px;"></i>
                                </div>
                                <h4 style="font-size: 16px; font-weight: 600; color: #374151; margin-bottom: 8px;">ì˜ì–´ ì„ ìƒë‹˜</h4>
                                <p style="font-size: 12px; color: #6b7280; line-height: 1.4;">
                                    ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ì–´ì™€ ì‹¤ë¬´ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ìŠ¤í‚¬ì„ ê°€ë¥´ì³ë“œë¦½ë‹ˆë‹¤
                                </p>
                            </div>
                            
                            <!-- Marketing -->
                            <div class="mentor-card" data-mentor="marketing" draggable="true" style="
                                background: white;
                                border: 2px solid #e5e7eb;
                                border-radius: 12px;
                                padding: 20px;
                                cursor: grab;
                                transition: all 0.2s;
                                text-align: center;
                            " onmouseover="this.style.borderColor='#667eea'; this.style.transform='translateY(-2px)'" 
                               onmouseout="this.style.borderColor='#e5e7eb'; this.style.transform='translateY(0)'"
                               onclick="selectMentor('marketing')">
                                <div style="margin-bottom: 12px; width: 48px; height: 48px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px;">
                                    <i class="fas fa-magic" style="color: white; font-size: 20px;"></i>
                                </div>
                                <h4 style="font-size: 16px; font-weight: 600; color: #374151; margin-bottom: 8px;">ëª…ë¦¬í•™ì</h4>
                                <p style="font-size: 12px; color: #6b7280; line-height: 1.4;">
                                    ì§ì¥ ìƒí™œ ìš´ì„¸ì™€ ì¸ê°„ê´€ê³„ë¥¼ ëª…ë¦¬í•™ìœ¼ë¡œ ì¬ë¯¸ìˆê²Œ í’€ì–´ë“œë¦½ë‹ˆë‹¤
                                </p>
                            </div>
                        </div>
                        
                        <!-- ì„ íƒëœ ë©˜í† ë“¤ í‘œì‹œ ì˜ì—­ -->
                        <div id="selectedMentors" style="
                            min-height: 100px;
                            border: 2px dashed #d1d5db;
                            border-radius: 12px;
                            padding: 20px;
                            background: #f9fafb;
                            text-align: center;
                            margin-bottom: 20px;
                        ">
                            <div style="color: #6b7280; font-size: 14px;">
                                ì„ íƒëœ ë©˜í† ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤
                            </div>
                        </div>
                        
                        <!-- ì‹œì‘ ë²„íŠ¼ -->
                        <div style="text-align: center;">
                            <button id="startMentoringBtn" onclick="startMentoring()" style="
                                background: linear-gradient(135deg, #a855f7, #ec4899);
                                color: white;
                                border: none;
                                padding: 15px 40px;
                                border-radius: 10px;
                                font-size: 16px;
                                font-weight: 600;
                                cursor: pointer;
                                transition: transform 0.2s;
                                opacity: 0.5;
                                pointer-events: none;
                            " onmouseover="if(!this.disabled) this.style.transform='scale(1.05)'" 
                               onmouseout="this.style.transform='scale(1)'">
                                <i class="fas fa-play" style="margin-right: 8px;"></i>
                                ë©˜í†  ì„ íƒ
                            </button>
                        </div>
                    </div>
                `;
                
                mentorContent.style.display = 'block';
                return;
            } else if (page === 'curriculum') {
                // ë‚˜ì˜ ì»¤ë¦¬í˜ëŸ¼ ëª¨ë“œ  
                welcomeSubtitle.innerHTML = '<span class="highlight">ë‚˜ì˜ ì»¤ë¦¬í˜ëŸ¼</span>';
                
                // ì»¤ë¦¬í˜ëŸ¼ íƒ­ ì§„ì… ì‹œ ì™„ì„±ëœ ì»¤ë¦¬í˜ëŸ¼ì´ ìˆëŠ”ì§€ë§Œ í™•ì¸
                const existingCurriculum = StorageManager.curriculum.get();
                if (existingCurriculum && isGeneratingCurriculum) {
                    console.log('ğŸ”„ ì»¤ë¦¬í˜ëŸ¼ íƒ­ ì§„ì… - ì™„ì„±ëœ ì»¤ë¦¬í˜ëŸ¼ ë°œê²¬');
                    isGeneratingCurriculum = false; // í”Œë˜ê·¸ í•´ì œ
                }
                
                // ëŒ€í™”ì°½ê³¼ í”„ë¡œí•„ ì˜ì—­ ìˆ¨ê¸°ê¸°
                const chatWithProfile = document.querySelector('.chat-with-profile');
                const examplesSection = document.querySelector('.examples-section');
                const datasourceContent = document.getElementById('datasourceContent');
                const mentorContent = document.getElementById('mentorContent');
                
                if (chatWithProfile) chatWithProfile.style.display = 'none';
                if (examplesSection) examplesSection.style.display = 'none';
                if (datasourceContent) datasourceContent.style.display = 'none';
                if (mentorContent) mentorContent.style.display = 'none';
                
                // ì»¤ë¦¬í˜ëŸ¼ ì „ìš© ì»¨í…ì¸  ì˜ì—­ ìƒì„± ë˜ëŠ” í‘œì‹œ
                let curriculumContent = document.getElementById('curriculumContent');
                if (!curriculumContent) {
                    // ì»¤ë¦¬í˜ëŸ¼ ì»¨í…ì¸  ì˜ì—­ì´ ì—†ìœ¼ë©´ ìƒì„±
                    curriculumContent = document.createElement('div');
                    curriculumContent.id = 'curriculumContent';
                    curriculumContent.className = 'curriculum-content';
                    curriculumContent.style.cssText = `
                        width: 100%;
                        max-width: 1000px;
                        background: white;
                        border-radius: 16px;
                        box-shadow: 0 4px 24px rgba(0,0,0,0.1);
                        padding: 40px;
                        margin: 20px 0;
                        text-align: center;
                        color: #6b7280;
                        line-height: 1.6;
                    `;
                    
                    // welcome-section ë‹¤ìŒì— ì¶”ê°€
                    const welcomeSection = document.querySelector('.welcome-section');
                    welcomeSection.parentNode.insertBefore(curriculumContent, welcomeSection.nextSibling);
                }
                
                // ì»¤ë¦¬í˜ëŸ¼ ì»¨í…ì¸ ë¥¼ ì „ì²´ í™”ë©´ ë ˆì´ì•„ì›ƒìœ¼ë¡œ ë³€ê²½
                curriculumContent.style.cssText = `
                    width: 900px;
                    height: 600px;
                    background: white;
                    border-radius: 12px;
                    border: 1px solid #d1d5db;
                    margin: 20px 0;
                    position: relative;
                    display: block;
                    padding: 20px;
                `;
                
                // ì»¤ë¦¬í˜ëŸ¼ ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
                showCurriculumContent(curriculumContent);
                return;
            }
            // ë‹¤ë¥¸ í˜ì´ì§€ë“¤ì€ í–¥í›„ SPA ë¼ìš°íŒ… êµ¬í˜„ ì˜ˆì •
            showNotification(`${page} í˜ì´ì§€ë¡œ ì´ë™ (ê°œë°œ ì˜ˆì •)`);
        }

        // ì‚¬ìš©ì í”„ë¡œí•„ ë¡œë“œ
        function loadUserProfile() {
            // ì €ì¥ëœ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ (í–¥í›„ ì„œë²„ì—ì„œ ê°€ì ¸ì˜¬ ì˜ˆì •)
            const savedUser = StorageManager.user.get();
            if (savedUser) {
                currentUser = { ...currentUser, ...savedUser };
                updateUserDisplay();
            }
        }

        // ì‚¬ìš©ì í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateUserDisplay() {
            const userName = document.getElementById('userName');
            userName.textContent = currentUser.name;
        }

        // ë©”ì‹œì§€ ì¶”ê°€
        function addMessage(message, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
            
            const avatar = document.createElement('div');
            avatar.className = `message-avatar ${isUser ? 'user-avatar' : 'ai-avatar-small'}`;
            avatar.textContent = isUser ? 'U' : 'AI';
            
            const content = document.createElement('div');
            content.className = 'message-content';
            
            if (isUser) {
                // ì‚¬ìš©ì ë©”ì‹œì§€ëŠ” í”Œë ˆì¸ í…ìŠ¤íŠ¸
                content.textContent = message;
            } else {
                // AI ë©”ì‹œì§€ëŠ” ê°„ë‹¨í•œ ë§ˆí¬ë‹¤ìš´ ì²˜ë¦¬
                content.innerHTML = formatSimpleMarkdown(message);
                // í”„ë¡œí•„ ì •ë³´ ì¶”ì¶œ ë° ì—…ë°ì´íŠ¸
                extractAndUpdateProfile(message);
            }
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // í…ìŠ¤íŠ¸ì˜ì—­ ë†’ì´ ì¡°ì •
        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        // ì˜ˆì‹œ ì‚¬ìš©
        function useExample(exampleText) {
            messageInput.value = exampleText;
            adjustTextareaHeight(messageInput);
            messageInput.focus();
        }

        // ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µìš© ë©”ì‹œì§€ ì¶”ê°€
        function addStreamingMessage() {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai-message';
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar ai-avatar-small';
            avatar.textContent = 'AI';
            
            const content = document.createElement('div');
            content.className = 'message-content';
            content.textContent = '';
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            return content;
        }

        // ì„¸ì…˜ ID ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
        function getSessionId() {
            // 1. ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ì„¸ì…˜ ID ìš°ì„  ì‚¬ìš©
            if (SESSION_ID && SESSION_ID !== '') {
                return SESSION_ID;
            }
            
            // 2. ì¿ í‚¤ì—ì„œ session_id ì¶”ì¶œ
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'session_id') {
                    return value;
                }
            }
            return null;
        }

        // ë©”ì‹œì§€ ì „ì†¡
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            // ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ
            addMessage(message, true);
            messageInput.value = '';
            messageInput.style.height = 'auto';
            
            // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© í‘œì‹œ
            sendButton.disabled = true;
            sendButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            // ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µìš© ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆ ìƒì„±
            const streamingContent = addStreamingMessage();

            try {
                // ì„¸ì…˜ ID ê°€ì ¸ì˜¤ê¸°
                const sessionId = getSessionId();
                
                // EventSourceë¡œ ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ë°›ê¸°
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Session-ID': sessionId || ''  // í—¤ë”ë¡œë„ ì „ì†¡
                    },
                    credentials: 'include', // ì¿ í‚¤ í¬í•¨
                    body: JSON.stringify({ 
                        message: message,
                        session_id: sessionId  // ë°”ë””ì—ë„ í¬í•¨
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = '';

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split('\n');
                    buffer = lines.pop() || ''; // ë§ˆì§€ë§‰ ë¶ˆì™„ì „í•œ ë¼ì¸ì€ ë²„í¼ì— ìœ ì§€
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            try {
                                const data = JSON.parse(line.slice(6));
                                console.log('ğŸ” ìŠ¤íŠ¸ë¦¬ë° ë°ì´í„°:', data); // ë””ë²„ê¹…ìš©
                                console.log('ğŸ“Š í˜„ì¬ ìƒíƒœ:', { 
                                    isGeneratingCurriculum, 
                                    hasContent: !!data.content, 
                                    hasCurriculum: !!data.curriculum,
                                    hasProfile: !!data.profile,
                                    isDone: !!data.done 
                                });
                                // ì»¤ë¦¬í˜ëŸ¼ ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš° ìš°ì„  ì²˜ë¦¬ (ë°±ì—”ë“œì—ì„œ curriculum ê°ì²´ë¡œ ì „ì†¡)
                                if (data.curriculum) {
                                    console.log('ğŸ“š ì»¤ë¦¬í˜ëŸ¼ ë°ì´í„° ìˆ˜ì‹  (curriculum ê°ì²´):', data.curriculum);
                                    
                                    // ğŸ”¥ ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ì™„ë£Œ - í”Œë˜ê·¸ í•´ì œ
                                    isGeneratingCurriculum = false;
                                    console.log('âœ… ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ì™„ë£Œ - isGeneratingCurriculum = false');
                                    
                                    // ì¦‰ì‹œ ìƒì„± ë²„íŠ¼ ë³µì›
                                    const generateBtn = document.getElementById('generateCurriculumBtn');
                                    if (generateBtn) {
                                        generateBtn.disabled = false;
                                        generateBtn.innerHTML = '<i class="fas fa-magic"></i> ë§ì¶¤í˜• ì»¤ë¦¬í˜ëŸ¼ ìƒì„±';
                                    }
                                    
                                    // ìƒˆ ì»¤ë¦¬í˜ëŸ¼ ë°ì´í„° ì €ì¥
                                    StorageManager.curriculum.clear();
                                    StorageManager.curriculum.set(data.curriculum);
                                    console.log('ğŸ’¾ ìƒˆ ì»¤ë¦¬í˜ëŸ¼ ë°ì´í„° ì €ì¥:', data.curriculum.title);
                                    
                                    // ì»¤ë¦¬í˜ëŸ¼ íƒ­ìœ¼ë¡œ ì „í™˜
                                    switchToTab('curriculum');
                                    
                                    // DOM ì—…ë°ì´íŠ¸ í›„ ë Œë”ë§
                                    setTimeout(() => {
                                        const curriculumContent = document.getElementById('curriculumContent');
                                        if (curriculumContent) {
                                            curriculumContent.innerHTML = '';
                                            displayCurriculumCards(curriculumContent, data.curriculum);
                                            console.log('ğŸ”„ ìƒˆ ì»¤ë¦¬í˜ëŸ¼ìœ¼ë¡œ ê°•ì œ ë Œë”ë§:', data.curriculum.title);
                                        }
                                    }, 100);
                                    
                                    showNotification('ë§ì¶¤í˜• ì»¤ë¦¬í˜ëŸ¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                                }
                                
                                // í”„ë¡œí•„ ì •ë³´ê°€ ìˆëŠ” ê²½ìš° ì—…ë°ì´íŠ¸
                                if (data.profile) {
                                    console.log('ğŸ“ í”„ë¡œí•„ ì •ë³´ ìˆ˜ì‹ :', data.profile);
                                    
                                    // í”„ë¡œí•„ ì •ë³´ ì €ì¥
                                    const profileData = StorageManager.profile.set(
                                        data.profile.topic || '',
                                        data.profile.constraints || '', 
                                        data.profile.goal || ''
                                    );
                                    console.log('ğŸ“ í”„ë¡œí•„ ì •ë³´ ì €ì¥:', profileData);
                                    
                                    // UI ì—…ë°ì´íŠ¸
                                    updateLearningProfile(profileData.topic, profileData.constraints, profileData.goal);
                                }
                                
                                // ì¼ë°˜ í…ìŠ¤íŠ¸ ì½˜í…ì¸  ì²˜ë¦¬
                                if (data.content) {
                                    // ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ì¤‘ì´ê³  JSON ì‘ë‹µì¸ ê²½ìš° ì²˜ë¦¬ (ë°±ì—…ìš©)
                                    const isJsonResponse = data.content.trim().startsWith('{') && data.content.includes('"title"') && data.content.includes('"modules"');
                                    
                                    if (isGeneratingCurriculum && isJsonResponse) {
                                        console.log('ğŸ“š ì»¤ë¦¬í˜ëŸ¼ JSON ì‘ë‹µ ê°ì§€ (ë°±ì—… ì²˜ë¦¬) - íŒŒì‹± ì‹œë„');
                                        try {
                                            const curriculumData = JSON.parse(data.content.trim());
                                            console.log('âœ… ì»¤ë¦¬í˜ëŸ¼ JSON íŒŒì‹± ì„±ê³µ (ë°±ì—…):', curriculumData);
                                            
                                            // ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ì™„ë£Œ ì²˜ë¦¬
                                            isGeneratingCurriculum = false;
                                            console.log('âœ… ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ì™„ë£Œ (ë°±ì—…) - isGeneratingCurriculum = false');
                                            
                                            // ìƒì„± ë²„íŠ¼ ë³µì›
                                            const generateBtn = document.getElementById('generateCurriculumBtn');
                                            if (generateBtn) {
                                                generateBtn.disabled = false;
                                                generateBtn.innerHTML = '<i class="fas fa-magic"></i> ë§ì¶¤í˜• ì»¤ë¦¬í˜ëŸ¼ ìƒì„±';
                                            }
                                            
                                            // ìƒˆ ì»¤ë¦¬í˜ëŸ¼ ë°ì´í„° ì €ì¥
                                            StorageManager.curriculum.clear();
                                            StorageManager.curriculum.set(curriculumData);
                                            console.log('ğŸ’¾ ìƒˆ ì»¤ë¦¬í˜ëŸ¼ ë°ì´í„° ì €ì¥ (ë°±ì—…):', curriculumData.title);
                                            
                                            // ì»¤ë¦¬í˜ëŸ¼ íƒ­ìœ¼ë¡œ ì „í™˜
                                            switchToTab('curriculum');
                                            
                                            // DOM ì—…ë°ì´íŠ¸ í›„ ë Œë”ë§
                                            setTimeout(() => {
                                                const curriculumContent = document.getElementById('curriculumContent');
                                                if (curriculumContent) {
                                                    curriculumContent.innerHTML = '';
                                                    displayCurriculumCards(curriculumContent, curriculumData);
                                                    console.log('ğŸ”„ ìƒˆ ì»¤ë¦¬í˜ëŸ¼ìœ¼ë¡œ ê°•ì œ ë Œë”ë§ (ë°±ì—…):', curriculumData.title);
                                                }
                                            }, 100);
                                            
                                            showNotification('ë§ì¶¤í˜• ì»¤ë¦¬í˜ëŸ¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                                            
                                        } catch (e) {
                                            console.error('âŒ ì»¤ë¦¬í˜ëŸ¼ JSON íŒŒì‹± ì‹¤íŒ¨ (ë°±ì—…):', e);
                                            console.log('ì›ë³¸ ë°ì´í„°:', data.content);
                                        }
                                    } else if (!data.curriculum) {
                                        // ì»¤ë¦¬í˜ëŸ¼ ë°ì´í„°ê°€ ì—†ì„ ë•Œë§Œ ì¼ë°˜ ì‘ë‹µ í‘œì‹œ
                                        const currentText = streamingContent.getAttribute('data-raw-text') || '';
                                        const newText = currentText + data.content;
                                        streamingContent.setAttribute('data-raw-text', newText);
                                        
                                        // ê°„ë‹¨í•œ ë§ˆí¬ë‹¤ìš´ ì²˜ë¦¬
                                        streamingContent.innerHTML = formatSimpleMarkdown(newText);
                                        chatMessages.scrollTop = chatMessages.scrollHeight;
                                    }
                                } else if (data.error) {
                                    streamingContent.textContent = `ì˜¤ë¥˜: ${data.error}`;
                                    break;
                                } else if (data.done) {
                                    console.log('ğŸ ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì‹ í˜¸ ìˆ˜ì‹ ');
                                    // ìŠ¤íŠ¸ë¦¬ë°ì´ ëë‚¬ëŠ”ë° ì•„ì§ ìƒì„± ì¤‘ì´ë©´ ìƒíƒœ í•´ì œ
                                    if (isGeneratingCurriculum) {
                                        console.log('âš ï¸ ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œí–ˆì§€ë§Œ ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ì¤‘ ìƒíƒœ - ê°•ì œ í•´ì œ');
                                        isGeneratingCurriculum = false;
                                        const generateBtn = document.getElementById('generateCurriculumBtn');
                                        if (generateBtn) {
                                            generateBtn.disabled = false;
                                            generateBtn.innerHTML = '<i class="fas fa-magic"></i> ë§ì¶¤í˜• ì»¤ë¦¬í˜ëŸ¼ ìƒì„±';
                                        }
                                        
                                        // ì»¤ë¦¬í˜ëŸ¼ ë°ì´í„°ê°€ ìˆëŠ”ì§€ ë§ˆì§€ë§‰ìœ¼ë¡œ í™•ì¸
                                        const existingCurriculum = StorageManager.curriculum.get();
                                        if (existingCurriculum) {
                                            console.log('ğŸ“š ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì‹œ ê¸°ì¡´ ì»¤ë¦¬í˜ëŸ¼ ë°œê²¬ - í‘œì‹œ');
                                            switchToTab('curriculum');
                                            setTimeout(() => {
                                                const curriculumContent = document.getElementById('curriculumContent');
                                                if (curriculumContent) {
                                                    displayCurriculumCards(curriculumContent, existingCurriculum);
                                                }
                                            }, 100);
                                        }
                                    }
                                    break;
                                }
                            } catch (e) {
                                console.error('JSON íŒŒì‹± ì˜¤ë¥˜:', e);
                            }
                        }
                    }
                }

            } catch (error) {
                streamingContent.textContent = `ì—°ê²° ì˜¤ë¥˜: ${error.message}`;
                
                // ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ìƒíƒœ í•´ì œ
                if (isGeneratingCurriculum) {
                    console.log('âŒ ì—ëŸ¬ ë°œìƒìœ¼ë¡œ ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ìƒíƒœ í•´ì œ');
                    isGeneratingCurriculum = false;
                    const generateBtn = document.getElementById('generateCurriculumBtn');
                    if (generateBtn) {
                        generateBtn.disabled = false;
                        generateBtn.innerHTML = '<i class="fas fa-magic"></i> ë§ì¶¤í˜• ì»¤ë¦¬í˜ëŸ¼ ìƒì„±';
                    }
                }
            }

            // ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
            sendButton.disabled = false;
            sendButton.innerHTML = '<i class="fas fa-arrow-up"></i>';
            
            // ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ì¤‘ì´ì—ˆë‹¤ë©´ ìƒì„± ë²„íŠ¼ë„ ë³µì›
            if (isGeneratingCurriculum) {
                console.log('âš ï¸ ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ ì‹œ ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ìƒíƒœì˜€ìŒ - ìµœì¢… ì²˜ë¦¬');
                isGeneratingCurriculum = false;
                const generateBtn = document.getElementById('generateCurriculumBtn');
                if (generateBtn) {
                    generateBtn.disabled = false;
                    generateBtn.innerHTML = '<i class="fas fa-magic"></i> ë§ì¶¤í˜• ì»¤ë¦¬í˜ëŸ¼ ìƒì„±';
                    console.log('ğŸ”„ ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ë²„íŠ¼ ê°•ì œ ë³µì›');
                }
                
                // ë§ˆì§€ë§‰ìœ¼ë¡œ ì»¤ë¦¬í˜ëŸ¼ ë°ì´í„° í™•ì¸ ë° í‘œì‹œ
                setTimeout(() => {
                    const finalCurriculum = StorageManager.curriculum.get();
                    if (finalCurriculum) {
                        console.log('ğŸ“š ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ í›„ ìµœì¢… ì»¤ë¦¬í˜ëŸ¼ ë°œê²¬:', finalCurriculum.title);
                        switchToTab('curriculum');
                        setTimeout(() => {
                            const curriculumContent = document.getElementById('curriculumContent');
                            if (curriculumContent) {
                                curriculumContent.innerHTML = '';
                                displayCurriculumCards(curriculumContent, finalCurriculum);
                                showNotification('ì»¤ë¦¬í˜ëŸ¼ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                            }
                        }, 200);
                    } else {
                        console.log('âŒ ìŠ¤íŠ¸ë¦¬ë° ì™„ë£Œ í›„ì—ë„ ì»¤ë¦¬í˜ëŸ¼ ë°ì´í„° ì—†ìŒ');
                        const curriculumContent = document.getElementById('curriculumContent');
                        if (curriculumContent) {
                            showCurriculumContent(curriculumContent);
                        }
                    }
                }, 500);
            }
        }

        // ì‚¬ìš©ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸
        function updateUserProfile(profileData) {
            currentUser = { ...currentUser, ...profileData };
            StorageManager.user.set(currentUser);
            updateUserDisplay();
            showNotification('í”„ë¡œí•„ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ì»¤ë¦¬í˜ëŸ¼ ì½˜í…ì¸  í‘œì‹œ í•¨ìˆ˜
        function showCurriculumContent(container) {
            // ìƒì„± ì¤‘ì¸ ê²½ìš° ë¡œë”© ìƒíƒœ ìœ ì§€
            if (isGeneratingCurriculum) {
                displayLoadingState(container);
                return;
            }
            
            // ìƒì„±ëœ ì»¤ë¦¬í˜ëŸ¼ì´ ìˆëŠ”ì§€ í™•ì¸
            const curriculumData = StorageManager.curriculum.get();
            
            if (curriculumData) {
                // ìƒì„±ëœ ì»¤ë¦¬í˜ëŸ¼ì´ ìˆìœ¼ë©´ ì¹´ë“œ í˜•íƒœë¡œ í‘œì‹œ
                displayCurriculumCards(container, curriculumData);
            } else {
                // ìƒì„±ëœ ì»¤ë¦¬í˜ëŸ¼ì´ ì—†ìœ¼ë©´ + ë°•ìŠ¤ í‘œì‹œ
                displayEmptyState(container);
            }
        }

        // ë¹ˆ ìƒíƒœ (+ ë°•ìŠ¤) í‘œì‹œ
        function displayEmptyState(container) {
            container.innerHTML = `
                <div style="
                    position: absolute;
                    top: 30px;
                    left: 30px;
                    width: 240px;
                    height: 180px;
                    border: 2px dashed #d1d5db;
                    border-radius: 8px;
                    background: #fafafa;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    font-size: 36px;
                    color: #9ca3af;
                    font-weight: 300;
                "
                onclick="switchToTab('chat')"
                onmouseover="this.style.borderColor='#a855f7'; this.style.background='#f8fafc'; this.style.color='#a855f7'"
                onmouseout="this.style.borderColor='#d1d5db'; this.style.background='#fafafa'; this.style.color='#9ca3af'"
                title="ìƒˆ ì»¤ë¦¬í˜ëŸ¼ ìƒì„±í•˜ê¸°">
                    +
                </div>
                
                <!-- + ë°•ìŠ¤ ì•„ë˜ ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
                <div style="
                    position: absolute;
                    top: 240px;
                    left: 30px;
                ">
                    <button onclick="switchToTab('chat')" style="
                        width: 240px;
                        background: linear-gradient(135deg, #a855f7, #ec4899);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        padding: 12px 0;
                        font-size: 14px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.2s ease;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    " onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 16px rgba(168, 85, 247, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                        ë§ì¶¤í˜• í•™ìŠµ ì¶”ì²œìœ¼ë¡œ ì´ë™ â†’
                    </button>
                </div>
            `;
        }

        // ë¡œë”© ìƒíƒœ í‘œì‹œ
        function displayLoadingState(container) {
            container.innerHTML = `
                <div style="
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    height: 100%;
                    color: #6b7280;
                ">
                    <div style="
                        width: 60px;
                        height: 60px;
                        border: 4px solid #f3f4f6;
                        border-top: 4px solid #a855f7;
                        border-radius: 50%;
                        animation: spin 1s linear infinite;
                        margin-bottom: 20px;
                    "></div>
                    <h3 style="
                        font-size: 18px;
                        font-weight: 600;
                        color: #374151;
                        margin: 0 0 8px 0;
                    ">ì»¤ë¦¬í˜ëŸ¼ ìƒì„± ì¤‘...</h3>
                    <p style="
                        font-size: 14px;
                        color: #6b7280;
                        margin: 0;
                        text-align: center;
                    ">AIê°€ ë§ì¶¤í˜• í•™ìŠµ ê³„íšì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤.<br>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
                </div>
                
                <style>
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                </style>
            `;
        }

        // ì»¤ë¦¬í˜ëŸ¼ ì¹´ë“œë“¤ í‘œì‹œ
        function displayCurriculumCards(container, data) {
            const modules = data.modules || [];
            let cardsHtml = '';
            
            // ì§„í–‰ë„ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
            const completedWeeks = StorageManager.curriculum.progress.get();
            const totalWeeks = modules.length;
            const completedCount = completedWeeks.length;
            const progressPercentage = totalWeeks > 0 ? (completedCount / totalWeeks) * 100 : 0;

            // í—¤ë” ì •ë³´
            cardsHtml += `
                <div style="margin-bottom: 24px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                        <div style="
                            background: linear-gradient(135deg, #a855f7, #ec4899);
                            color: white;
                            padding: 6px 12px;
                            border-radius: 6px;
                            font-size: 12px;
                            font-weight: 600;
                            text-transform: uppercase;
                        ">
                            ${data.level || 'Beginner'}
                        </div>
                        <div style="color: #6b7280; font-size: 14px;">
                            ${data.duration_weeks || 0}ì£¼ ê³¼ì •
                        </div>
                        <div style="
                            background: ${progressPercentage > 0 ? '#10b981' : '#f3f4f6'};
                            color: ${progressPercentage > 0 ? 'white' : '#6b7280'};
                            padding: 4px 8px;
                            border-radius: 12px;
                            font-size: 11px;
                            font-weight: 600;
                            margin-left: auto;
                        ">
                            ${completedCount}/${totalWeeks} ì™„ë£Œ
                        </div>
                    </div>
                    <h2 style="
                        font-size: 18px;
                        font-weight: 700;
                        color: #1f2937;
                        margin: 0 0 16px 0;
                    ">
                        ${data.title || 'ì»¤ë¦¬í˜ëŸ¼'}
                    </h2>
                    
                    <!-- í•™ìŠµ ì§„í–‰ë„ íŠ¸ë˜ì»¤ -->
                    <div style="
                        background: #f9fafb;
                        border: 1px solid #e5e7eb;
                        border-radius: 12px;
                        padding: 16px;
                        margin-bottom: 20px;
                    ">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                            <h3 style="
                                font-size: 14px;
                                font-weight: 600;
                                color: #374151;
                                margin: 0;
                            ">í•™ìŠµ ì§„í–‰ë„</h3>
                            <span style="
                                font-size: 12px;
                                color: #6b7280;
                                font-weight: 500;
                            ">${Math.round(progressPercentage)}% ì™„ë£Œ</span>
                        </div>
                        
                        <!-- ì§„í–‰ë°” -->
                        <div style="
                            background: #e5e7eb;
                            height: 6px;
                            border-radius: 3px;
                            overflow: hidden;
                            margin-bottom: 16px;
                        ">
                            <div style="
                                background: linear-gradient(90deg, #a855f7, #ec4899);
                                height: 100%;
                                width: ${progressPercentage}%;
                                transition: width 0.3s ease;
                                border-radius: 3px;
                            "></div>
                        </div>
                        
                        <!-- ì£¼ì°¨ë³„ ë‹¨ê³„ í‘œì‹œ -->
                        <div style="
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            gap: 4px;
                            overflow-x: auto;
                            padding: 4px 0;
                        ">
                            ${modules.map((module, index) => {
                                const isCompleted = completedWeeks.includes(index);
                                const weekColor = index < 4 ? '#a855f7' : index < 8 ? '#ec4899' : '#10b981';
                                return `
                                    <div style="
                                        display: flex;
                                        flex-direction: column;
                                        align-items: center;
                                        min-width: 50px;
                                        position: relative;
                                    ">
                                        <div style="
                                            width: 32px;
                                            height: 32px;
                                            border-radius: 50%;
                                            background: ${isCompleted ? weekColor : '#e5e7eb'};
                                            color: ${isCompleted ? 'white' : '#9ca3af'};
                                            display: flex;
                                            align-items: center;
                                            justify-content: center;
                                            font-size: 12px;
                                            font-weight: 600;
                                            transition: all 0.3s ease;
                                            cursor: pointer;
                                            border: 2px solid ${isCompleted ? weekColor : '#e5e7eb'};
                                            box-shadow: ${isCompleted ? '0 2px 8px rgba(168, 85, 247, 0.3)' : 'none'};
                                        " onclick="toggleModuleDetail(${index})">
                                            ${isCompleted ? 'âœ“' : (index + 1)}
                                        </div>
                                        <div style="
                                            font-size: 9px;
                                            color: #6b7280;
                                            text-align: center;
                                            margin-top: 4px;
                                            max-width: 40px;
                                            overflow: hidden;
                                            text-overflow: ellipsis;
                                            white-space: nowrap;
                                        ">
                                            ${index + 1}ì£¼ì°¨
                                        </div>
                                        ${index < modules.length - 1 ? `
                                            <div style="
                                                position: absolute;
                                                top: 16px;
                                                right: -27px;
                                                width: 20px;
                                                height: 2px;
                                                background: ${index < completedCount - 1 ? weekColor : '#e5e7eb'};
                                                z-index: 1;
                                            "></div>
                                        ` : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            // ëª¨ë“ˆ ì¹´ë“œë“¤ì„ ê·¸ë¦¬ë“œë¡œ ë°°ì¹˜ (ê³ ì • ë†’ì´ ì¹´ë“œ)
            const rows = Math.ceil(modules.length / 4);
            const gridHeight = rows * 160 + (rows - 1) * 12; // ì¹´ë“œ ë†’ì´ 160px + ê°„ê²© 12px
            cardsHtml += `<div id="curriculumGrid" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; min-height: ${gridHeight}px; height: auto;">`;
            
            modules.forEach((module, index) => {
                const weekColor = index < 4 ? '#a855f7' : index < 8 ? '#ec4899' : '#10b981';
                cardsHtml += `
                    <div id="card-${index}" class="curriculum-card" style="
                        background: white;
                        border: 1px solid #e5e7eb;
                        border-radius: 8px;
                        padding: 12px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        height: 160px;
                        position: relative;
                        overflow: hidden;
                        display: flex;
                        flex-direction: column;
                    " 
                    onmouseover="this.style.borderColor='${weekColor}'; this.style.boxShadow='0 2px 8px rgba(168, 85, 247, 0.1)'"
                    onmouseout="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
                    onclick="toggleModuleDetail(${index})">
                        
                        <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 6px;">
                            <div style="
                                background: ${weekColor};
                                color: white;
                                width: 20px;
                                height: 20px;
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 10px;
                                font-weight: 600;
                            ">
                                ${module.week || index + 1}
                            </div>
                            <div style="color: #6b7280; font-size: 10px; font-weight: 500;">
                                ${module.estimated_hours || 8}ì‹œê°„
                            </div>
                        </div>
                        
                        <h3 style="
                            font-size: 12px;
                            font-weight: 600;
                            color: #1f2937;
                            margin: 0 0 6px 0;
                            line-height: 1.3;
                            display: -webkit-box;
                            -webkit-line-clamp: 2;
                            -webkit-box-orient: vertical;
                            overflow: hidden;
                        ">
                            ${module.title || `${index + 1}ì£¼ì°¨ í•™ìŠµ`}
                        </h3>
                        
                        <p id="description-${index}" style="
                            font-size: 10px;
                            color: #6b7280;
                            margin: 0 0 8px 0;
                            line-height: 1.3;
                            display: -webkit-box;
                            -webkit-line-clamp: 3;
                            -webkit-box-orient: vertical;
                            overflow: hidden;
                            flex: 1;
                            min-height: 0;
                        ">
                            ${module.description || 'ì´ë²ˆ ì£¼ì°¨ì˜ í•™ìŠµ ë‚´ìš©ì„ ë‹¤ë£¹ë‹ˆë‹¤.'}
                        </p>
                        
                        ${module.key_concepts && module.key_concepts.length > 0 ? `
                            <div id="concepts-${index}" style="margin-top: 4px; display: flex; gap: 2px; flex-wrap: wrap;">
                                ${module.key_concepts.slice(0, 2).map(concept => `
                                    <span style="
                                        background: #f3f4f6;
                                        color: #6b7280;
                                        padding: 2px 4px;
                                        border-radius: 3px;
                                        font-size: 8px;
                                        font-weight: 500;
                                        max-width: 80px;
                                        overflow: hidden;
                                        text-overflow: ellipsis;
                                        white-space: nowrap;
                                        display: inline-block;
                                    ">${concept}</span>
                                `).join('')}
                                ${module.key_concepts.length > 2 ? `<span style="color: #9ca3af; font-size: 8px;">+${module.key_concepts.length - 2}</span>` : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            cardsHtml += '</div>';
            container.innerHTML = cardsHtml;
        }

        // ëª¨ë“ˆ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ í‘œì‹œ
        function toggleModuleDetail(moduleIndex) {
            const curriculumData = StorageManager.curriculum.get() || {};
            const module = curriculumData.modules?.[moduleIndex];
            
            if (!module) return;
            
            showModuleModal(module, moduleIndex);
        }
        
        // ëª¨ë“ˆ ëª¨ë‹¬ ìƒì„± ë° í‘œì‹œ
        function showModuleModal(module, moduleIndex) {
            // ê¸°ì¡´ ëª¨ë‹¬ ì œê±°
            const existingModal = document.getElementById('moduleModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const weekColor = moduleIndex < 4 ? '#a855f7' : moduleIndex < 8 ? '#ec4899' : '#10b981';
            
            // ëª¨ë‹¬ HTML ìƒì„± (í˜„ëŒ€ì  ë””ìì¸)
            const modalHtml = `
                <div id="moduleModal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(15, 23, 42, 0.6);
                    backdrop-filter: blur(8px);
                    z-index: 1000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    animation: fadeIn 0.3s ease;
                    padding: 20px;
                " onclick="closeModuleModal(event)">
                    <div style="
                        background: white;
                        border-radius: 20px;
                        width: 100%;
                        max-width: 800px;
                        max-height: 90vh;
                        overflow-y: auto;
                        box-shadow: 0 25px 60px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.05);
                        animation: slideUp 0.3s ease;
                        position: relative;
                    " onclick="event.stopPropagation()">
                        <!-- í—¤ë” -->
                        <div style="
                            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                            border: 1px solid #e2e8f0;
                            padding: 32px;
                            border-radius: 20px 20px 0 0;
                            position: relative;
                        ">
                            <button onclick="closeModuleModal()" style="
                                position: absolute;
                                top: 20px;
                                right: 20px;
                                background: #f1f5f9;
                                border: 1px solid #e2e8f0;
                                color: #64748b;
                                font-size: 16px;
                                width: 36px;
                                height: 36px;
                                border-radius: 50%;
                                cursor: pointer;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                transition: all 0.2s ease;
                                font-weight: 400;
                            " onmouseover="this.style.background='#e2e8f0'; this.style.color='#475569'" onmouseout="this.style.background='#f1f5f9'; this.style.color='#64748b'">
                                Ã—
                            </button>
                            <div style="
                                background: linear-gradient(135deg, ${weekColor} 0%, ${weekColor}dd 100%);
                                color: white;
                                padding: 8px 16px;
                                border-radius: 12px;
                                font-size: 13px;
                                font-weight: 600;
                                margin-bottom: 16px;
                                display: inline-flex;
                                align-items: center;
                                gap: 6px;
                                box-shadow: 0 2px 8px ${weekColor}30;
                            ">
                                <span style="font-size: 12px;">ğŸ“…</span>
                                Week ${module.week}
                            </div>
                            <h2 style="
                                margin: 0;
                                font-size: 28px;
                                font-weight: 800;
                                line-height: 1.2;
                                color: #1e293b;
                                letter-spacing: -0.025em;
                            ">
                                ${module.title}
                            </h2>
                            <p style="
                                margin: 16px 0 0 0;
                                color: #64748b;
                                font-size: 16px;
                                line-height: 1.6;
                                font-weight: 400;
                            ">
                                ${module.description}
                            </p>
                        </div>
                        
                        <!-- ì»¨í…ì¸  -->
                        <div style="padding: 32px; background: #fafafa; border-top: 1px solid #f1f5f9;">
                            ${module.objectives ? `
                                <div style="
                                    background: white;
                                    border-radius: 16px;
                                    padding: 24px;
                                    margin-bottom: 24px;
                                    border: 1px solid #e2e8f0;
                                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
                                ">
                                    <h3 style="
                                        font-size: 20px;
                                        font-weight: 700;
                                        color: #1e293b;
                                        margin-bottom: 20px;
                                        display: flex;
                                        align-items: center;
                                        gap: 12px;
                                    ">
                                        <span style="
                                            background: linear-gradient(135deg, ${weekColor}20, ${weekColor}10);
                                            color: ${weekColor};
                                            width: 36px;
                                            height: 36px;
                                            border-radius: 12px;
                                            display: flex;
                                            align-items: center;
                                            justify-content: center;
                                            font-size: 16px;
                                        ">ğŸ¯</span>
                                        í•™ìŠµ ëª©í‘œ
                                    </h3>
                                    <div style="
                                        display: grid;
                                        gap: 12px;
                                    ">
                                        ${module.objectives.map((obj, idx) => `
                                            <div style="
                                                background: #f8fafc;
                                                border: 1px solid #f1f5f9;
                                                border-left: 4px solid ${weekColor};
                                                padding: 16px;
                                                border-radius: 0 12px 12px 0;
                                                color: #475569;
                                                line-height: 1.6;
                                                font-weight: 500;
                                                position: relative;
                                            ">
                                                <div style="
                                                    position: absolute;
                                                    top: -8px;
                                                    left: 12px;
                                                    background: ${weekColor};
                                                    color: white;
                                                    width: 24px;
                                                    height: 24px;
                                                    border-radius: 50%;
                                                    display: flex;
                                                    align-items: center;
                                                    justify-content: center;
                                                    font-size: 12px;
                                                    font-weight: 700;
                                                ">${idx + 1}</div>
                                                <div style="margin-top: 8px;">
                                                    ${obj}
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${module.key_concepts && module.key_concepts.length > 0 ? `
                                <div style="
                                    background: white;
                                    border-radius: 16px;
                                    padding: 24px;
                                    margin-bottom: 24px;
                                    border: 1px solid #e2e8f0;
                                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
                                ">
                                    <h3 style="
                                        font-size: 20px;
                                        font-weight: 700;
                                        color: #1e293b;
                                        margin-bottom: 20px;
                                        display: flex;
                                        align-items: center;
                                        gap: 12px;
                                    ">
                                        <span style="
                                            background: linear-gradient(135deg, ${weekColor}20, ${weekColor}10);
                                            color: ${weekColor};
                                            width: 36px;
                                            height: 36px;
                                            border-radius: 12px;
                                            display: flex;
                                            align-items: center;
                                            justify-content: center;
                                            font-size: 16px;
                                        ">ğŸ”‘</span>
                                        í•µì‹¬ ê°œë…
                                    </h3>
                                    <div style="
                                        display: grid;
                                        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
                                        gap: 16px;
                                    ">
                                        ${module.key_concepts.map((concept, idx) => `
                                            <div style="
                                                background: linear-gradient(135deg, ${weekColor}08, ${weekColor}03);
                                                border: 2px solid ${weekColor}15;
                                                color: #475569;
                                                padding: 16px 20px;
                                                border-radius: 12px;
                                                font-size: 15px;
                                                font-weight: 600;
                                                text-align: center;
                                                position: relative;
                                                transition: all 0.2s ease;
                                                cursor: default;
                                            " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px ${weekColor}20'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                                <div style="
                                                    position: absolute;
                                                    top: -10px;
                                                    right: 8px;
                                                    background: ${weekColor};
                                                    color: white;
                                                    width: 20px;
                                                    height: 20px;
                                                    border-radius: 50%;
                                                    display: flex;
                                                    align-items: center;
                                                    justify-content: center;
                                                    font-size: 11px;
                                                    font-weight: 700;
                                                ">${idx + 1}</div>
                                                ${concept}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${module.learning_outcomes && module.learning_outcomes.length > 0 ? `
                                <div style="
                                    background: white;
                                    border-radius: 16px;
                                    padding: 24px;
                                    margin-bottom: 24px;
                                    border: 1px solid #e2e8f0;
                                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
                                ">
                                    <h3 style="
                                        font-size: 20px;
                                        font-weight: 700;
                                        color: #1e293b;
                                        margin-bottom: 20px;
                                        display: flex;
                                        align-items: center;
                                        gap: 12px;
                                    ">
                                        <span style="
                                            background: linear-gradient(135deg, ${weekColor}20, ${weekColor}10);
                                            color: ${weekColor};
                                            width: 36px;
                                            height: 36px;
                                            border-radius: 12px;
                                            display: flex;
                                            align-items: center;
                                            justify-content: center;
                                            font-size: 16px;
                                        ">ğŸ†</span>
                                        í•™ìŠµ ì„±ê³¼
                                    </h3>
                                    <div style="
                                        display: grid;
                                        gap: 12px;
                                    ">
                                        ${module.learning_outcomes.map((outcome, idx) => `
                                            <div style="
                                                background: #f8fafc;
                                                border: 1px solid #f1f5f9;
                                                border-left: 4px solid ${weekColor};
                                                padding: 16px;
                                                border-radius: 0 12px 12px 0;
                                                color: #475569;
                                                line-height: 1.6;
                                                font-weight: 500;
                                                position: relative;
                                            ">
                                                <div style="
                                                    position: absolute;
                                                    top: -8px;
                                                    left: 12px;
                                                    background: ${weekColor};
                                                    color: white;
                                                    width: 24px;
                                                    height: 24px;
                                                    border-radius: 50%;
                                                    display: flex;
                                                    align-items: center;
                                                    justify-content: center;
                                                    font-size: 12px;
                                                    font-weight: 700;
                                                ">${idx + 1}</div>
                                                <div style="margin-top: 8px;">
                                                    ${outcome}
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${module.estimated_hours ? `
                                <div style="
                                    background: white;
                                    border-radius: 16px;
                                    padding: 24px;
                                    margin-bottom: 24px;
                                    border: 1px solid #e2e8f0;
                                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
                                ">
                                    <h3 style="
                                        font-size: 20px;
                                        font-weight: 700;
                                        color: #1e293b;
                                        margin-bottom: 20px;
                                        display: flex;
                                        align-items: center;
                                        gap: 12px;
                                    ">
                                        <span style="
                                            background: linear-gradient(135deg, ${weekColor}20, ${weekColor}10);
                                            color: ${weekColor};
                                            width: 36px;
                                            height: 36px;
                                            border-radius: 12px;
                                            display: flex;
                                            align-items: center;
                                            justify-content: center;
                                            font-size: 16px;
                                        ">â°</span>
                                        í•™ìŠµ ì‹œê°„
                                    </h3>
                                    <div style="
                                        background: linear-gradient(135deg, ${weekColor}08, ${weekColor}03);
                                        border: 2px solid ${weekColor}15;
                                        color: #475569;
                                        padding: 20px;
                                        border-radius: 12px;
                                        text-align: center;
                                        font-size: 24px;
                                        font-weight: 700;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        gap: 8px;
                                    ">
                                        <span style="font-size: 20px;">ğŸ“š</span>
                                        ${module.estimated_hours}ì‹œê°„
                                    </div>
                                    <div style="
                                        text-align: center;
                                        color: #64748b;
                                        font-size: 14px;
                                        margin-top: 12px;
                                        font-weight: 500;
                                    ">
                                        ì˜ˆìƒ í•™ìŠµ ì†Œìš” ì‹œê°„
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${module.resources ? `
                                <div style="
                                    background: white;
                                    border-radius: 16px;
                                    padding: 24px;
                                    border: 1px solid #e2e8f0;
                                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
                                ">
                                    <h3 style="
                                        font-size: 20px;
                                        font-weight: 700;
                                        color: #1e293b;
                                        margin-bottom: 24px;
                                        display: flex;
                                        align-items: center;
                                        gap: 12px;
                                    ">
                                        <span style="
                                            background: linear-gradient(135deg, ${weekColor}20, ${weekColor}10);
                                            color: ${weekColor};
                                            width: 36px;
                                            height: 36px;
                                            border-radius: 12px;
                                            display: flex;
                                            align-items: center;
                                            justify-content: center;
                                            font-size: 16px;
                                        ">ğŸ“š</span>
                                        í•™ìŠµ ìë£Œ
                                    </h3>
                                    
                                    <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
                                    <div style="
                                        display: flex;
                                        gap: 8px;
                                        margin-bottom: 20px;
                                        border-bottom: 1px solid #f1f5f9;
                                        padding-bottom: 16px;
                                    ">
                                        ${module.resources.videos && module.resources.videos.length > 0 ? `
                                            <div style="
                                                background: linear-gradient(135deg, #fef3c7, #fde68a);
                                                color: #92400e;
                                                padding: 8px 16px;
                                                border-radius: 8px;
                                                font-size: 13px;
                                                font-weight: 600;
                                                display: flex;
                                                align-items: center;
                                                gap: 6px;
                                            ">
                                                ğŸ“¹ ë™ì˜ìƒ ${module.resources.videos.length}ê°œ
                                            </div>
                                        ` : ''}
                                        ${module.resources.web_links && module.resources.web_links.length > 0 ? `
                                            <div style="
                                                background: linear-gradient(135deg, #dbeafe, #bfdbfe);
                                                color: #1e40af;
                                                padding: 8px 16px;
                                                border-radius: 8px;
                                                font-size: 13px;
                                                font-weight: 600;
                                                display: flex;
                                                align-items: center;
                                                gap: 6px;
                                            ">
                                                ğŸŒ ì›¹ìë£Œ ${module.resources.web_links.length}ê°œ
                                            </div>
                                        ` : ''}
                                        ${module.resources.documents && module.resources.documents.length > 0 ? `
                                            <div style="
                                                background: linear-gradient(135deg, #ecfdf5, #d1fae5);
                                                color: #065f46;
                                                padding: 8px 16px;
                                                border-radius: 8px;
                                                font-size: 13px;
                                                font-weight: 600;
                                                display: flex;
                                                align-items: center;
                                                gap: 6px;
                                            ">
                                                ğŸ“„ ë¬¸ì„œ ${module.resources.documents.length}ê°œ
                                            </div>
                                        ` : ''}
                                    </div>
                                    
                                    <!-- ë¦¬ì†ŒìŠ¤ ë¦¬ìŠ¤íŠ¸ -->
                                    <div style="display: grid; gap: 20px;">
                                        ${module.resources.videos && module.resources.videos.length > 0 ? `
                                            <div>
                                                <h4 style="
                                                    font-size: 17px;
                                                    font-weight: 700;
                                                    color: #374151;
                                                    margin-bottom: 12px;
                                                    display: flex;
                                                    align-items: center;
                                                    gap: 8px;
                                                ">
                                                    <span style="color: #f59e0b;">ğŸ“¹</span>
                                                    ë™ì˜ìƒ ê°•ì˜
                                                </h4>
                                                <div style="display: grid; gap: 10px;">
                                                    ${module.resources.videos.map((video, idx) => `
                                                        <a href="${video.url}" target="_blank" style="
                                                            display: flex;
                                                            align-items: center;
                                                            gap: 12px;
                                                            background: linear-gradient(135deg, #fffbeb, #fef3c7);
                                                            border: 1px solid #fed7aa;
                                                            border-radius: 12px;
                                                            padding: 16px;
                                                            text-decoration: none;
                                                            color: #92400e;
                                                            transition: all 0.2s ease;
                                                            position: relative;
                                                            overflow: hidden;
                                                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(245, 158, 11, 0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                                            <div style="
                                                                background: #f59e0b;
                                                                color: white;
                                                                width: 32px;
                                                                height: 32px;
                                                                border-radius: 8px;
                                                                display: flex;
                                                                align-items: center;
                                                                justify-content: center;
                                                                font-weight: 700;
                                                                font-size: 12px;
                                                                flex-shrink: 0;
                                                            ">${idx + 1}</div>
                                                            <div style="flex: 1;">
                                                                <div style="font-weight: 600; font-size: 15px; line-height: 1.4;">
                                                                    ${video.title}
                                                                </div>
                                                            </div>
                                                            <div style="
                                                                background: rgba(245, 158, 11, 0.2);
                                                                color: #92400e;
                                                                padding: 4px 8px;
                                                                border-radius: 6px;
                                                                font-size: 11px;
                                                                font-weight: 600;
                                                            ">â–¶ ì¬ìƒ</div>
                                                        </a>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        ` : ''}
                                        
                                        ${module.resources.web_links && module.resources.web_links.length > 0 ? `
                                            <div>
                                                <h4 style="
                                                    font-size: 17px;
                                                    font-weight: 700;
                                                    color: #374151;
                                                    margin-bottom: 12px;
                                                    display: flex;
                                                    align-items: center;
                                                    gap: 8px;
                                                ">
                                                    <span style="color: #3b82f6;">ğŸŒ</span>
                                                    ì›¹ ìë£Œ
                                                </h4>
                                                <div style="display: grid; gap: 10px;">
                                                    ${module.resources.web_links.map((link, idx) => `
                                                        <a href="${link.url}" target="_blank" style="
                                                            display: flex;
                                                            align-items: center;
                                                            gap: 12px;
                                                            background: linear-gradient(135deg, #eff6ff, #dbeafe);
                                                            border: 1px solid #93c5fd;
                                                            border-radius: 12px;
                                                            padding: 16px;
                                                            text-decoration: none;
                                                            color: #1e40af;
                                                            transition: all 0.2s ease;
                                                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(59, 130, 246, 0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                                            <div style="
                                                                background: #3b82f6;
                                                                color: white;
                                                                width: 32px;
                                                                height: 32px;
                                                                border-radius: 8px;
                                                                display: flex;
                                                                align-items: center;
                                                                justify-content: center;
                                                                font-weight: 700;
                                                                font-size: 12px;
                                                                flex-shrink: 0;
                                                            ">${idx + 1}</div>
                                                            <div style="flex: 1;">
                                                                <div style="font-weight: 600; font-size: 15px; line-height: 1.4;">
                                                                    ${link.title}
                                                                </div>
                                                            </div>
                                                            <div style="
                                                                background: rgba(59, 130, 246, 0.2);
                                                                color: #1e40af;
                                                                padding: 4px 8px;
                                                                border-radius: 6px;
                                                                font-size: 11px;
                                                                font-weight: 600;
                                                            ">ğŸ”— ë§í¬</div>
                                                        </a>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        ` : ''}
                                        
                                        ${module.resources.documents && module.resources.documents.length > 0 ? `
                                            <div>
                                                <h4 style="
                                                    font-size: 17px;
                                                    font-weight: 700;
                                                    color: #374151;
                                                    margin-bottom: 12px;
                                                    display: flex;
                                                    align-items: center;
                                                    gap: 8px;
                                                ">
                                                    <span style="color: #10b981;">ğŸ“„</span>
                                                    ë¬¸ì„œ ìë£Œ
                                                </h4>
                                                <div style="display: grid; gap: 10px;">
                                                    ${module.resources.documents.map((doc, idx) => `
                                                        <a href="${doc.url}" target="_blank" style="
                                                            display: flex;
                                                            align-items: center;
                                                            gap: 12px;
                                                            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
                                                            border: 1px solid #86efac;
                                                            border-radius: 12px;
                                                            padding: 16px;
                                                            text-decoration: none;
                                                            color: #065f46;
                                                            transition: all 0.2s ease;
                                                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(16, 185, 129, 0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                                            <div style="
                                                                background: #10b981;
                                                                color: white;
                                                                width: 32px;
                                                                height: 32px;
                                                                border-radius: 8px;
                                                                display: flex;
                                                                align-items: center;
                                                                justify-content: center;
                                                                font-weight: 700;
                                                                font-size: 12px;
                                                                flex-shrink: 0;
                                                            ">${idx + 1}</div>
                                                            <div style="flex: 1;">
                                                                <div style="font-weight: 600; font-size: 15px; line-height: 1.4;">
                                                                    ${doc.title}
                                                                </div>
                                                            </div>
                                                            <div style="
                                                                background: rgba(16, 185, 129, 0.2);
                                                                color: #065f46;
                                                                padding: 4px 8px;
                                                                border-radius: 6px;
                                                                font-size: 11px;
                                                                font-weight: 600;
                                                            ">ğŸ“ ë‹¤ìš´ë¡œë“œ</div>
                                                        </a>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <!-- í•™ìŠµ ì™„ë£Œ ì²´í¬ë°•ìŠ¤ -->
                            <div style="
                                margin-top: 24px;
                                background: white;
                                border-radius: 16px;
                                padding: 24px;
                                border: 1px solid #e2e8f0;
                                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
                                text-align: center;
                            ">
                                ${(() => {
                                    const completedWeeks = StorageManager.curriculum.progress.get();
                                    const isCompleted = completedWeeks.includes(moduleIndex);
                                    return `
                                        <div style="
                                            background: ${isCompleted ? 'linear-gradient(135deg, #dcfce7, #bbf7d0)' : 'linear-gradient(135deg, #f8fafc, #e2e8f0)'};
                                            border: 2px solid ${isCompleted ? '#10b981' : '#cbd5e1'};
                                            border-radius: 16px;
                                            padding: 20px;
                                            margin-bottom: 16px;
                                            transition: all 0.3s ease;
                                            cursor: pointer;
                                        " onclick="document.getElementById('completeWeek-${moduleIndex}').click()">
                                            <div style="
                                                display: flex;
                                                align-items: center;
                                                justify-content: center;
                                                gap: 16px;
                                                margin-bottom: 12px;
                                            ">
                                                <div style="
                                                    position: relative;
                                                    width: 28px;
                                                    height: 28px;
                                                ">
                                                    <input 
                                                        type="checkbox" 
                                                        id="completeWeek-${moduleIndex}"
                                                        ${isCompleted ? 'checked' : ''}
                                                        onchange="toggleWeekCompletion(${moduleIndex})"
                                                        style="
                                                            width: 28px;
                                                            height: 28px;
                                                            accent-color: ${weekColor};
                                                            cursor: pointer;
                                                            border-radius: 8px;
                                                        "
                                                    />
                                                </div>
                                                <div>
                                                    <div style="
                                                        font-size: 18px;
                                                        font-weight: 700;
                                                        color: ${isCompleted ? '#065f46' : '#475569'};
                                                        margin-bottom: 4px;
                                                        display: flex;
                                                        align-items: center;
                                                        gap: 8px;
                                                    ">
                                                        <span style="font-size: 20px;">
                                                            ${isCompleted ? 'âœ…' : 'ğŸ“š'}
                                                        </span>
                                                        ${isCompleted ? 'í•™ìŠµ ì™„ë£Œë¨' : 'í•™ìŠµ ì™„ë£Œí•˜ê¸°'}
                                                    </div>
                                                    <div style="
                                                        font-size: 13px;
                                                        color: ${isCompleted ? '#059669' : '#64748b'};
                                                        font-weight: 500;
                                                    ">
                                                        ${isCompleted ? 'ì´ ì£¼ì°¨ì˜ ëª¨ë“  í•™ìŠµì„ ë§ˆì³¤ìŠµë‹ˆë‹¤' : 'í•™ìŠµì„ ì™„ë£Œí•˜ë©´ ì²´í¬í•´ì£¼ì„¸ìš”'}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        ${isCompleted ? `
                                            <div style="
                                                background: linear-gradient(135deg, #059669, #10b981);
                                                color: white;
                                                padding: 12px 20px;
                                                border-radius: 12px;
                                                font-size: 14px;
                                                font-weight: 600;
                                                text-align: center;
                                            ">
                                                ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! Week ${module.week} í•™ìŠµì„ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆë‹¤!
                                            </div>
                                        ` : `
                                            <div style="
                                                background: #f8fafc;
                                                border: 1px dashed #cbd5e1;
                                                color: #64748b;
                                                padding: 16px;
                                                border-radius: 12px;
                                                font-size: 13px;
                                                line-height: 1.5;
                                                text-align: center;
                                            ">
                                                ëª¨ë“  í•™ìŠµ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ì…¨ë‹¤ë©´ ìœ„ ì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.<br>
                                                <strong>ì§„í–‰ë„ê°€ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸</strong>ë˜ì–´ ì „ì²´ í•™ìŠµ í˜„í™©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                            </div>
                                        `}
                                    `;
                                })()}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // ëª¨ë‹¬ì„ bodyì— ì¶”ê°€
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModuleModal(event) {
            if (event && event.target !== event.currentTarget) return;
            
            const modal = document.getElementById('moduleModal');
            if (modal) {
                modal.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        }
        
        // ì£¼ì°¨ ì™„ë£Œ ìƒíƒœ í† ê¸€
        function toggleWeekCompletion(moduleIndex) {
            const completedWeeks = StorageManager.curriculum.progress.get();
            const isCurrentlyCompleted = completedWeeks.includes(moduleIndex);
            
            if (isCurrentlyCompleted) {
                // ì™„ë£Œ í•´ì œ
                StorageManager.curriculum.progress.remove(moduleIndex);
                showNotification(`${moduleIndex + 1}ì£¼ì°¨ ì™„ë£Œ ìƒíƒœê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'info');
            } else {
                // ì™„ë£Œ ì¶”ê°€
                StorageManager.curriculum.progress.add(moduleIndex);
                showNotification(`ğŸ‰ ${moduleIndex + 1}ì£¼ì°¨ë¥¼ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆë‹¤!`, 'success');
                
                // ì™„ë£Œ íš¨ê³¼ ì• ë‹ˆë©”ì´ì…˜
                setTimeout(() => {
                    const checkbox = document.getElementById(`completeWeek-${moduleIndex}`);
                    if (checkbox) {
                        checkbox.style.transform = 'scale(1.2)';
                        setTimeout(() => {
                            checkbox.style.transform = 'scale(1)';
                        }, 200);
                    }
                }, 100);
            }
            
            // ì™„ë£Œ ì²˜ë¦¬ í›„ ëª¨ë‹¬ ë‹«ê¸° ë° ì „ì²´ ì»¤ë¦¬í˜ëŸ¼ìœ¼ë¡œ ë³µê·€
            setTimeout(() => {
                closeModuleModal();
                
                // ì»¤ë¦¬í˜ëŸ¼ í˜ì´ì§€ë¡œ ì´ë™í•˜ì—¬ ì—…ë°ì´íŠ¸ëœ ì§„í–‰ë¥  í‘œì‹œ
                switchToTab('curriculum');
                
                // ì»¤ë¦¬í˜ëŸ¼ ì½˜í…ì¸  ìƒˆë¡œê³ ì¹¨
                const curriculumContent = document.getElementById('curriculumContent');
                if (curriculumContent) {
                    const curriculumData = StorageManager.curriculum.get();
                    if (curriculumData) {
                        displayCurriculumCards(curriculumContent, curriculumData);
                    }
                }
            }, 300);
            
            // ì „ì²´ ì»¤ë¦¬í˜ëŸ¼ ì§„í–‰ë„ ì—…ë°ì´íŠ¸
            updateCurriculumProgress();
        }
        
        // ì»¤ë¦¬í˜ëŸ¼ ì§„í–‰ë„ ì—…ë°ì´íŠ¸
        function updateCurriculumProgress() {
            const curriculumContent = document.getElementById('curriculumContent');
            if (curriculumContent && curriculumContent.style.display === 'block') {
                const curriculumData = StorageManager.curriculum.get();
                if (curriculumData && curriculumData.modules) {
                    displayCurriculumCards(curriculumContent, curriculumData);
                }
            }
        }
        
        // ì§„í–‰ë„ ì´ˆê¸°í™” (ìƒˆ ì„¸ì…˜ì´ë‚˜ ì»¤ë¦¬í˜ëŸ¼ ì¬ìƒì„± ì‹œ)
        function resetCurriculumProgress() {
            StorageManager.curriculum.progress.clear();
            updateCurriculumProgress();
        }

        // ì„ íƒëœ ë©˜í† ë“¤ ì €ì¥ ë°°ì—´
        let selectedMentors = [];

        // ìì—°ì–´ ì§ˆë¬¸ìœ¼ë¡œ ë©˜í†  ì°¾ê¸°
        // 10ê°œ í˜ë¥´ì†Œë‚˜ ì •ë³´ ì •ì˜
        const PERSONAS = {
            architecture: { name: "ê±´ì¶•", expertise: "ê±´ì¶• ì„¤ê³„, ê±´ì¶• êµ¬ì¡°, ê±´ì¶• í™˜ê²½, BIM, ì¸í…Œë¦¬ì–´ ë””ìì¸, ë„ì‹œê±´ì¶•", icon: "fas fa-building", color: "linear-gradient(135deg, #667eea, #764ba2)" },
            civil_urban: { name: "í† ëª© ë„ì‹œ", expertise: "í† ëª©ê³µí•™, ë„ì‹œê³„íš, ë„ì‹œì„¤ê³„, ì§€ë°˜ê³µí•™, êµ¬ì¡°ì—­í•™, êµí†µê³µí•™", icon: "fas fa-city", color: "linear-gradient(135deg, #a855f7, #ec4899)" },
            transport: { name: "êµí†µ ìš´ì†¡", expertise: "êµí†µì‹œìŠ¤í…œ, ë¬¼ë¥˜ê´€ë¦¬, êµí†µì •ì±…, ìŠ¤ë§ˆíŠ¸ ëª¨ë¹Œë¦¬í‹°, ìš´ì†¡ê²½ì œí•™", icon: "fas fa-truck", color: "linear-gradient(135deg, #10b981, #059669)" },
            mechanical: { name: "ê¸°ê³„ ê¸ˆì†", expertise: "ê¸°ê³„ì„¤ê³„, ì¬ë£Œê³µí•™, ìƒì‚°ê³µí•™, ìë™í™”, ì—´ì—­í•™, ìœ ì²´ì—­í•™", icon: "fas fa-cog", color: "linear-gradient(135deg, #6366f1, #8b5cf6)" },
            electrical: { name: "ì „ê¸° ì „ì", expertise: "ì „ê¸°ê³µí•™, ì „ìíšŒë¡œ, ì œì–´ì‹œìŠ¤í…œ, ì „ë ¥ì‹œìŠ¤í…œ, ì‹ í˜¸ì²˜ë¦¬, ì„ë² ë””ë“œ", icon: "fas fa-bolt", color: "linear-gradient(135deg, #f59e0b, #d97706)" },
            precision_energy: { name: "ì •ë°€ ì—ë„ˆì§€", expertise: "ì •ë°€ê¸°ê¸°, ì¸¡ì •ê³µí•™, ì—ë„ˆì§€ì‹œìŠ¤í…œ, ì‹ ì¬ìƒì—ë„ˆì§€, ì—ë„ˆì§€íš¨ìœ¨", icon: "fas fa-atom", color: "linear-gradient(135deg, #059669, #047857)" },
            materials: { name: "ì†Œì¬ ì¬ë£Œ", expertise: "ì‹ ì†Œì¬, ë‚˜ë…¸ê¸°ìˆ , ì¬ë£Œê³¼í•™, ê³ ë¶„ì, ì„¸ë¼ë¯¹, ê¸ˆì†ì¬ë£Œ", icon: "fas fa-flask", color: "linear-gradient(135deg, #dc2626, #b91c1c)" },
            computer: { name: "ì»´í“¨í„° í†µì‹ ", expertise: "ì†Œí”„íŠ¸ì›¨ì–´ê³µí•™, ë„¤íŠ¸ì›Œí¬, ë°ì´í„°ë² ì´ìŠ¤, AI/ML, ì‚¬ì´ë²„ë³´ì•ˆ, í´ë¼ìš°ë“œ", icon: "fas fa-laptop-code", color: "linear-gradient(135deg, #3b82f6, #2563eb)" },
            industrial: { name: "ì‚°ì—…", expertise: "ì‚°ì—…ê³µí•™, í’ˆì§ˆê´€ë¦¬, ìƒì‚°ê´€ë¦¬, ê³µê¸‰ë§ê´€ë¦¬, ë¦°ì œì¡°, 6ì‹œê·¸ë§ˆ", icon: "fas fa-industry", color: "linear-gradient(135deg, #7c3aed, #6d28d9)" },
            chemical: { name: "í™”ê³µ", expertise: "í™”í•™ê³µí•™, ê³µì •ì„¤ê³„, ë°˜ì‘ê³µí•™, ë¶„ë¦¬ê³µì •, í™”í•™í”ŒëœíŠ¸, ì•ˆì „ê³µí•™", icon: "fas fa-vial", color: "linear-gradient(135deg, #16a34a, #15803d)" }
        };

        async function findMentorByQuestion() {
            const question = document.getElementById('naturalQuestionInput').value.trim();
            if (!question) {
                showNotification('ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }

            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-right: 8px;"></i>ë¶„ì„ ì¤‘...';
            button.disabled = true;

            try {
                // mentor_chat.py API í˜¸ì¶œ ì‹œë„, ì‹¤íŒ¨í•˜ë©´ ì„ì‹œ í‚¤ì›Œë“œ ë§¤ì¹­ ì‚¬ìš©
                let result;
                try {
                    const response = await fetch('/api/mentor_chat/analyze_and_recommend_personas', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: question,
                            session_id: SESSION_ID
                        })
                    });

                    if (response.ok) {
                        result = await response.json();
                    } else {
                        throw new Error('API ì‘ë‹µ ì˜¤ë¥˜');
                    }
                } catch (apiError) {
                    console.log('API í˜¸ì¶œ ì‹¤íŒ¨, í‚¤ì›Œë“œ ë§¤ì¹­ ì‚¬ìš©:', apiError);
                    
                    // ì„ì‹œ í‚¤ì›Œë“œ ë§¤ì¹­ ë¡œì§
                    result = performKeywordMatching(question);
                }
                
                // ì¶”ì²œëœ í˜ë¥´ì†Œë‚˜ë“¤ì„ í‘œì‹œ
                displayRecommendedPersonas(result.recommended_personas, result.reasoning);
                
                showNotification(`${result.recommended_personas.length}ê°œì˜ ì „ë¬¸ ë¶„ì•¼ ë©˜í† ë¥¼ ì¶”ì²œí–ˆìŠµë‹ˆë‹¤!`, 'success');
                
            } catch (error) {
                console.error('ë©˜í†  ì¶”ì²œ ì˜¤ë¥˜:', error);
                showNotification('ë©˜í†  ì¶”ì²œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
            } finally {
                // ë²„íŠ¼ ì›ìƒë³µêµ¬
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        // ì¶”ì²œëœ í˜ë¥´ì†Œë‚˜ë“¤ì„ ì„ íƒëœ ë©˜í†  ì˜ì—­ì— ë°”ë¡œ í‘œì‹œ
        function displayRecommendedPersonas(recommendedPersonas, reasoning) {
            // ì¶”ì²œëœ í˜ë¥´ì†Œë‚˜ë“¤ì„ ì„ íƒëœ ë©˜í†  ì˜ì—­ì— ì¶”ê°€
            recommendedPersonas.forEach(persona => {
                addPersonaToSelectedMentors(persona);
            });
            
            // ì„ íƒëœ ë©˜í†  ì˜ì—­ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            const selectedMentorsSection = document.getElementById('selectedMentors');
            setTimeout(() => {
                selectedMentorsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 300);
        }

        // í˜ë¥´ì†Œë‚˜ë¥¼ ì„ íƒëœ ë©˜í†  ì˜ì—­ì— ì¶”ê°€
        function addPersonaToSelectedMentors(persona) {
            // ê³µë°± ë¬¸ì œ ë° ë‹¤ì–‘í•œ í‚¤ ì´ë¦„ ì²˜ë¦¬
            const cleanPersona = {
                id: getValueFromObject(persona, ['id', ' id']),
                name: getValueFromObject(persona, ['name', ' name']),
                reason: getValueFromObject(persona, [
                    'reason', ' reason', 
                    'reasoning', ' reasoning',
                    'explanation', ' explanation',
                    'rationale', ' rationale',
                    'justification', ' justification',
                    'description', ' description'
                ])
            };
            
            // ê¸°ë³¸ê°’ ì„¤ì •
            if (!cleanPersona.reason) {
                cleanPersona.reason = `${cleanPersona.name || 'í•´ë‹¹ ë¶„ì•¼'} ì „ë¬¸ê°€ë¡œ ì¶”ì²œë˜ì—ˆìŠµë‹ˆë‹¤.`;
            }
            
            console.log('ì›ë³¸ persona:', persona);
            console.log('ì •ë¦¬ëœ persona:', cleanPersona);
            
            const personaInfo = PERSONAS[cleanPersona.id];
            if (!personaInfo) {
                console.error(`í˜ë¥´ì†Œë‚˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${cleanPersona.id}`);
                console.log('ì‚¬ìš© ê°€ëŠ¥í•œ í˜ë¥´ì†Œë‚˜ë“¤:', Object.keys(PERSONAS));
                return;
            }
            
            // ì´ë¯¸ ì„ íƒëœ í˜ë¥´ì†Œë‚˜ì¸ì§€ í™•ì¸
            const existingPersona = document.querySelector(`[data-selected-persona="${cleanPersona.id}"]`);
            if (existingPersona) return;
            
            const selectedMentorsContainer = document.getElementById('selectedMentors');
            
            // ì²« ë²ˆì§¸ í˜ë¥´ì†Œë‚˜ ì¶”ê°€ì‹œ ê¸°ë³¸ ë©”ì‹œì§€ ì œê±°
            if (selectedMentorsContainer.innerHTML.includes('ì„ íƒëœ ë©˜í† ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤')) {
                selectedMentorsContainer.innerHTML = '';
            }
            
            // í˜ë¥´ì†Œë‚˜ ì¹´ë“œ ìƒì„±
            const personaCard = document.createElement('div');
            personaCard.setAttribute('data-selected-persona', cleanPersona.id);
            personaCard.style.cssText = `
                background: linear-gradient(135deg, #f8faff, #f1f5ff);
                border: 2px solid #667eea;
                border-radius: 12px;
                padding: 16px;
                margin-bottom: 12px;
                position: relative;
                transition: all 0.3s;
            `;
            
            personaCard.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 48px; height: 48px; background: ${personaInfo.color}; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <i class="${personaInfo.icon}" style="color: white; font-size: 20px;"></i>
                    </div>
                    <div style="flex: 1; min-width: 0;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                            <h4 style="font-size: 16px; font-weight: 700; color: #4c1d95; margin: 0;">${personaInfo.name}</h4>
                            <span style="background: #667eea; color: white; font-size: 10px; font-weight: 600; padding: 2px 6px; border-radius: 8px;">AI ì¶”ì²œ</span>
                        </div>
                        <p style="font-size: 12px; color: #6366f1; line-height: 1.3; margin: 0 0 6px 0;">
                            ${personaInfo.expertise}
                        </p>
                        <div style="background: rgba(102, 126, 234, 0.1); border-radius: 6px; padding: 8px;">
                            <p style="font-size: 10px; color: #4c1d95; font-weight: 600; margin: 0 0 2px 0;">ì¶”ì²œ ì´ìœ :</p>
                            <p style="font-size: 10px; color: #6366f1; line-height: 1.2; margin: 0;">${cleanPersona.reason}</p>
                        </div>
                    </div>
                    <button onclick="removeSelectedPersona('${cleanPersona.id}')" style="
                        position: absolute;
                        top: 8px;
                        right: 8px;
                        background: #ef4444;
                        color: white;
                        border: none;
                        border-radius: 50%;
                        width: 24px;
                        height: 24px;
                        cursor: pointer;
                        font-size: 12px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: background 0.2s;
                    " onmouseover="this.style.background='#dc2626'" onmouseout="this.style.background='#ef4444'">
                        Ã—
                    </button>
                </div>
            `;
            
            selectedMentorsContainer.appendChild(personaCard);
            
            // ì‹œì‘ ë²„íŠ¼ í™œì„±í™”
            updateStartButton();
        }

        // ì„ íƒëœ í˜ë¥´ì†Œë‚˜ ì œê±°
        function removeSelectedPersona(personaId) {
            const personaCard = document.querySelector(`[data-selected-persona="${personaId}"]`);
            if (personaCard) {
                personaCard.remove();
            }
            
            // ì„ íƒëœ ë©˜í† ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ë©”ì‹œì§€ í‘œì‹œ
            const selectedMentorsContainer = document.getElementById('selectedMentors');
            if (selectedMentorsContainer.children.length === 0) {
                selectedMentorsContainer.innerHTML = '<div style="color: #6b7280; font-size: 14px;">ì„ íƒëœ ë©˜í† ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>';
            }
            
            updateStartButton();
        }

        // ì¶”ì²œ ê²°ê³¼ ìˆ¨ê¸°ê¸°
        function hideRecommendedPersonas() {
            const recommendedSection = document.getElementById('recommendedPersonas');
            recommendedSection.style.display = 'none';
        }

        // í—¬í¼ í•¨ìˆ˜: ê°ì²´ì—ì„œ ì—¬ëŸ¬ í‚¤ ì¤‘ í•˜ë‚˜ì˜ ê°’ì„ ì°¾ì•„ ë°˜í™˜
        function getValueFromObject(obj, keys) {
            for (const key of keys) {
                if (obj && typeof obj === 'object' && key in obj && obj[key]) {
                    return obj[key].toString().trim();
                }
            }
            return '';
        }

        // ì„ì‹œ í‚¤ì›Œë“œ ë§¤ì¹­ ë¡œì§
        function performKeywordMatching(question) {
            const questionLower = question.toLowerCase();
            const recommendedPersonas = [];
            
            // í‚¤ì›Œë“œë³„ í˜ë¥´ì†Œë‚˜ ë§¤ì¹­
            if (questionLower.includes('ê±´ì¶•') || questionLower.includes('ê±´ë¬¼') || questionLower.includes('ì„¤ê³„') || questionLower.includes('ì¸í…Œë¦¬ì–´')) {
                recommendedPersonas.push({
                    id: 'architecture',
                    name: 'ê±´ì¶•',
                    reason: 'ê±´ì¶• ê´€ë ¨ í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.'
                });
            }
            
            if (questionLower.includes('í† ëª©') || questionLower.includes('ë„ì‹œ') || questionLower.includes('ê±´ì„¤') || questionLower.includes('ì§€ë°˜')) {
                recommendedPersonas.push({
                    id: 'civil_urban',
                    name: 'í† ëª© ë„ì‹œ',
                    reason: 'í† ëª© ë° ë„ì‹œê³„íš ê´€ë ¨ í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.'
                });
            }
            
            if (questionLower.includes('êµí†µ') || questionLower.includes('ë¬¼ë¥˜') || questionLower.includes('ìš´ì†¡') || questionLower.includes('ëª¨ë¹Œë¦¬í‹°')) {
                recommendedPersonas.push({
                    id: 'transport',
                    name: 'êµí†µ ìš´ì†¡',
                    reason: 'êµí†µ ë° ìš´ì†¡ ê´€ë ¨ í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.'
                });
            }
            
            if (questionLower.includes('ê¸°ê³„') || questionLower.includes('ê¸ˆì†') || questionLower.includes('ìë™í™”') || questionLower.includes('ì œì¡°')) {
                recommendedPersonas.push({
                    id: 'mechanical',
                    name: 'ê¸°ê³„ ê¸ˆì†',
                    reason: 'ê¸°ê³„ê³µí•™ ê´€ë ¨ í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.'
                });
            }
            
            if (questionLower.includes('ì „ê¸°') || questionLower.includes('ì „ì') || questionLower.includes('íšŒë¡œ') || questionLower.includes('ì œì–´')) {
                recommendedPersonas.push({
                    id: 'electrical',
                    name: 'ì „ê¸° ì „ì',
                    reason: 'ì „ê¸°ì „ìê³µí•™ ê´€ë ¨ í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.'
                });
            }
            
            if (questionLower.includes('ì—ë„ˆì§€') || questionLower.includes('ì •ë°€') || questionLower.includes('ì‹ ì¬ìƒ')) {
                recommendedPersonas.push({
                    id: 'precision_energy',
                    name: 'ì •ë°€ ì—ë„ˆì§€',
                    reason: 'ì—ë„ˆì§€ ë° ì •ë°€ê¸°ê¸° ê´€ë ¨ í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.'
                });
            }
            
            if (questionLower.includes('ì†Œì¬') || questionLower.includes('ì¬ë£Œ') || questionLower.includes('ë‚˜ë…¸') || questionLower.includes('ê³ ë¶„ì')) {
                recommendedPersonas.push({
                    id: 'materials',
                    name: 'ì†Œì¬ ì¬ë£Œ',
                    reason: 'ì†Œì¬ ë° ì¬ë£Œê³¼í•™ ê´€ë ¨ í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.'
                });
            }
            
            if (questionLower.includes('ì»´í“¨í„°') || questionLower.includes('í”„ë¡œê·¸ë˜ë°') || questionLower.includes('ê°œë°œ') || questionLower.includes('ì½”ë”©') || questionLower.includes('ì†Œí”„íŠ¸ì›¨ì–´') || questionLower.includes('ai') || questionLower.includes('ë¨¸ì‹ ëŸ¬ë‹') || questionLower.includes('ì›¹')) {
                recommendedPersonas.push({
                    id: 'computer',
                    name: 'ì»´í“¨í„° í†µì‹ ',
                    reason: 'ì»´í“¨í„° ë° ì†Œí”„íŠ¸ì›¨ì–´ ê´€ë ¨ í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.'
                });
            }
            
            if (questionLower.includes('ì‚°ì—…') || questionLower.includes('í’ˆì§ˆ') || questionLower.includes('ìƒì‚°') || questionLower.includes('ê³µê¸‰ë§') || questionLower.includes('ë¦°') || questionLower.includes('6ì‹œê·¸ë§ˆ')) {
                recommendedPersonas.push({
                    id: 'industrial',
                    name: 'ì‚°ì—…',
                    reason: 'ì‚°ì—…ê³µí•™ ê´€ë ¨ í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.'
                });
            }
            
            if (questionLower.includes('í™”í•™') || questionLower.includes('í™”ê³µ') || questionLower.includes('ê³µì •') || questionLower.includes('ë°˜ì‘') || questionLower.includes('í”ŒëœíŠ¸')) {
                recommendedPersonas.push({
                    id: 'chemical',
                    name: 'í™”ê³µ',
                    reason: 'í™”í•™ê³µí•™ ê´€ë ¨ í‚¤ì›Œë“œê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.'
                });
            }
            
            // ê¸°ë³¸ ì¶”ì²œ (í‚¤ì›Œë“œê°€ ë§¤ì¹­ë˜ì§€ ì•Šì€ ê²½ìš°)
            if (recommendedPersonas.length === 0) {
                recommendedPersonas.push({
                    id: 'computer',
                    name: 'ì»´í“¨í„° í†µì‹ ',
                    reason: 'ì¼ë°˜ì ì¸ í•™ìŠµ ë¬¸ì˜ë¡œ íŒë‹¨ë˜ì–´ ì»´í“¨í„° ë¶„ì•¼ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.'
                });
            }
            
            return {
                recommended_personas: recommendedPersonas,
                reasoning: `í‚¤ì›Œë“œ ë¶„ì„ì„ í†µí•´ ${recommendedPersonas.length}ê°œì˜ ì „ë¬¸ ë¶„ì•¼ë¥¼ ì¶”ì²œí–ˆìŠµë‹ˆë‹¤.`
            };
        }

        // ë©˜í†  ì„ íƒ
        function selectMentor(mentorType) {
            if (selectedMentors.includes(mentorType)) return;
            
            selectedMentors.push(mentorType);
            updateSelectedMentorsDisplay();
            updateStartButton();
            
            // ì„ íƒëœ ì¹´ë“œ ìŠ¤íƒ€ì¼ ë³€ê²½
            const card = document.querySelector(`[data-mentor="${mentorType}"]`);
            if (card) {
                card.style.borderColor = '#667eea';
                card.style.backgroundColor = '#f0f4ff';
            }
        }

        // ë©˜í†  ì„ íƒ í•´ì œ
        function deselectMentor(mentorType) {
            selectedMentors = selectedMentors.filter(m => m !== mentorType);
            updateSelectedMentorsDisplay();
            updateStartButton();
            
            // ì¹´ë“œ ìŠ¤íƒ€ì¼ ì›ë˜ëŒ€ë¡œ
            const card = document.querySelector(`[data-mentor="${mentorType}"]`);
            if (card) {
                card.style.borderColor = '#e5e7eb';
                card.style.backgroundColor = 'white';
            }
        }

        // ì„ íƒëœ ë©˜í† ë“¤ í™”ë©´ ì—…ë°ì´íŠ¸
        function updateSelectedMentorsDisplay() {
            const container = document.getElementById('selectedMentors');
            if (!container) return;
            
            if (selectedMentors.length === 0) {
                container.innerHTML = '<div style="color: #6b7280; font-size: 14px;">ì„ íƒëœ ë©˜í† ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>';
                return;
            }
            
            const mentorNames = {
                engineer: { name: 'ì—…ë¬´ ê³¼ì™¸ ì„ ìƒë‹˜', icon: '<i class="fas fa-briefcase"></i>', desc: 'ì‹¤ë¬´ ìŠ¤í‚¬' },
                executive: { name: 'ì¼íƒ€ ê°•ì‚¬', icon: '<i class="fas fa-star"></i>', desc: 'í•µì‹¬ ì„¤ëª…' },
                professor: { name: 'êµìˆ˜', icon: '<i class="fas fa-graduation-cap"></i>', desc: 'í•™ìŠµ ì§€ì›' },
                designer: { name: 'ê°œë°œì', icon: '<i class="fas fa-code"></i>', desc: 'í”„ë¡œê·¸ë˜ë°' },
                datascientist: { name: 'ì˜ì–´ ì„ ìƒë‹˜', icon: '<i class="fas fa-language"></i>', desc: 'ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ì–´' },
                marketing: { name: 'ëª…ë¦¬í•™ì', icon: '<i class="fas fa-magic"></i>', desc: 'ì§ì¥ ìš´ì„¸' }
            };
            
            const mentorCards = selectedMentors.map(mentorType => {
                const mentor = mentorNames[mentorType];
                return `
                    <div style="
                        display: inline-block;
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        color: white;
                        padding: 12px 20px;
                        border-radius: 20px;
                        margin: 5px;
                        font-size: 14px;
                        position: relative;
                    ">
                        <span style="margin-right: 8px;">${mentor.icon}</span>
                        <strong>${mentor.name}</strong>
                        <button onclick="deselectMentor('${mentorType}')" style="
                            background: none;
                            border: none;
                            color: white;
                            margin-left: 10px;
                            cursor: pointer;
                            font-size: 16px;
                            padding: 0;
                        ">Ã—</button>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = mentorCards;
        }

        // ì‹œì‘ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
        function updateStartButton() {
            const btn = document.getElementById('startMentoringBtn');
            if (!btn) return;
            
            // ê¸°ì¡´ ì„ íƒëœ ë©˜í†  ìˆ˜ + ì¶”ì²œëœ í˜ë¥´ì†Œë‚˜ ìˆ˜ í™•ì¸
            const selectedPersonas = document.querySelectorAll('[data-selected-persona]');
            const totalSelected = selectedMentors.length + selectedPersonas.length;
            
            if (totalSelected > 0) {
                btn.style.opacity = '1';
                btn.style.pointerEvents = 'auto';
                btn.disabled = false;
                btn.innerHTML = `<i class="fas fa-play" style="margin-right: 8px;"></i>ë©˜í†  ì„ íƒ (${totalSelected}ê°œ)`;
            } else {
                btn.style.opacity = '0.5';
                btn.style.pointerEvents = 'none';
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-play" style="margin-right: 8px;"></i>ë©˜í†  ì„ íƒ';
            }
        }

        // ë©˜í† ë§ ì‹œì‘
        function startMentoring() {
            // ê¸°ì¡´ ì„ íƒëœ ë©˜í†  ìˆ˜ + ì¶”ì²œëœ í˜ë¥´ì†Œë‚˜ ìˆ˜ í™•ì¸
            const selectedPersonas = document.querySelectorAll('[data-selected-persona]');
            const totalSelected = selectedMentors.length + selectedPersonas.length;
            
            if (totalSelected === 0) {
                showNotification('ë¨¼ì € ë©˜í† ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            console.log(`ë©˜í† ë§ ì‹œì‘: ê¸°ì¡´ ë©˜í†  ${selectedMentors.length}ê°œ + ì¶”ì²œ í˜ë¥´ì†Œë‚˜ ${selectedPersonas.length}ê°œ`);
            
            // ìƒì„¸ í”„ë¡œí•„ ì„¹ì…˜ ìƒì„±
            createMentorProfileSection();
            
            // ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤
            setTimeout(() => {
                const profileSection = document.getElementById('mentorProfileSection');
                if (profileSection) {
                    profileSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }

        // ë©˜í†  ìƒì„¸ í”„ë¡œí•„ ì„¹ì…˜ ìƒì„±
        function createMentorProfileSection() {
            // ê¸°ì¡´ ì„¹ì…˜ì´ ìˆë‹¤ë©´ ì œê±°
            const existing = document.getElementById('mentorProfileSection');
            if (existing) {
                existing.remove();
            }
            
            // ë©˜í†  ìƒì„¸ ì •ë³´ ì •ì˜
            const mentorProfiles = {
                // ê¸°ì¡´ 6ê°œ ë©˜í†  í”„ë¡œí•„
                engineer: {
                    name: 'ì—…ë¬´ ê³¼ì™¸ ì„ ìƒë‹˜',
                    title: 'ì‹¤ë¬´ ì „ë¬¸ ë©˜í† ',
                    affiliation: 'í˜„ì—… ì‹¤ë¬´ì§„',
                    expertise: 'ì—…ë¬´ íš¨ìœ¨ì„± í–¥ìƒ, ì‹¤ë¬´ ë„êµ¬ í™œìš©, ë¬¸ì œ í•´ê²° ë°©ë²•ë¡  ë° í”„ë¡œì„¸ìŠ¤ ìµœì í™”ì— ëŒ€í•œ ì „ë¬¸ì ì¸ ì§€ì‹ì„ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    description: 'í˜„ì¥ì—ì„œ ë°”ë¡œ ì¨ë¨¹ì„ ìˆ˜ ìˆëŠ” ì‹¤ìš©ì ì¸ ìŠ¤í‚¬ê³¼ ë…¸í•˜ìš°ë¥¼ ì „ìˆ˜í•©ë‹ˆë‹¤. ë³µì¡í•œ ì—…ë¬´ë¥¼ ë‹¨ìˆœí•˜ê²Œ í’€ì–´ë‚´ëŠ” ë°©ë²•ì„ ì•Œë ¤ë“œë ¤ìš”.'
                },
                executive: {
                    name: 'ì¼íƒ€ ê°•ì‚¬',
                    title: 'í•µì‹¬ ìš”ì•½ ì „ë¬¸ê°€',
                    affiliation: 'ì „ë¬¸ êµìœ¡ ê¸°ê´€',
                    expertise: 'ë³µì¡í•œ ê°œë…ì˜ í•µì‹¬ ìš”ì•½, ì „ëµì  ì‚¬ê³  ë°©ì‹, ì˜ì‚¬ê²°ì • í”„ë¡œì„¸ìŠ¤ ë° ê° ë¶„ì•¼ë³„ ì „ë¬¸ ì§€ì‹ ì»¨ì„¤íŒ…ì„ ì œê³µí•©ë‹ˆë‹¤.',
                    description: 'ë³µì¡í•œ ë‚´ìš©ì„ í•µì‹¬ë§Œ ì™ì™ ë½‘ì•„ ëª…ì¾Œí•˜ê²Œ ì„¤ëª…í•´ë“œë¦½ë‹ˆë‹¤. ì‹œê°„ ì—†ëŠ” ë‹¹ì‹ ì„ ìœ„í•œ íš¨ìœ¨ì  í•™ìŠµì„ ì œê³µí•´ìš”.'
                },
                professor: {
                    name: 'êµìˆ˜',
                    title: 'í•™ìˆ  ì—°êµ¬ ì „ë¬¸ê°€',
                    affiliation: 'ëŒ€í•™êµ êµìˆ˜ì§„',
                    expertise: 'ì²´ê³„ì ì¸ êµìœ¡ê³¼ì • ì„¤ê³„, í•™ìˆ  ì—°êµ¬ ë°©ë²•ë¡ , ì´ë¡ ê³¼ ì‹¤ìŠµì˜ ê· í˜•ì¡íŒ ì ‘ê·¼ ë° ì‹¬í™” í•™ìŠµ ë¡œë“œë§µì„ ì œê³µí•©ë‹ˆë‹¤.',
                    description: 'í•™ë¬¸ì  ê¹Šì´ì™€ ì²´ê³„ì ì¸ ì ‘ê·¼ìœ¼ë¡œ íƒ„íƒ„í•œ ê¸°ì´ˆë¶€í„° ê³ ê¸‰ ì´ë¡ ê¹Œì§€ ë‹¨ê³„ë³„ë¡œ ê°€ë¥´ì³ë“œë¦½ë‹ˆë‹¤.'
                },
                designer: {
                    name: 'ê°œë°œì',
                    title: 'í”„ë¡œê·¸ë˜ë° ì‹¤ìŠµ ë©˜í† ',
                    affiliation: 'ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œíŒ€',
                    expertise: 'í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë³„ ì‹¤ìŠµ, ì½”ë“œ ë¦¬ë·° ë° ìµœì í™”, ê°œë°œ í”„ë¡œì íŠ¸ ë©˜í† ë§ ë° ê¸°ìˆ  ë¬¸ì„œ í™œìš©ë²•ì„ ì „ë¬¸ì ìœ¼ë¡œ ì§€ë„í•©ë‹ˆë‹¤.',
                    description: 'ì‹¤ì œ ê°œë°œ í˜„ì¥ì˜ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ì²´ê³„ì ì¸ í”„ë¡œê·¸ë˜ë° ìŠ¤í‚¬ì„ ê°€ë¥´ì³ë“œë¦½ë‹ˆë‹¤. ì´ë¡ ë³´ë‹¤ëŠ” ì‹¤ìŠµ ì¤‘ì‹¬ì˜ í•™ìŠµì„ ì œê³µí•´ìš”.'
                },
                datascientist: {
                    name: 'ì˜ì–´ ì„ ìƒë‹˜',
                    title: 'ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ì–´ ì „ë¬¸ê°€',
                    affiliation: 'ì–´í•™ì›',
                    expertise: 'ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ì–´ íšŒí™”, ì˜ë¬¸ ì´ë©”ì¼ ì‘ì„±ë²•, í”„ë ˆì  í…Œì´ì…˜ ìŠ¤í‚¬, ì˜ì–´ ë©´ì ‘ ëŒ€ë¹„ ë° êµ­ì œ ì—…ë¬´ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ì„ ì „ë¬¸ì ìœ¼ë¡œ ì§€ë„í•©ë‹ˆë‹¤.',
                    description: 'ì‹¤ë¬´ì—ì„œ ë°”ë¡œ í™œìš©í•  ìˆ˜ ìˆëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ì–´ë¥¼ ê°€ë¥´ì³ë“œë¦½ë‹ˆë‹¤. ê¸€ë¡œë²Œ ë¹„ì¦ˆë‹ˆìŠ¤ í™˜ê²½ì—ì„œ ìì‹ ê° ìˆê²Œ ì†Œí†µí•  ìˆ˜ ìˆë„ë¡ ë„ì™€ë“œë ¤ìš”.'
                },
                marketing: {
                    name: 'ëª…ë¦¬í•™ì',
                    title: 'ì§ì¥ì¸ ì „ë¬¸ ëª…ë¦¬í•™ì',
                    affiliation: 'í˜„ëŒ€ì² í•™ê´€',
                    expertise: 'ì§ì¥ ë‚´ ì¸ê°„ê´€ê³„ ìš´ì„¸, ìƒì‚¬ì™€ ë™ë£Œ ê´€ìƒ ë¶„ì„, ìŠ¹ì§„ ì‹œê¸° ì˜ˆì¸¡, ì´ì§ ìš´ íƒ€ì´ë°, íšŒì‚¬ ìƒí™œ ë§ì¶¤ ì‚¬ì£¼í’€ì´ ë° ì˜¤ëŠ˜ì˜ ì—…ë¬´ ìš´ì„¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤.',
                    description: 'íšŒì‚¬ìƒí™œì´ í˜ë“œì‹œë‚˜ìš”? ì˜¤ëŠ˜ ìƒì‚¬ ê¸°ë¶„ì´ ì–´ë–¨ì§€, ë™ë£Œë“¤ê³¼ì˜ ê´€ê³„ëŠ” ì–´ë–»ê²Œ í’€ì–´ê°ˆì§€ ëª…ë¦¬í•™ìœ¼ë¡œ ì¬ë¯¸ìˆê²Œ ì•Œì•„ë³´ì„¸ìš”. ì§ì¥ ìƒí™œì˜ ê³ ë¯¼ì„ ìš´ì„¸ë¡œ í’€ì–´ë“œë ¤ìš”!'
                },
                
                // ìƒˆë¡œ ì¶”ê°€ëœ 10ê°œ í˜ë¥´ì†Œë‚˜ í”„ë¡œí•„
                architecture: {
                    name: 'ê±´ì¶• ì „ë¬¸ê°€',
                    title: 'ê±´ì¶• ì„¤ê³„ ë° ì‹œê³µ ë©˜í† ',
                    affiliation: 'ê±´ì¶•ì‚¬ì‚¬ë¬´ì†Œ',
                    expertise: 'ê±´ì¶• ì„¤ê³„, ê±´ì¶• êµ¬ì¡°, ê±´ì¶• í™˜ê²½, BIM ëª¨ë¸ë§, ì¸í…Œë¦¬ì–´ ë””ìì¸, ë„ì‹œê±´ì¶• ê³„íš ë° ê±´ì¶•ë²•ê·œì— ëŒ€í•œ ì „ë¬¸ì ì¸ ì§€ì‹ì„ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    description: '20ë…„ ê²½ë ¥ì˜ ê±´ì¶• ì „ë¬¸ê°€ë¡œì„œ ì‹¤ë¬´ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ê±´ì¶• ì„¤ê³„ë¶€í„° ì‹œê³µê¹Œì§€ ì²´ê³„ì ìœ¼ë¡œ ê°€ë¥´ì³ë“œë¦½ë‹ˆë‹¤. ë³µì¡í•œ ê±´ì¶• ê°œë…ì„ ì‹¤ì œ í”„ë¡œì íŠ¸ ì‚¬ë¡€ë¡œ ì‰½ê²Œ ì„¤ëª…í•´ë“œë ¤ìš”.'
                },
                civil_urban: {
                    name: 'í† ëª©ë„ì‹œ ì „ë¬¸ê°€',
                    title: 'í† ëª©ê³µí•™ ë° ë„ì‹œê³„íš ë©˜í† ',
                    affiliation: 'ë„ì‹œê³„íšì—°êµ¬ì†Œ',
                    expertise: 'í† ëª©ê³µí•™, ë„ì‹œê³„íš, ë„ì‹œì„¤ê³„, ì§€ë°˜ê³µí•™, êµ¬ì¡°ì—­í•™, êµí†µê³µí•™ ë° ì§€ì†ê°€ëŠ¥í•œ ë„ì‹œ ë°œì „ì— ëŒ€í•œ ì „ë¬¸ì ì¸ ì§€ì‹ì„ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    description: 'ë„ì‹œ ì¸í”„ë¼ êµ¬ì¶•ì˜ ì‹¤ë¬´ ê²½í—˜ì´ í’ë¶€í•œ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì´ë¡ ê³¼ ì‹¤ë¬´ë¥¼ ì—°ê²°í•˜ì—¬ í˜„ì‹¤ì ì¸ ë¬¸ì œ í•´ê²° ë°©ì•ˆì„ ì œì‹œí•˜ë©°, ë¯¸ë˜ ë„ì‹œì— ëŒ€í•œ í†µì°°ë ¥ì„ ì œê³µí•©ë‹ˆë‹¤.'
                },
                transport: {
                    name: 'êµí†µìš´ì†¡ ì „ë¬¸ê°€',
                    title: 'êµí†µì‹œìŠ¤í…œ ë° ë¬¼ë¥˜ ë©˜í† ',
                    affiliation: 'êµí†µì—°êµ¬ì›',
                    expertise: 'êµí†µì‹œìŠ¤í…œ ì„¤ê³„, ë¬¼ë¥˜ê´€ë¦¬, êµí†µì •ì±…, ìŠ¤ë§ˆíŠ¸ ëª¨ë¹Œë¦¬í‹°, ìš´ì†¡ê²½ì œí•™ ë° ë¯¸ë˜ êµí†µ ê¸°ìˆ ì— ëŒ€í•œ ì „ë¬¸ì ì¸ ì§€ì‹ì„ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    description: 'êµí†µ ë° ìš´ì†¡ ì‹œìŠ¤í…œì˜ ìµœì‹  íŠ¸ë Œë“œì™€ ì •ì±… ë™í–¥ì— ë°ì€ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ë°ì´í„° ê¸°ë°˜ ë¶„ì„ê³¼ ì •ì±…ì  ê´€ì ì—ì„œ íš¨ìœ¨ì ì´ê³  ì§€ì†ê°€ëŠ¥í•œ êµí†µ ì†”ë£¨ì…˜ì„ ì œì•ˆí•©ë‹ˆë‹¤.'
                },
                mechanical: {
                    name: 'ê¸°ê³„ê¸ˆì† ì „ë¬¸ê°€',
                    title: 'ê¸°ê³„ê³µí•™ ë° ìƒì‚° ë©˜í† ',
                    affiliation: 'ì œì¡°ì—…ì²´ R&Dì„¼í„°',
                    expertise: 'ê¸°ê³„ì„¤ê³„, ì¬ë£Œê³µí•™, ìƒì‚°ê³µí•™, ìë™í™” ì‹œìŠ¤í…œ, ì—´ì—­í•™, ìœ ì²´ì—­í•™ ë° í˜ì‹ ì ì¸ ê¸°ê³„ ê¸°ìˆ ì— ëŒ€í•œ ì „ë¬¸ì ì¸ ì§€ì‹ì„ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    description: 'ì œì¡°ì—… í˜„ì¥ì—ì„œì˜ í’ë¶€í•œ ì‹¤ë¬´ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ì´ë¡ ê³¼ ì‹¤ì œë¥¼ ì—°ê²°í•´ì„œ ê°€ë¥´ì³ë“œë¦½ë‹ˆë‹¤. ë¯¸ë˜ ì œì¡°ì—… íŠ¸ë Œë“œì™€ Industry 4.0ì— ëŒ€í•œ ê¹Šì€ í†µì°°ë ¥ì„ ì œê³µí•©ë‹ˆë‹¤.'
                },
                electrical: {
                    name: 'ì „ê¸°ì „ì ì „ë¬¸ê°€',
                    title: 'ì „ê¸°ì „ìê³µí•™ ë©˜í† ',
                    affiliation: 'ì „ìê¸°ì—… ê¸°ìˆ ì—°êµ¬ì†Œ',
                    expertise: 'ì „ê¸°ê³µí•™, ì „ìíšŒë¡œ, ì œì–´ì‹œìŠ¤í…œ, ì „ë ¥ì‹œìŠ¤í…œ, ì‹ í˜¸ì²˜ë¦¬, ì„ë² ë””ë“œ ì‹œìŠ¤í…œ ë° ìµœì‹  ì „ì ê¸°ìˆ ì— ëŒ€í•œ ì „ë¬¸ì ì¸ ì§€ì‹ì„ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    description: 'ìµœì‹  ì „ì ê¸°ìˆ  ë™í–¥ê³¼ ì‹¤ë¬´ ì ìš© ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ë³µì¡í•œ ì „ê¸°ì „ì ê°œë…ì„ ì²´ê³„ì ìœ¼ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤. ì´ë¡ ì  ê¸°ë°˜ê³¼ ì‹¤ìš©ì  ì ‘ê·¼ ë°©ë²•ì„ ê· í˜•ìˆê²Œ ì œì‹œí•©ë‹ˆë‹¤.'
                },
                precision_energy: {
                    name: 'ì •ë°€ì—ë„ˆì§€ ì „ë¬¸ê°€',
                    title: 'ì •ë°€ê¸°ê¸° ë° ì—ë„ˆì§€ ë©˜í† ',
                    affiliation: 'ì—ë„ˆì§€ê¸°ìˆ ì—°êµ¬ì›',
                    expertise: 'ì •ë°€ê¸°ê¸° ì„¤ê³„, ì¸¡ì •ê³µí•™, ì—ë„ˆì§€ì‹œìŠ¤í…œ, ì‹ ì¬ìƒì—ë„ˆì§€, ì—ë„ˆì§€íš¨ìœ¨ ìµœì í™” ë° ì§€ì†ê°€ëŠ¥í•œ ì—ë„ˆì§€ ì†”ë£¨ì…˜ì— ëŒ€í•œ ì „ë¬¸ì ì¸ ì§€ì‹ì„ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    description: 'ì •ë°€ ê¸°ìˆ ê³¼ ì—ë„ˆì§€ ì‹œìŠ¤í…œì˜ ìœµí•© ë¶„ì•¼ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ê¸°ìˆ ì  ì •í™•ì„±ê³¼ í™˜ê²½ì  ê³ ë ¤ì‚¬í•­ì„ ëª¨ë‘ ë°˜ì˜í•œ ì‹¤ìš©ì ì¸ ì¡°ì–¸ì„ ì œê³µí•˜ë©°, ë¯¸ë˜ ì—ë„ˆì§€ ê¸°ìˆ ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.'
                },
                materials: {
                    name: 'ì†Œì¬ì¬ë£Œ ì „ë¬¸ê°€',
                    title: 'ì‹ ì†Œì¬ ë° ì¬ë£Œê³¼í•™ ë©˜í† ',
                    affiliation: 'ì¬ë£Œì—°êµ¬ì†Œ',
                    expertise: 'ì‹ ì†Œì¬ ê°œë°œ, ë‚˜ë…¸ê¸°ìˆ , ì¬ë£Œê³¼í•™, ê³ ë¶„ì ì†Œì¬, ì„¸ë¼ë¯¹, ê¸ˆì†ì¬ë£Œ ë° ë¯¸ë˜ ì†Œì¬ ê¸°ìˆ ì— ëŒ€í•œ ì „ë¬¸ì ì¸ ì§€ì‹ì„ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    description: 'ê¸°ì´ˆ ê³¼í•™ê³¼ ì‚°ì—… ì‘ìš©ì„ ì—°ê²°í•˜ëŠ” ì†Œì¬ ë¶„ì•¼ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ë¯¸ë˜ ì†Œì¬ ê¸°ìˆ ê³¼ ì‚°ì—… íŠ¸ë Œë“œì— ëŒ€í•œ ê¹Šì€ í†µì°°ë ¥ì„ ë°”íƒ•ìœ¼ë¡œ ì‹¤ìš©ì ì´ë©´ì„œë„ í˜ì‹ ì ì¸ ì ‘ê·¼ ë°©ë²•ì„ ì œì‹œí•©ë‹ˆë‹¤.'
                },
                computer: {
                    name: 'ì»´í“¨í„°í†µì‹  ì „ë¬¸ê°€',
                    title: 'IT ë° ì†Œí”„íŠ¸ì›¨ì–´ ë©˜í† ',
                    affiliation: 'ITê¸°ì—… ê°œë°œíŒ€',
                    expertise: 'ì†Œí”„íŠ¸ì›¨ì–´ê³µí•™, ë„¤íŠ¸ì›Œí¬ ì‹œìŠ¤í…œ, ë°ì´í„°ë² ì´ìŠ¤, ì¸ê³µì§€ëŠ¥/ë¨¸ì‹ ëŸ¬ë‹, ì‚¬ì´ë²„ë³´ì•ˆ, í´ë¼ìš°ë“œ ì»´í“¨íŒ… ë° ìµœì‹  IT ê¸°ìˆ ì— ëŒ€í•œ ì „ë¬¸ì ì¸ ì§€ì‹ì„ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    description: 'ìµœì‹  ê¸°ìˆ  íŠ¸ë Œë“œì™€ ì‚°ì—… ë™í–¥ì„ ì˜ íŒŒì•…í•˜ê³  ìˆëŠ” IT ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì´ë¡ ì  ë°°ê²½ê³¼ ì‹¤ì œ êµ¬í˜„ ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ì²´ê³„ì ì´ê³  ì‹¤ìš©ì ì¸ ê°œë°œ ê°€ì´ë“œë¥¼ ì œì‹œí•©ë‹ˆë‹¤.'
                },
                industrial: {
                    name: 'ì‚°ì—…ê³µí•™ ì „ë¬¸ê°€',
                    title: 'ìƒì‚°ê´€ë¦¬ ë° í’ˆì§ˆê²½ì˜ ë©˜í† ',
                    affiliation: 'ì‚°ì—…ê²½ì˜ì»¨ì„¤íŒ…',
                    expertise: 'ì‚°ì—…ê³µí•™, í’ˆì§ˆê´€ë¦¬, ìƒì‚°ê´€ë¦¬, ê³µê¸‰ë§ê´€ë¦¬, ë¦°ì œì¡°, 6ì‹œê·¸ë§ˆ ë° ê¸°ì—… ìš´ì˜ íš¨ìœ¨ì„± í–¥ìƒì— ëŒ€í•œ ì „ë¬¸ì ì¸ ì§€ì‹ì„ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    description: 'ê¸°ì—…ì˜ ìš´ì˜ íš¨ìœ¨ì„± í–¥ìƒê³¼ ê²½ìŸë ¥ ê°•í™”ì— ëŒ€í•œ ì‹¤ë¬´ ê²½í—˜ì´ í’ë¶€í•œ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ë°ì´í„° ë¶„ì„ê³¼ ì‹œìŠ¤í…œì  ì‚¬ê³ ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‹¤ì§ˆì ì¸ ê°œì„  ë°©ì•ˆì„ ì œì•ˆí•©ë‹ˆë‹¤.'
                },
                chemical: {
                    name: 'í™”ê³µ ì „ë¬¸ê°€',
                    title: 'í™”í•™ê³µí•™ ë° ê³µì • ë©˜í† ',
                    affiliation: 'í™”í•™í”ŒëœíŠ¸',
                    expertise: 'í™”í•™ê³µí•™, ê³µì •ì„¤ê³„, ë°˜ì‘ê³µí•™, ë¶„ë¦¬ê³µì •, í™”í•™í”ŒëœíŠ¸ ìš´ì˜, ì•ˆì „ê³µí•™ ë° í™˜ê²½ ì¹œí™”ì ì¸ ê³µì •ì— ëŒ€í•œ ì „ë¬¸ì ì¸ ì§€ì‹ì„ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.',
                    description: 'ì‚°ì—… í˜„ì¥ì—ì„œì˜ ì•ˆì „ê³¼ íš¨ìœ¨ì„±ì„ ì¤‘ì‹œí•˜ëŠ” í™”í•™ê³µí•™ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì´ë¡ ê³¼ ì‹¤ë¬´ë¥¼ ê· í˜•ìˆê²Œ ì ‘ê·¼í•˜ì—¬ ì•ˆì „í•˜ê³  íš¨ìœ¨ì ì¸ í™”í•™ ê³µì • ì†”ë£¨ì…˜ì„ ì œì‹œí•©ë‹ˆë‹¤.'
                }
            };
            
            // í”„ë¡œí•„ ì„¹ì…˜ ìƒì„±
            const profileSection = document.createElement('div');
            profileSection.id = 'mentorProfileSection';
            profileSection.style.cssText = `
                background: white;
                border-radius: 16px;
                box-shadow: 0 4px 24px rgba(0,0,0,0.1);
                padding: 40px;
                margin: 40px auto;
                width: 900px;
                max-width: 95%;
            `;
            
            // ê¸°ì¡´ ì„ íƒëœ ë©˜í† ë“¤ê³¼ ì¶”ì²œëœ í˜ë¥´ì†Œë‚˜ë“¤ì„ ëª¨ë‘ ìˆ˜ì§‘
            const allSelectedMentors = [];
            
            // ê¸°ì¡´ 6ê°œ ë©˜í† 
            selectedMentors.forEach(mentorType => {
                if (mentorProfiles[mentorType]) {
                    allSelectedMentors.push({
                        type: 'traditional',
                        id: mentorType,
                        profile: mentorProfiles[mentorType]
                    });
                }
            });
            
            // ì¶”ì²œëœ í˜ë¥´ì†Œë‚˜
            const selectedPersonas = document.querySelectorAll('[data-selected-persona]');
            selectedPersonas.forEach(personaElement => {
                const personaId = personaElement.getAttribute('data-selected-persona');
                if (mentorProfiles[personaId]) {
                    allSelectedMentors.push({
                        type: 'persona',
                        id: personaId,
                        profile: mentorProfiles[personaId]
                    });
                }
            });
            
            console.log('ìƒì„±í•  í”„ë¡œí•„:', allSelectedMentors);
            
            // finalSelectedMentors ì´ˆê¸°í™” (ëª¨ë“  ì„ íƒëœ ë©˜í†  í¬í•¨)
            finalSelectedMentors = allSelectedMentors.map(mentor => mentor.id);
            
            // ì„ íƒëœ ë©˜í† ë“¤ì˜ í”„ë¡œí•„ ì¹´ë“œ ìƒì„±
            const profileCards = allSelectedMentors.map(mentor => {
                const profile = mentor.profile;
                
                // í…ìŠ¤íŠ¸ ê¸¸ì´ ì œí•œ ë° ë”ë³´ê¸° ì²˜ë¦¬
                const maxExpertiseLength = 80;
                const maxDescriptionLength = 120;
                const shortExpertise = profile.expertise.length > maxExpertiseLength ? 
                    profile.expertise.substring(0, maxExpertiseLength) + '...' : profile.expertise;
                const shortDescription = profile.description.length > maxDescriptionLength ? 
                    profile.description.substring(0, maxDescriptionLength) + '...' : profile.description;
                return `
                    <div class="mentor-profile-card" data-mentor="${mentor.id}" style="
                        background: white;
                        border: 1px solid #e2e8f0;
                        border-radius: 12px;
                        padding: 24px;
                        transition: all 0.3s ease;
                        position: relative;
                        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                        height: 520px;
                        overflow: hidden;
                        display: flex;
                        flex-direction: column;
                    " onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'" 
                       onmouseout="this.style.boxShadow='0 1px 3px rgba(0, 0, 0, 0.1)'">
                        
                        <!-- í”„ë¡œí•„ í—¤ë” (ê³ ì • ë†’ì´: 100px) -->
                        <div style="display: flex; align-items: flex-start; margin-bottom: 16px; height: 100px; flex-shrink: 0;">
                            <div style="
                                width: 56px;
                                height: 56px;
                                background: linear-gradient(135deg, #3b82f6, #1e40af);
                                border-radius: 8px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 18px;
                                margin-right: 16px;
                                color: white;
                                font-weight: 600;
                            ">${profile.name.charAt(0)}</div>
                            
                            <div style="flex: 1; overflow: hidden;">
                                <h3 style="
                                    font-size: 18px;
                                    font-weight: 600;
                                    color: #1f2937;
                                    margin: 0 0 4px 0;
                                    line-height: 1.2;
                                    display: -webkit-box;
                                    -webkit-line-clamp: 1;
                                    -webkit-box-orient: vertical;
                                    overflow: hidden;
                                ">${profile.name}</h3>
                                <p style="
                                    font-size: 14px;
                                    font-weight: 500;
                                    color: #6b7280;
                                    margin: 0 0 8px 0;
                                    line-height: 1.2;
                                    display: -webkit-box;
                                    -webkit-line-clamp: 1;
                                    -webkit-box-orient: vertical;
                                    overflow: hidden;
                                ">${profile.title}</p>
                                <div style="
                                    display: inline-block;
                                    background: #f3f4f6;
                                    color: #374151;
                                    font-size: 12px;
                                    font-weight: 500;
                                    padding: 4px 8px;
                                    border-radius: 6px;
                                    max-width: 100%;
                                    overflow: hidden;
                                    text-overflow: ellipsis;
                                    white-space: nowrap;
                                ">${profile.affiliation}</div>
                            </div>
                            
                            <!-- ì„ íƒ ì²´í¬ë°•ìŠ¤ -->
                            <div style="margin-left: 16px; flex-shrink: 0;">
                                <input type="checkbox" id="final-select-${mentor.id}" 
                                       onchange="toggleFinalMentorSelection('${mentor.id}')"
                                       style="
                                           width: 18px;
                                           height: 18px;
                                           cursor: pointer;
                                           accent-color: #3b82f6;
                                       " checked>
                            </div>
                        </div>
                        
                        <!-- ì „ë¬¸ ë¶„ì•¼ (ê³ ì • ë†’ì´: 120px) -->
                        <div style="margin-bottom: 16px; height: 120px; flex-shrink: 0; overflow: hidden;">
                            <h4 style="
                                font-size: 13px;
                                font-weight: 600;
                                color: #374151;
                                margin: 0 0 8px 0;
                            ">My expertise</h4>
                            <div style="position: relative; height: 100px; overflow: hidden;">
                                <p id="expertise-${mentor.id}" style="
                                    font-size: 14px;
                                    color: #6b7280;
                                    line-height: 1.4;
                                    margin: 0;
                                    ${profile.expertise.length > 80 ? 'display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden;' : ''}
                                ">${profile.expertise.length > 80 ? shortExpertise : profile.expertise}</p>
                                ${profile.expertise.length > 80 ? `
                                <button onclick="toggleText('expertise-${mentor.id}', '${profile.expertise.replace(/'/g, "\\'").replace(/"/g, '\\"')}', '${shortExpertise.replace(/'/g, "\\'").replace(/"/g, '\\"')}')" style="
                                    position: absolute;
                                    bottom: 0;
                                    right: 0;
                                    background: #f3f4f6;
                                    color: #3b82f6;
                                    border: none;
                                    padding: 2px 6px;
                                    border-radius: 4px;
                                    font-size: 12px;
                                    cursor: pointer;
                                    font-weight: 500;
                                ">ë”ë³´ê¸°</button>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- ì„¤ëª… (ê³ ì • ë†’ì´: 140px) -->
                        <div style="margin-bottom: 16px; height: 140px; flex-shrink: 0; overflow: hidden;">
                            <h4 style="
                                font-size: 13px;
                                font-weight: 600;
                                color: #374151;
                                margin: 0 0 8px 0;
                            ">About</h4>
                            <div style="position: relative; height: 120px; overflow: hidden;">
                                <p id="description-${mentor.id}" style="
                                    font-size: 14px;
                                    color: #6b7280;
                                    line-height: 1.4;
                                    margin: 0;
                                    ${profile.description.length > 120 ? 'display: -webkit-box; -webkit-line-clamp: 5; -webkit-box-orient: vertical; overflow: hidden;' : ''}
                                ">${profile.description.length > 120 ? shortDescription : profile.description}</p>
                                ${profile.description.length > 120 ? `
                                <button onclick="toggleText('description-${mentor.id}', '${profile.description.replace(/'/g, "\\'").replace(/"/g, '\\"')}', '${shortDescription.replace(/'/g, "\\'").replace(/"/g, '\\"')}')" style="
                                    position: absolute;
                                    bottom: 0;
                                    right: 0;
                                    background: #f3f4f6;
                                    color: #3b82f6;
                                    border: none;
                                    padding: 2px 6px;
                                    border-radius: 4px;
                                    font-size: 12px;
                                    cursor: pointer;
                                    font-weight: 500;
                                ">ë”ë³´ê¸°</button>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- ì£¼ìš” ê¸°ëŠ¥ -->
                        <div>
                            <h4 style="
                                font-size: 13px;
                                font-weight: 600;
                                color: #374151;
                                margin: 0 0 12px 0;
                            ">Key Features (MCP)</h4>
                            <div style="
                                background: #f9fafb;
                                border: 1px solid #e5e7eb;
                                border-radius: 8px;
                                padding: 12px;
                            ">
                                <div style="
                                    display: flex;
                                    align-items: center;
                                    font-size: 13px;
                                    color: #374151;
                                    font-weight: 500;
                                ">
                                    <span style="
                                        width: 8px;
                                        height: 8px;
                                        background: #10b981;
                                        border-radius: 50%;
                                        margin-right: 8px;
                                    "></span>
                                    ì‚¬ë‚´ ë¬¸ì„œ RAG
                                </div>
                            </div>
                        </div>
                        
                    </div>
                `;
            }).join('');
            
            profileSection.innerHTML = `
                <div style="text-align: center; margin-bottom: 32px;">
                    <h2 style="
                        font-size: 24px;
                        font-weight: 700;
                        color: #1e293b;
                        margin: 0 0 8px 0;
                    ">ì„ íƒí•˜ì‹  ë©˜í† ë“¤ì„ í™•ì¸í•´ì£¼ì„¸ìš”</h2>
                    <p style="
                        font-size: 14px;
                        color: #64748b;
                        margin: 0;
                    ">ì‹¤ì œ ë©˜í† ë§ì„ ì§„í–‰í•  ë©˜í† ë¥¼ ìµœì¢… ì„ íƒí•˜ì„¸ìš”. ê° ë©˜í† ëŠ” ê´€ë ¨ ë¬¸ì„œë¥¼ í™œìš©í•œ RAG ê¸°ë°˜ ë‹µë³€ì„ ì œê³µí•©ë‹ˆë‹¤.</p>
                </div>
                
                <div style="
                    display: grid;
                    grid-template-columns: repeat(3, 1fr);
                    gap: 20px;
                    margin-bottom: 32px;
                ">
                    ${profileCards}
                </div>
                
                <div style="text-align: center; margin-top: 32px;">
                    <button id="finalStartBtn" onclick="startFinalMentoring()" style="
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        color: white;
                        border: none;
                        padding: 16px 32px;
                        border-radius: 12px;
                        font-size: 16px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: transform 0.2s;
                        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
                    " onmouseover="this.style.transform='scale(1.05)'" 
                       onmouseout="this.style.transform='scale(1)'">
                        <i class="fas fa-comments" style="margin-right: 8px;"></i>
                        ë©˜í† ë“¤ê³¼ ëŒ€í™” ì‹œì‘
                    </button>
                </div>
            `;
            
            // ë©˜í†  ì½˜í…ì¸  ë‹¤ìŒì— í”„ë¡œí•„ ì„¹ì…˜ ì¶”ê°€
            const mentorContent = document.getElementById('mentorContent');
            if (mentorContent && mentorContent.parentNode) {
                mentorContent.parentNode.insertBefore(profileSection, mentorContent.nextSibling);
            }
        }

        // ìµœì¢… ë©˜í†  ì„ íƒ í† ê¸€
        let finalSelectedMentors = []; // ì´ˆê¸°ê°’ì€ ë¹ˆ ë°°ì—´, createMentorProfileSectionì—ì„œ ì„¤ì •ë¨
        
        function toggleFinalMentorSelection(mentorType) {
            const checkbox = document.getElementById(`final-select-${mentorType}`);
            if (checkbox.checked) {
                if (!finalSelectedMentors.includes(mentorType)) {
                    finalSelectedMentors.push(mentorType);
                }
            } else {
                finalSelectedMentors = finalSelectedMentors.filter(m => m !== mentorType);
            }
            
            updateFinalStartButton();
        }
        
        function toggleText(elementId, fullText, shortText) {
            const element = document.getElementById(elementId);
            const button = element.parentElement.querySelector('button');
            
            if (element.textContent.includes('...')) {
                // í˜„ì¬ ì¶•ì•½ëœ ìƒíƒœ â†’ ì „ì²´ í…ìŠ¤íŠ¸ í‘œì‹œ
                element.textContent = fullText;
                element.style.display = 'block';
                element.style.webkitLineClamp = 'unset';
                element.style.webkitBoxOrient = 'unset';
                button.textContent = 'ì ‘ê¸°';
            } else {
                // í˜„ì¬ ì „ì²´ í…ìŠ¤íŠ¸ â†’ ì¶•ì•½ í…ìŠ¤íŠ¸ í‘œì‹œ
                element.textContent = shortText;
                element.style.display = '-webkit-box';
                element.style.webkitLineClamp = elementId.includes('expertise') ? '4' : '5';
                element.style.webkitBoxOrient = 'vertical';
                button.textContent = 'ë”ë³´ê¸°';
            }
        }
        
        function updateFinalStartButton() {
            const btn = document.getElementById('finalStartBtn');
            if (!btn) return;
            
            if (finalSelectedMentors.length > 0) {
                btn.style.opacity = '1';
                btn.style.pointerEvents = 'auto';
                btn.disabled = false;
                btn.innerHTML = `
                    <i class="fas fa-rocket" style="margin-right: 8px;"></i>
                    ${finalSelectedMentors.length}ëª…ì˜ ë©˜í† ì™€ ì‹œì‘í•˜ê¸°
                `;
            } else {
                btn.style.opacity = '0.5';
                btn.style.pointerEvents = 'none';
                btn.disabled = true;
                btn.innerHTML = `
                    <i class="fas fa-comments" style="margin-right: 8px;"></i>
                    ëŒ€í™”í•  ë©˜í† ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”
                `;
            }
        }
        
        // ìµœì¢… ë©˜í† ë§ ì‹œì‘
        function startFinalMentoring() {
            if (finalSelectedMentors.length === 0) return;
            
            showNotification(`ì„ íƒëœ ${finalSelectedMentors.length}ëª…ì˜ ë©˜í† ì™€ í•¨ê»˜ ëŒ€í™”ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤!`, 'success');
            
            // ì„ íƒëœ ë©˜í†  ì •ë³´ë¥¼ ì €ì¥
            StorageManager.mentors.set(finalSelectedMentors);
            
            // ìƒì„¸ í”„ë¡œí•„ ì„¹ì…˜ ì œê±°
            const profileSection = document.getElementById('mentorProfileSection');
            if (profileSection) {
                profileSection.remove();
            }
            
            // ê¸°ì¡´ ëŒ€í™”ì°½ì´ ìˆìœ¼ë©´ ì œê±°
            const existingChat = document.getElementById('mentorChatSection');
            if (existingChat) {
                existingChat.remove();
            }
            
            // ëŒ€í™”ì°½ ìƒì„±
            createMentorChatSection();
            
            // ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ë¡œ ëŒ€í™”ì°½ìœ¼ë¡œ ì´ë™
            setTimeout(() => {
                const chatSection = document.getElementById('mentorChatSection');
                if (chatSection) {
                    chatSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 300);
        }
        
        // ë©˜í†  ëŒ€í™”ì°½ ìƒì„±
        function createMentorChatSection() {
            // ë©˜í†  ë‚´ìš© ì˜ì—­ ì°¾ê¸°
            const mentorContent = document.getElementById('mentorContent');
            if (!mentorContent) return;
            
            // ëŒ€í™”ì°½ ì»¨í…Œì´ë„ˆ ìƒì„±
            const chatSection = document.createElement('div');
            chatSection.id = 'mentorChatSection';
            chatSection.style.cssText = `
                margin-top: 40px;
                background: white;
                border-radius: 16px;
                box-shadow: 0 4px 24px rgba(0,0,0,0.1);
                overflow: hidden;
                border: 1px solid #e5e7eb;
            `;
            
            // ì„ íƒëœ ë©˜í†  ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const selectedMentorsList = StorageManager.mentors.get() || [];
            const mentorNames = selectedMentorsList.map(mentorId => {
                // ê¸°ì¡´ 6ê°œ ë©˜í†  ë§¤í•‘
                const mentorNameMap = {
                    'engineer': 'ì—…ë¬´ ê³¼ì™¸ ì„ ìƒë‹˜',
                    'executive': 'ì¼íƒ€ ê°•ì‚¬', 
                    'professor': 'êµìˆ˜',
                    'designer': 'ê°œë°œì',
                    'datascientist': 'ì˜ì–´ ì„ ìƒë‹˜',
                    'marketing': 'ëª…ë¦¬í•™ì',
                    // 10ê°œ í˜ë¥´ì†Œë‚˜ ë§¤í•‘
                    'architecture': 'ê±´ì¶• ì „ë¬¸ê°€',
                    'civil_urban': 'í† ëª©ë„ì‹œ ì „ë¬¸ê°€',
                    'transport': 'êµí†µìš´ì†¡ ì „ë¬¸ê°€',
                    'mechanical': 'ê¸°ê³„ê¸ˆì† ì „ë¬¸ê°€',
                    'electrical': 'ì „ê¸°ì „ì ì „ë¬¸ê°€',
                    'precision_energy': 'ì •ë°€ì—ë„ˆì§€ ì „ë¬¸ê°€',
                    'materials': 'ì†Œì¬ì¬ë£Œ ì „ë¬¸ê°€',
                    'computer': 'ì»´í“¨í„°í†µì‹  ì „ë¬¸ê°€',
                    'industrial': 'ì‚°ì—…ê³µí•™ ì „ë¬¸ê°€',
                    'chemical': 'í™”ê³µ ì „ë¬¸ê°€'
                };
                return mentorNameMap[mentorId] || mentorId;
            });
            
            chatSection.innerHTML = `
                <!-- ëŒ€í™”ì°½ í—¤ë” -->
                <div style="
                    background: linear-gradient(135deg, #a855f7, #ec4899);
                    color: white;
                    padding: 20px 30px;
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                ">
                    <div>
                        <h3 style="
                            font-size: 18px;
                            font-weight: 600;
                            margin: 0 0 4px 0;
                        ">ë©˜í† ì™€ ëŒ€í™”í•˜ê¸°</h3>
                        <p style="
                            font-size: 14px;
                            opacity: 0.9;
                            margin: 0;
                        ">ì„ íƒëœ ë©˜í† : ${mentorNames.join(', ')}</p>
                    </div>
                    <button onclick="closeMentorChat()" style="
                        background: rgba(255,255,255,0.2);
                        border: none;
                        color: white;
                        width: 32px;
                        height: 32px;
                        border-radius: 50%;
                        cursor: pointer;
                        font-size: 18px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: background 0.2s;
                    " onmouseover="this.style.background='rgba(255,255,255,0.3)'" 
                       onmouseout="this.style.background='rgba(255,255,255,0.2)'">Ã—</button>
                </div>
                
                <!-- ëŒ€í™” ë©”ì‹œì§€ ì˜ì—­ -->
                <div id="mentorChatMessages" style="
                    height: 400px;
                    overflow-y: auto;
                    padding: 20px 30px;
                    background: #fafafa;
                ">
                    <div style="
                        background: white;
                        border-radius: 12px;
                        padding: 16px;
                        margin-bottom: 16px;
                        border-left: 4px solid #a855f7;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                    ">
                        <div style="
                            display: flex;
                            align-items: center;
                            margin-bottom: 8px;
                        ">
                            <div style="
                                width: 32px;
                                height: 32px;
                                background: linear-gradient(135deg, #a855f7, #ec4899);
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: white;
                                font-weight: 600;
                                font-size: 14px;
                                margin-right: 10px;
                            ">AI</div>
                            <span style="
                                font-weight: 600;
                                color: #374151;
                                font-size: 14px;
                            ">ë©˜í† íŒ€</span>
                        </div>
                        <p style="
                            color: #6b7280;
                            line-height: 1.5;
                            margin: 0;
                            font-size: 14px;
                        ">ì•ˆë…•í•˜ì„¸ìš”! ì„ íƒí•´ì£¼ì‹  ${selectedMentorsList.length}ëª…ì˜ ë©˜í† ê°€ í•¨ê»˜ ë„ì›€ì„ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.<br>
                        ë¬´ì—‡ì´ë“  ê¶ê¸ˆí•œ ì ì´ë‚˜ í•™ìŠµí•˜ê³  ì‹¶ì€ ë‚´ìš©ì„ ììœ ë¡­ê²Œ ì§ˆë¬¸í•´ì£¼ì„¸ìš”!</p>
                    </div>
                </div>
                
                <!-- ì…ë ¥ ì˜ì—­ -->
                <div style="
                    padding: 20px 30px;
                    background: white;
                    border-top: 1px solid #e5e7eb;
                ">
                    <div style="
                        display: flex;
                        align-items: flex-end;
                        gap: 12px;
                        background: #f9fafb;
                        border: 2px solid #e5e7eb;
                        border-radius: 12px;
                        padding: 12px;
                        transition: all 0.2s ease;
                    " id="mentorChatInputWrapper">
                        <textarea 
                            id="mentorChatInput"
                            placeholder="ë©˜í† ì—ê²Œ ì§ˆë¬¸í•˜ê±°ë‚˜ í•™ìŠµí•˜ê³  ì‹¶ì€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."
                            style="
                                flex: 1;
                                border: none;
                                background: transparent;
                                resize: none;
                                font-size: 14px;
                                line-height: 1.4;
                                outline: none;
                                min-height: 20px;
                                max-height: 100px;
                                font-family: inherit;
                            "
                            onkeydown="handleMentorChatKeyDown(event)"
                            oninput="autoResizeMentorChatInput(this)"></textarea>
                        <button 
                            id="mentorSendButton"
                            onclick="sendMentorMessage()"
                            style="
                                width: 36px;
                                height: 36px;
                                background: linear-gradient(135deg, #a855f7, #ec4899);
                                color: white;
                                border: none;
                                border-radius: 8px;
                                cursor: pointer;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                transition: all 0.2s ease;
                                flex-shrink: 0;
                            "
                            onmouseover="this.style.transform='scale(1.05)'"
                            onmouseout="this.style.transform='scale(1)'">
                            <i class="fas fa-paper-plane" style="font-size: 14px;"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // ë©˜í†  ë‚´ìš© ì˜ì—­ì— ì¶”ê°€
            mentorContent.appendChild(chatSection);
            
            // ì…ë ¥ì°½ í¬ì»¤ìŠ¤
            setTimeout(() => {
                const input = document.getElementById('mentorChatInput');
                if (input) input.focus();
            }, 100);
        }
        
        // ë©˜í†  ëŒ€í™”ì°½ ë‹«ê¸°
        function closeMentorChat() {
            const chatSection = document.getElementById('mentorChatSection');
            if (chatSection) {
                chatSection.remove();
                
                // ë©˜í†  ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
                selectedMentors = [];
                finalSelectedMentors = [];
                StorageManager.mentors.clear();
                
                // ì„ íƒëœ ë©˜í†  ì˜ì—­ ì´ˆê¸°í™”
                const selectedMentorsContainer = document.getElementById('selectedMentors');
                if (selectedMentorsContainer) {
                    selectedMentorsContainer.innerHTML = '<div style="color: #6b7280; font-size: 14px;">ì„ íƒëœ ë©˜í† ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>';
                }
                
                // ë©˜í†  ì¹´ë“œë“¤ ì„ íƒ ìƒíƒœ ì œê±°
                const mentorCards = document.querySelectorAll('.mentor-card');
                mentorCards.forEach(card => {
                    card.style.borderColor = '#e5e7eb';
                    card.style.background = 'white';
                });
                
                // ì¶”ì²œëœ í˜ë¥´ì†Œë‚˜ë“¤ë„ ì œê±°
                const selectedPersonas = document.querySelectorAll('[data-selected-persona]');
                selectedPersonas.forEach(persona => persona.remove());
                
                // ì‹œì‘ ë²„íŠ¼ ë¹„í™œì„±í™”
                updateStartButton();
            }
        }
        
        // ë©˜í†  ì±„íŒ… í‚¤ë³´ë“œ ì´ë²¤íŠ¸ ì²˜ë¦¬
        function handleMentorChatKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMentorMessage();
            }
        }
        
        // ë©˜í†  ì±„íŒ… ì…ë ¥ì°½ ìë™ í¬ê¸° ì¡°ì ˆ
        function autoResizeMentorChatInput(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 100) + 'px';
            
            // ì…ë ¥ ì˜ì—­ í¬ì»¤ìŠ¤ ìŠ¤íƒ€ì¼
            const wrapper = document.getElementById('mentorChatInputWrapper');
            if (wrapper) {
                if (textarea.value.trim()) {
                    wrapper.style.borderColor = '#a855f7';
                    wrapper.style.boxShadow = '0 0 0 3px rgba(168, 85, 247, 0.1)';
                } else {
                    wrapper.style.borderColor = '#e5e7eb';
                    wrapper.style.boxShadow = 'none';
                }
            }
        }
        
        // ë©˜í† ì—ê²Œ ë©”ì‹œì§€ ì „ì†¡ - ê° ë©˜í† ë³„ë¡œ ê°œë³„ ì‘ë‹µ
        async function sendMentorMessage() {
            const input = document.getElementById('mentorChatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // ì…ë ¥ì°½ ë¹„ìš°ê¸° ë° í¬ê¸° ì´ˆê¸°í™”
            input.value = '';
            autoResizeMentorChatInput(input);
            
            // ì „ì†¡ ë²„íŠ¼ ë¹„í™œì„±í™”
            const sendButton = document.getElementById('mentorSendButton');
            sendButton.disabled = true;
            sendButton.style.opacity = '0.5';
            
            // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
            addMentorChatMessage('user', message);
            
            try {
                // ì„ íƒëœ ë©˜í† ë“¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const selectedMentorsList = StorageManager.mentors.get() || [];
                const sessionId = getCookieValue('session_id') || 'default';
                
                if (selectedMentorsList.length === 0) {
                    throw new Error('ì„ íƒëœ ë©˜í† ê°€ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // ê° ë©˜í† ë³„ë¡œ ê°œë³„ ì‘ë‹µ ì²˜ë¦¬
                const mentorPromises = selectedMentorsList.map(async (mentorId) => {
                    try {
                        // ë©˜í† ë³„ ì„¸ì…˜ ID ìƒì„± (ê° ë©˜í† ë§ˆë‹¤ ë³„ë„ ì„¸ì…˜ ê´€ë¦¬)
                        const mentorSessionId = `${sessionId}_${mentorId}`;
                        
                        // ë¨¼ì € í•´ë‹¹ ë©˜í† ë¡œ í˜ë¥´ì†Œë‚˜ë¥¼ ì„ íƒí•´ì•¼ í•¨
                        console.log(`ğŸ”„ ë©˜í†  ${mentorId} í˜ë¥´ì†Œë‚˜ ì„ íƒ ì¤‘...`);
                        const selectionResult = await selectPersonaForMentor(mentorId, mentorSessionId);
                        console.log(`âœ… ë©˜í†  ${mentorId} í˜ë¥´ì†Œë‚˜ ì„ íƒ ì™„ë£Œ:`, selectionResult);
                        
                        // expert_mentoring íˆ´ í˜¸ì¶œ
                        console.log(`ğŸ”„ ë©˜í†  ${mentorId} ë©˜í† ë§ ì‘ë‹µ ìƒì„± ì¤‘...`);
                        const response = await callExpertMentoring(message, mentorSessionId);
                        console.log(`âœ… ë©˜í†  ${mentorId} ì‘ë‹µ ì™„ë£Œ`);
                        
                        return {
                            mentorId: mentorId,
                            mentorName: getMentorName(mentorId),
                            response: response,
                            success: true
                        };
                    } catch (error) {
                        console.error(`âŒ ë©˜í†  ${mentorId} ì‘ë‹µ ì˜¤ë¥˜:`, error);
                        
                        // ë” ìƒì„¸í•œ ì—ëŸ¬ ì •ë³´ ì œê³µ
                        let errorMessage = `ì£„ì†¡í•©ë‹ˆë‹¤. ${getMentorName(mentorId)}ì˜ ì‘ë‹µì„ ìƒì„±í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`;
                        
                        if (error.message && error.message.includes('ë©˜í† ë§ ëª¨ë“œê°€ í™œì„±í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤')) {
                            errorMessage += '\\ní˜ë¥´ì†Œë‚˜ ì„¤ì •ì— ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                        } else if (error.message) {
                            errorMessage += `\\nì˜¤ë¥˜ ë‚´ìš©: ${error.message}`;
                        }
                        
                        return {
                            mentorId: mentorId,
                            mentorName: getMentorName(mentorId),
                            response: errorMessage,
                            success: false
                        };
                    }
                });
                
                // ëª¨ë“  ë©˜í†  ì‘ë‹µì„ ë³‘ë ¬ ì²˜ë¦¬
                const mentorResponses = await Promise.all(mentorPromises);
                
                // ê° ë©˜í† ë³„ë¡œ ê°œë³„ ë©”ì‹œì§€ë¡œ í‘œì‹œ
                mentorResponses.forEach(mentorResponse => {
                    addMentorChatMessage('mentor', mentorResponse.response, mentorResponse.mentorName, mentorResponse.mentorId);
                });
                
            } catch (error) {
                console.error('ë©˜í†  ë©”ì‹œì§€ ì „ì†¡ ì˜¤ë¥˜:', error);
                addMentorChatMessage('ai', 'ì£„ì†¡í•©ë‹ˆë‹¤. ë©˜í†  ì‘ë‹µì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
            
            // ì „ì†¡ ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
            sendButton.disabled = false;
            sendButton.style.opacity = '1';
            
            // ì…ë ¥ì°½ì— í¬ì»¤ìŠ¤
            input.focus();
        }
        
        // ë©˜í†  ì±„íŒ…ì— ë©”ì‹œì§€ ì¶”ê°€ - ê°œë³„ ë©˜í†  ì§€ì›
        function addMentorChatMessage(type, content, mentorName = null, mentorId = null) {
            const messagesContainer = document.getElementById('mentorChatMessages');
            if (!messagesContainer) return null;
            
            const messageId = 'mentor-msg-' + Date.now() + Math.random();
            const messageDiv = document.createElement('div');
            
            if (type === 'user') {
                messageDiv.innerHTML = `
                    <div style="
                        background: white;
                        border-radius: 12px;
                        padding: 16px;
                        margin-bottom: 16px;
                        border-left: 4px solid #3b82f6;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                        margin-left: 40px;
                    ">
                        <div style="
                            display: flex;
                            align-items: center;
                            margin-bottom: 8px;
                        ">
                            <div style="
                                width: 32px;
                                height: 32px;
                                background: #e5e7eb;
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: #6b7280;
                                font-weight: 600;
                                font-size: 14px;
                                margin-right: 10px;
                            ">U</div>
                            <span style="
                                font-weight: 600;
                                color: #374151;
                                font-size: 14px;
                            ">ë‚˜</span>
                        </div>
                        <p style="
                            color: #374151;
                            line-height: 1.5;
                            margin: 0;
                            font-size: 14px;
                        ">${content}</p>
                    </div>
                `;
            } else if (type === 'mentor') {
                // ê°œë³„ ë©˜í†  ì‘ë‹µ
                const mentorColor = getMentorColor(mentorId);
                const mentorInitial = mentorName ? mentorName.charAt(0) : 'M';
                
                messageDiv.innerHTML = `
                    <div style="
                        background: white;
                        border-radius: 12px;
                        padding: 16px;
                        margin-bottom: 16px;
                        border-left: 4px solid ${mentorColor};
                        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                    ">
                        <div style="
                            display: flex;
                            align-items: center;
                            margin-bottom: 8px;
                        ">
                            <div style="
                                width: 32px;
                                height: 32px;
                                background: ${mentorColor};
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: white;
                                font-weight: 600;
                                font-size: 14px;
                                margin-right: 10px;
                            ">${mentorInitial}</div>
                            <span style="
                                font-weight: 600;
                                color: #374151;
                                font-size: 14px;
                            ">${mentorName || 'ë©˜í† '}</span>
                        </div>
                        <div style="
                            color: #6b7280;
                            line-height: 1.5;
                            margin: 0;
                            font-size: 14px;
                        ">${content}</div>
                    </div>
                `;
            } else {
                // ì¼ë°˜ AI ì‘ë‹µ (ì—ëŸ¬ ë©”ì‹œì§€ ë“±)
                messageDiv.innerHTML = `
                    <div style="
                        background: white;
                        border-radius: 12px;
                        padding: 16px;
                        margin-bottom: 16px;
                        border-left: 4px solid #a855f7;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                    ">
                        <div style="
                            display: flex;
                            align-items: center;
                            margin-bottom: 8px;
                        ">
                            <div style="
                                width: 32px;
                                height: 32px;
                                background: linear-gradient(135deg, #a855f7, #ec4899);
                                border-radius: 50%;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: white;
                                font-weight: 600;
                                font-size: 14px;
                                margin-right: 10px;
                            ">AI</div>
                            <span style="
                                font-weight: 600;
                                color: #374151;
                                font-size: 14px;
                            ">ì‹œìŠ¤í…œ</span>
                        </div>
                        <div id="${messageId}" style="
                            color: #6b7280;
                            line-height: 1.5;
                            margin: 0;
                            font-size: 14px;
                        ">${content || '<span style="opacity: 0.6;">ì‘ë‹µì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</span>'}</div>
                    </div>
                `;
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            return messageId;
        }
        
        // ë©˜í†  ì±„íŒ… ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
        function updateMentorChatMessage(messageId, content) {
            const messageElement = document.getElementById(messageId);
            if (messageElement) {
                messageElement.innerHTML = content;
                const messagesContainer = document.getElementById('mentorChatMessages');
                if (messagesContainer) {
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
            }
        }
        
        // ì¿ í‚¤ ê°’ ê°€ì ¸ì˜¤ê¸° ìœ í‹¸ë¦¬í‹°
        function getCookieValue(name) {
            const value = "; " + document.cookie;
            const parts = value.split("; " + name + "=");
            if (parts.length === 2) return parts.pop().split(";").shift();
            return null;
        }
        
        // ë©˜í†  ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
        function getMentorName(mentorId) {
            const mentorNameMap = {
                'engineer': 'ì—…ë¬´ ê³¼ì™¸ ì„ ìƒë‹˜',
                'executive': 'ì¼íƒ€ ê°•ì‚¬', 
                'professor': 'êµìˆ˜',
                'designer': 'ê°œë°œì',
                'datascientist': 'ì˜ì–´ ì„ ìƒë‹˜',
                'marketing': 'ëª…ë¦¬í•™ì',
                // 10ê°œ í˜ë¥´ì†Œë‚˜ ë§¤í•‘
                'architecture': 'ê±´ì¶• ì „ë¬¸ê°€',
                'civil_urban': 'í† ëª©ë„ì‹œ ì „ë¬¸ê°€',
                'transport': 'êµí†µìš´ì†¡ ì „ë¬¸ê°€',
                'mechanical': 'ê¸°ê³„ê¸ˆì† ì „ë¬¸ê°€',
                'electrical': 'ì „ê¸°ì „ì ì „ë¬¸ê°€',
                'precision_energy': 'ì •ë°€ì—ë„ˆì§€ ì „ë¬¸ê°€',
                'materials': 'ì†Œì¬ì¬ë£Œ ì „ë¬¸ê°€',
                'computer': 'ì»´í“¨í„°í†µì‹  ì „ë¬¸ê°€',
                'industrial': 'ì‚°ì—…ê³µí•™ ì „ë¬¸ê°€',
                'chemical': 'í™”ê³µ ì „ë¬¸ê°€'
            };
            return mentorNameMap[mentorId] || mentorId;
        }
        
        // ë©˜í† ë³„ ìƒ‰ìƒ ê°€ì ¸ì˜¤ê¸°
        function getMentorColor(mentorId) {
            const mentorColorMap = {
                'engineer': '#10b981', // green
                'executive': '#f59e0b', // amber
                'professor': '#3b82f6', // blue
                'designer': '#8b5cf6', // purple
                'datascientist': '#06b6d4', // cyan
                'marketing': '#f97316', // orange
                // 10ê°œ í˜ë¥´ì†Œë‚˜ ìƒ‰ìƒ
                'architecture': '#ef4444', // red
                'civil_urban': '#84cc16', // lime
                'transport': '#0ea5e9', // sky
                'mechanical': '#6366f1', // indigo
                'electrical': '#8b5cf6', // violet
                'precision_energy': '#d946ef', // fuchsia
                'materials': '#ec4899', // pink
                'computer': '#14b8a6', // teal
                'industrial': '#f97316', // orange
                'chemical': '#a855f7'  // purple
            };
            return mentorColorMap[mentorId] || '#a855f7';
        }
        
        // í˜ë¥´ì†Œë‚˜ ì„ íƒ API í˜¸ì¶œ
        async function selectPersonaForMentor(mentorId, sessionId) {
            try {
                console.log(`ğŸ“‹ í˜ë¥´ì†Œë‚˜ ì„ íƒ ìš”ì²­: ${mentorId} for session ${sessionId}`);
                
                const response = await fetch('/api/mentor_chat/select_persona', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        persona_id: mentorId,
                        session_id: sessionId
                    })
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error(`í˜ë¥´ì†Œë‚˜ ì„ íƒ HTTP ì˜¤ë¥˜: ${response.status}`, errorText);
                    throw new Error(`í˜ë¥´ì†Œë‚˜ ì„ íƒ ì‹¤íŒ¨: ${response.status} - ${errorText}`);
                }
                
                const result = await response.json();
                console.log(`âœ… í˜ë¥´ì†Œë‚˜ ì„ íƒ ì‘ë‹µ:`, result);
                
                if (result.error) {
                    throw new Error(result.error);
                }
                
                // ì„¸ì…˜ì´ ì„¤ì •ë  ì‹œê°„ì„ ì¤Œ
                await new Promise(resolve => setTimeout(resolve, 100));
                
                return result;
            } catch (error) {
                console.error('í˜ë¥´ì†Œë‚˜ ì„ íƒ ì˜¤ë¥˜:', error);
                throw error;
            }
        }
        
        // expert_mentoring íˆ´ í˜¸ì¶œ
        async function callExpertMentoring(message, sessionId) {
            try {
                console.log(`ğŸ§  ë©˜í† ë§ ìš”ì²­: session ${sessionId}, message: ${message.substring(0, 50)}...`);
                
                const response = await fetch('/api/mentor_chat/expert_mentoring', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        session_id: sessionId
                    })
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error(`ë©˜í† ë§ HTTP ì˜¤ë¥˜: ${response.status}`, errorText);
                    throw new Error(`ë©˜í† ë§ í˜¸ì¶œ ì‹¤íŒ¨: ${response.status} - ${errorText}`);
                }
                
                const result = await response.json();
                console.log(`âœ… ë©˜í† ë§ ì‘ë‹µ:`, result);
                
                if (result.error) {
                    throw new Error(result.error);
                }
                
                return result.response || result.message || 'ì‘ë‹µì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
            } catch (error) {
                console.error('ë©˜í† ë§ í˜¸ì¶œ ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // ëŒ€í™” ì´ˆê¸°í™”
        async function clearChat() {
            try {
                const response = await fetch('/clear-chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include' // ì¿ í‚¤ í¬í•¨
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // ì±„íŒ… ë©”ì‹œì§€ í™”ë©´ ì´ˆê¸°í™”
                    const chatMessages = document.getElementById('chatMessages');
                    // í˜„ì¬ ëª¨ë“œì— ë”°ë¼ ì´ˆê¸° ë©”ì‹œì§€ ì„¤ì •
                    const activeTab = document.querySelector('.nav-link.active').dataset.page;
                    const initialMsg = activeTab === 'profile' 
                        ? 'ì•ˆë…•í•˜ì„¸ìš”! ì‚¬ë‚´ ì§€ì‹ì´ í’ë¶€í•œ ì „ë¬¸ë¶„ì•¼ë³„ AI ë©˜í† ë“¤ì´ ì—¬ëŸ¬ë¶„ì˜ ì§ˆë¬¸ì— ë‹µë³€í•´ë“œë¦½ë‹ˆë‹¤. ê¶ê¸ˆí•œ ë¶„ì•¼ë‚˜ ì£¼ì œë¥¼ ë§ì”€í•´ì£¼ì‹œë©´, í•´ë‹¹ ì˜ì—­ì˜ ë©˜í† ë“¤ì´ ê°ìì˜ ì „ë¬¸ì„±ì„ ì‚´ë ¤ ë„ì›€ì„ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.'
                        : 'ì•ˆë…•í•˜ì„¸ìš”! LearningMateì˜ í•™ìŠµ ë©˜í† ì…ë‹ˆë‹¤. ì–´ë–¤ ì£¼ì œì— ëŒ€í•´ ë°°ìš°ê³  ì‹¶ìœ¼ì‹ ì§€ ì•Œë ¤ì£¼ì„¸ìš”. ë§ì¶¤í˜• í•™ìŠµ ê³„íšì„ í•¨ê»˜ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.';
                    
                    chatMessages.innerHTML = `
                        <div class="message ai-message">
                            <div class="message-avatar ai-avatar-small">AI</div>
                            <div class="message-content" id="initialMessage">
                                ${initialMsg}
                            </div>
                        </div>
                    `;
                    
                    // í”„ë¡œí•„ê³¼ ì»¤ë¦¬í˜ëŸ¼ ë°ì´í„° ì´ˆê¸°í™”
                    updateLearningProfile('', '', '');
                    StorageManager.profile.clear();
                    StorageManager.curriculum.clear();
                    StorageManager.curriculum.progress.clear();
                    // ìƒì„± ìƒíƒœ ì´ˆê¸°í™”
                    isGeneratingCurriculum = false;
                    
                    // ì»¤ë¦¬í˜ëŸ¼ í˜ì´ì§€ê°€ í™œì„±í™”ë˜ì–´ ìˆë‹¤ë©´ ìƒˆë¡œê³ ì¹¨
                    const curriculumContent = document.getElementById('curriculumContent');
                    if (curriculumContent && curriculumContent.style.display === 'block') {
                        showCurriculumContent(curriculumContent);
                    }
                    
                    showNotification('ëŒ€í™”ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
                } else {
                    showNotification('ëŒ€í™” ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
                }
            } catch (error) {
                showNotification(`ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
